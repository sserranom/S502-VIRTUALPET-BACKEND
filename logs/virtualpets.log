2025-07-16 00:00:00.224 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@4208a94e is alive
2025-07-16 00:00:04.445 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@7b2c99ca is alive
2025-07-16 00:00:10.311 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:00:10.312 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:00:11.470 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@59780ce is alive
2025-07-16 00:00:20.801 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@a1cd9e7 is alive
2025-07-16 00:00:40.315 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:00:40.316 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:00:44.240 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@63525b31 is alive
2025-07-16 00:00:53.639 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@64aff3bb is alive
2025-07-16 00:01:08.626 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@5a13b511 is alive
2025-07-16 00:01:10.318 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:01:10.319 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:01:10.937 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1e943acb is alive
2025-07-16 00:01:31.349 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@6cf1dd12 is alive
2025-07-16 00:01:40.333 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:01:40.333 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:01:44.484 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@12eda240 is alive
2025-07-16 00:01:50.656 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@4208a94e is alive
2025-07-16 00:01:51.845 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@7b2c99ca is alive
2025-07-16 00:02:05.680 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@59780ce is alive
2025-07-16 00:02:10.346 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:02:10.347 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:02:10.613 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@a1cd9e7 is alive
2025-07-16 00:02:28.519 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@63525b31 is alive
2025-07-16 00:02:34.656 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@12eda240: (connection has passed maxLifetime)
2025-07-16 00:02:34.659 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Attempting to create/setup new connection (91b9208f-78e1-4c2a-b516-8282c99b80b4)
2025-07-16 00:02:34.684 DEBUG jdk.event.security : X509Certificate: Alg:SHA256withRSA, Serial:02, Subject:CN=MySQL_Server_9.2.0_Auto_Generated_Server_Certificate, Issuer:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Key type:RSA, Length:2048, Cert Id:3807498037, Valid from:20/2/25, 10:36, Valid until:18/2/35, 10:36
2025-07-16 00:02:34.689 DEBUG jdk.event.security : X509Certificate: Alg:SHA256withRSA, Serial:01, Subject:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Issuer:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Key type:RSA, Length:2048, Cert Id:3139117285, Valid from:20/2/25, 10:36, Valid until:18/2/35, 10:36
2025-07-16 00:02:34.693 DEBUG jdk.event.security :  TLSHandshake: localhost:3306, TLSv1.3, TLS_AES_128_GCM_SHA256, 3807498037
2025-07-16 00:02:34.701 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Established new connection (91b9208f-78e1-4c2a-b516-8282c99b80b4)
2025-07-16 00:02:34.702 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@1eebc3dc
2025-07-16 00:02:38.272 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@64aff3bb is alive
2025-07-16 00:02:40.360 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:02:40.363 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:02:47.647 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1e943acb is alive
2025-07-16 00:03:01.237 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@5a13b511 is alive
2025-07-16 00:03:10.372 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:03:10.373 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:03:25.161 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@6cf1dd12 is alive
2025-07-16 00:03:35.069 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/my-pets
2025-07-16 00:03:35.069 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/my-pets
2025-07-16 00:03:35.078 DEBUG o.s.security.web.FilterChainProxy : Securing GET /api/pets/my-pets
2025-07-16 00:03:35.081 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:03:35.084 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:03:35.085 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:03:35.087 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@7a873da0
2025-07-16 00:03:35.090 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:03:35.092 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:03:35.094 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:03:35.097 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:03:35.098 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:03:35.105 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@36536927 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1325572239 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:03:35.107 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:03:35.108 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:03:35.114 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:03:35.114 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:03:35.115 DEBUG o.s.security.web.FilterChainProxy : Secured GET /api/pets/my-pets
2025-07-16 00:03:35.116 DEBUG o.s.web.servlet.DispatcherServlet : GET "/api/pets/my-pets", parameters={}
2025-07-16 00:03:35.116 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#getMyPets()
2025-07-16 00:03:35.117 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:03:35.119 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.getMyPets(); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:03:35.120 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.getMyPets(); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:03:35.121 INFO  S.virtualPets.controller.PetController : GET petition received to obtain the authenticated user pets
2025-07-16 00:03:35.253 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:03:35.254 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Admin
2025-07-16 00:03:35.255 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:03:35.256 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:03:35.258 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@bd397e5
2025-07-16 00:03:35.258 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:03:35.259 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:03:35.259 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:03:35.260 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:03:35.260 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:03:35.263 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1252365072 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@87091404 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:03:35.264 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:03:35.264 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:03:35.828 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:03:35.829 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:03:35.829 INFO  S502.virtualPets.service.PetService : Request to obtain user pets 'Admin'.
2025-07-16 00:03:35.830 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : pe1_0
2025-07-16 00:03:35.831 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.PetEntity(11))] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity] 
2025-07-16 00:03:35.831 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [org.hibernate.sql.ast.tree.from.LazyTableGroup@3e3fd8ce] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity(11).user] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity(11).user] 
2025-07-16 00:03:35.832 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : u1_0
2025-07-16 00:03:35.832 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@5bd9cb2d
2025-07-16 00:03:35.832 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(11).user(12).id) 
2025-07-16 00:03:35.833 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.PetEntity(11)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).createdAt]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).energyLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).hungerLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).mood]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).name]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).petType]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).updatedAt]
 |  \-EntityDelayedFetchImpl [S502.virtualPets.persistence.entity.PetEntity(11).user]

2025-07-16 00:03:35.834 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (pe1 : S502.virtualPets.persistence.entity.PetEntity(11)) {
          primaryTableReference : pets as pe1_0
          TableGroupJoins {
            left  join LazyTableGroup (u1 : S502.virtualPets.persistence.entity.PetEntity(11).user(12)) {
              primaryTableReference : users as u1_0
            }
          }
        }
      }
    }

2025-07-16 00:03:35.835 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:03:35.835 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 left join users u1_0 on u1_0.id=pe1_0.user_id where u1_0.id=?
2025-07-16 00:03:35.839 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.PetEntity(11).user -> EntityDelayedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(11).user)@1571973408 (ToOneAttributeMapping(NavigableRole[S502.virtualPets.persistence.entity.PetEntity.user])@845135647)
	  S502.virtualPets.persistence.entity.PetEntity(11) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(11))@386886105 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.PetEntity))

2025-07-16 00:03:36.221 INFO  S502.virtualPets.service.PetService : They recovered 3 User pets 'Admin'.
2025-07-16 00:03:36.221 INFO  S.virtualPets.controller.PetController : Returned 3 Pets for the current user.
2025-07-16 00:03:36.223 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:03:36.224 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [[PetResponseDTO[id=7, name=AdminPet, type=GOKU, mood=EXCITED, energyLevel=25, hungerLevel=75, userId (truncated)...]
2025-07-16 00:03:36.226 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:03:36.227 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:03:36.232 DEBUG o.s.security.web.FilterChainProxy : Securing GET /api/pets/my-pets
2025-07-16 00:03:36.235 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:03:36.241 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:03:36.241 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:03:36.243 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@1d0136c6
2025-07-16 00:03:36.243 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:03:36.244 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:03:36.245 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:03:36.247 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:03:36.248 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:03:36.773 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@715856365 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@2011071864 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:03:36.775 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:03:36.775 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:03:36.779 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:03:36.780 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:03:36.781 DEBUG o.s.security.web.FilterChainProxy : Secured GET /api/pets/my-pets
2025-07-16 00:03:36.782 DEBUG o.s.web.servlet.DispatcherServlet : GET "/api/pets/my-pets", parameters={}
2025-07-16 00:03:36.782 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#getMyPets()
2025-07-16 00:03:36.783 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:03:36.784 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.getMyPets(); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:03:36.785 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.getMyPets(); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:03:36.786 INFO  S.virtualPets.controller.PetController : GET petition received to obtain the authenticated user pets
2025-07-16 00:03:36.786 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:03:36.787 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Admin
2025-07-16 00:03:36.789 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:03:36.790 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:03:37.607 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@56fe6657
2025-07-16 00:03:37.608 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:03:37.610 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:03:37.611 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:03:37.612 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:03:37.613 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:03:37.617 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@444993352 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1484681677 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:03:37.619 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:03:37.620 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:03:37.624 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:03:37.625 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:03:37.626 INFO  S502.virtualPets.service.PetService : Request to obtain user pets 'Admin'.
2025-07-16 00:03:38.233 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : pe1_0
2025-07-16 00:03:38.233 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.PetEntity(11))] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity] 
2025-07-16 00:03:38.234 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [org.hibernate.sql.ast.tree.from.LazyTableGroup@2aefe196] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity(11).user] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity(11).user] 
2025-07-16 00:03:38.235 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : u1_0
2025-07-16 00:03:38.236 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@2e322624
2025-07-16 00:03:38.236 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(11).user(12).id) 
2025-07-16 00:03:38.237 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.PetEntity(11)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).createdAt]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).energyLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).hungerLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).mood]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).name]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).petType]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).updatedAt]
 |  \-EntityDelayedFetchImpl [S502.virtualPets.persistence.entity.PetEntity(11).user]

2025-07-16 00:03:38.239 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (pe1 : S502.virtualPets.persistence.entity.PetEntity(11)) {
          primaryTableReference : pets as pe1_0
          TableGroupJoins {
            left  join LazyTableGroup (u1 : S502.virtualPets.persistence.entity.PetEntity(11).user(12)) {
              primaryTableReference : users as u1_0
            }
          }
        }
      }
    }

2025-07-16 00:03:38.240 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:03:38.240 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 left join users u1_0 on u1_0.id=pe1_0.user_id where u1_0.id=?
2025-07-16 00:03:38.244 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.PetEntity(11).user -> EntityDelayedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(11).user)@1919313703 (ToOneAttributeMapping(NavigableRole[S502.virtualPets.persistence.entity.PetEntity.user])@845135647)
	  S502.virtualPets.persistence.entity.PetEntity(11) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(11))@467874232 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.PetEntity))

2025-07-16 00:03:38.247 INFO  S502.virtualPets.service.PetService : They recovered 3 User pets 'Admin'.
2025-07-16 00:03:38.688 INFO  S.virtualPets.controller.PetController : Returned 3 Pets for the current user.
2025-07-16 00:03:38.689 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:03:38.690 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [[PetResponseDTO[id=7, name=AdminPet, type=GOKU, mood=EXCITED, energyLevel=25, hungerLevel=75, userId (truncated)...]
2025-07-16 00:03:38.692 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:03:38.694 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:03:39.234 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@7b2c99ca is alive
2025-07-16 00:03:40.387 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:03:40.388 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:03:41.073 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@4208a94e is alive
2025-07-16 00:03:43.360 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/9
2025-07-16 00:03:43.371 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/9
2025-07-16 00:03:43.373 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:03:43.375 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:03:43.376 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:03:43.377 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@36248ec2
2025-07-16 00:03:43.377 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:03:43.378 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:03:43.378 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:03:43.379 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:03:43.380 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:03:43.386 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@2100991250 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1832086304 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:03:43.388 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:03:43.389 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:03:43.448 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:03:43.449 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:03:43.451 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/9
2025-07-16 00:03:43.452 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/9", parameters={}
2025-07-16 00:03:43.453 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:03:43.454 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:03:43.456 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=0, hungerLevel=100]]
2025-07-16 00:03:43.458 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:03:43.460 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:03:43.461 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 9. Info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=0, hungerLevel=100]
2025-07-16 00:03:43.462 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:03:43.462 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Admin
2025-07-16 00:03:43.463 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:03:43.464 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:03:43.465 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@7a36197a
2025-07-16 00:03:43.466 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:03:43.467 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:03:44.008 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:03:44.009 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:03:44.009 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:03:44.012 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@346569968 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@2017078447 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:03:44.015 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:03:44.016 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:03:44.020 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:03:44.021 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:03:44.022 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 9 by the user 'Admin'. info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=0, hungerLevel=100]
2025-07-16 00:03:44.024 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Admin': false
2025-07-16 00:03:44.026 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : pe1_0
2025-07-16 00:03:44.026 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.PetEntity(7))] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity] 
2025-07-16 00:03:44.027 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [org.hibernate.sql.ast.tree.from.LazyTableGroup@1d601557] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity(7).user] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity(7).user] 
2025-07-16 00:03:44.028 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@7fe428d8
2025-07-16 00:03:45.154 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(7).id) 
2025-07-16 00:03:45.155 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : u1_0
2025-07-16 00:03:45.156 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@7fa32e2
2025-07-16 00:03:45.157 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(7).user(8).id) 
2025-07-16 00:03:45.158 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.PetEntity(7)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).createdAt]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).energyLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).hungerLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).mood]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).name]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).petType]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).updatedAt]
 |  \-EntityDelayedFetchImpl [S502.virtualPets.persistence.entity.PetEntity(7).user]

2025-07-16 00:03:45.159 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (pe1 : S502.virtualPets.persistence.entity.PetEntity(7)) {
          primaryTableReference : pets as pe1_0
          TableGroupJoins {
            left  join LazyTableGroup (u1 : S502.virtualPets.persistence.entity.PetEntity(7).user(8)) {
              primaryTableReference : users as u1_0
            }
          }
        }
      }
    }

2025-07-16 00:03:45.161 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:03:45.162 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 left join users u1_0 on u1_0.id=pe1_0.user_id where pe1_0.id=? and u1_0.id=?
2025-07-16 00:03:45.167 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.PetEntity(7) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(7))@1268730557 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.PetEntity))
	  S502.virtualPets.persistence.entity.PetEntity(7).user -> EntityDelayedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(7).user)@1724802285 (ToOneAttributeMapping(NavigableRole[S502.virtualPets.persistence.entity.PetEntity.user])@845135647)

2025-07-16 00:03:45.170 DEBUG S502.virtualPets.service.PetService : User 'Admin' updating your pet with ID: 9.
2025-07-16 00:03:45.170 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1905016802<open>)] for JPA transaction
2025-07-16 00:03:45.171 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:03:45.171 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:03:45.912 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:03:45.916 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@64f0c432]
2025-07-16 00:03:45.917 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:03:45.919 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:03:45.919 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1905016802<open>)]
2025-07-16 00:03:45.920 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:03:45.920 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:03:45.921 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:03:45.921 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#2], was: [S502.virtualPets.persistence.entity.UserEntity.roles#2] (initialized)
2025-07-16 00:03:45.922 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2] (initialized)
2025-07-16 00:03:45.923 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 3 objects
2025-07-16 00:03:45.924 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:03:45.924 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:03:45.925 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-13T18:33:24.527572, mood=SAD, energyLevel=0, hungerLevel=100, petType=GOKU, name=AdminPet2, id=9, user=S502.virtualPets.persistence.entity.UserEntity#2, updatedAt=2025-07-15T23:50:25.947840}
2025-07-16 00:03:45.925 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$KkcMzZCoMiyABijofHR8tOFYDqECJ3Yo68OBc8ar/Q4uFoq1RszYK, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#2], accountNotExpired=true, id=2, credentialNoExpired=true, isEnable=true, username=Admin}
2025-07-16 00:03:45.925 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=USER, permissionEntities=[], id=2}
2025-07-16 00:03:45.927 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:03:45.943 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:03:45.944 INFO  S502.virtualPets.service.PetService : Pet 'AdminPet2' (ID: 9) Updated successfully by the user 'Admin'.
2025-07-16 00:03:45.944 INFO  S.virtualPets.controller.PetController : Pet with ID 9 updated successfully.
2025-07-16 00:03:45.945 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:03:46.567 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=9, name=AdminPet2, type=GOKU, mood=SAD, energyLevel=0, hungerLevel=100, userId=2,  (truncated)...]
2025-07-16 00:03:46.570 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:03:46.572 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:03:48.608 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/9
2025-07-16 00:03:48.618 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/9
2025-07-16 00:03:48.620 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:03:48.623 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:03:48.626 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:03:48.629 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@185e9379
2025-07-16 00:03:48.631 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:03:48.632 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:03:48.633 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:03:48.635 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:03:48.635 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:03:48.639 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@220414518 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@26837231 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:03:48.642 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:03:48.642 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:03:48.721 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:03:48.723 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:03:48.724 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/9
2025-07-16 00:03:48.725 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/9", parameters={}
2025-07-16 00:03:48.726 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:03:48.728 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:03:48.731 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=10, hungerLevel=85]]
2025-07-16 00:03:48.734 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:03:48.736 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:03:48.737 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 9. Info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=10, hungerLevel=85]
2025-07-16 00:03:48.738 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:03:48.739 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Admin
2025-07-16 00:03:48.740 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:03:48.741 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:03:48.742 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@39aa365c
2025-07-16 00:03:48.743 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:03:48.744 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:03:49.354 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:03:49.355 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:03:49.356 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:03:49.360 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@285436365 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@2112449970 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:03:49.362 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:03:49.363 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:03:49.368 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:03:49.368 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:03:49.370 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 9 by the user 'Admin'. info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=10, hungerLevel=85]
2025-07-16 00:03:49.370 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Admin': false
2025-07-16 00:03:49.372 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : pe1_0
2025-07-16 00:03:49.373 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.PetEntity(7))] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity] 
2025-07-16 00:03:49.374 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [org.hibernate.sql.ast.tree.from.LazyTableGroup@29d5e71c] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity(7).user] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity(7).user] 
2025-07-16 00:03:49.375 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@3cca11d0
2025-07-16 00:03:49.998 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(7).id) 
2025-07-16 00:03:49.999 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : u1_0
2025-07-16 00:03:50.000 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@63589561
2025-07-16 00:03:50.000 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(7).user(8).id) 
2025-07-16 00:03:50.001 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.PetEntity(7)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).createdAt]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).energyLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).hungerLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).mood]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).name]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).petType]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).updatedAt]
 |  \-EntityDelayedFetchImpl [S502.virtualPets.persistence.entity.PetEntity(7).user]

2025-07-16 00:03:50.002 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (pe1 : S502.virtualPets.persistence.entity.PetEntity(7)) {
          primaryTableReference : pets as pe1_0
          TableGroupJoins {
            left  join LazyTableGroup (u1 : S502.virtualPets.persistence.entity.PetEntity(7).user(8)) {
              primaryTableReference : users as u1_0
            }
          }
        }
      }
    }

2025-07-16 00:03:50.003 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:03:50.004 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 left join users u1_0 on u1_0.id=pe1_0.user_id where pe1_0.id=? and u1_0.id=?
2025-07-16 00:03:50.007 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.PetEntity(7) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(7))@1922814315 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.PetEntity))
	  S502.virtualPets.persistence.entity.PetEntity(7).user -> EntityDelayedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(7).user)@1511235309 (ToOneAttributeMapping(NavigableRole[S502.virtualPets.persistence.entity.PetEntity.user])@845135647)

2025-07-16 00:03:50.009 DEBUG S502.virtualPets.service.PetService : User 'Admin' updating your pet with ID: 9.
2025-07-16 00:03:50.010 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(798348451<open>)] for JPA transaction
2025-07-16 00:03:50.011 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:03:50.012 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:03:50.640 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:03:50.641 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@69b7d34a]
2025-07-16 00:03:50.642 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:03:50.644 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:03:50.645 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(798348451<open>)]
2025-07-16 00:03:50.645 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:03:50.646 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:03:50.647 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:03:50.648 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#2], was: [S502.virtualPets.persistence.entity.UserEntity.roles#2] (initialized)
2025-07-16 00:03:50.648 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2] (initialized)
2025-07-16 00:03:50.649 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 3 objects
2025-07-16 00:03:50.649 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:03:50.649 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:03:50.650 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-13T18:33:24.527572, mood=SAD, energyLevel=10, hungerLevel=85, petType=GOKU, name=AdminPet2, id=9, user=S502.virtualPets.persistence.entity.UserEntity#2, updatedAt=2025-07-16T00:03:45.926736}
2025-07-16 00:03:50.650 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$KkcMzZCoMiyABijofHR8tOFYDqECJ3Yo68OBc8ar/Q4uFoq1RszYK, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#2], accountNotExpired=true, id=2, credentialNoExpired=true, isEnable=true, username=Admin}
2025-07-16 00:03:50.650 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=USER, permissionEntities=[], id=2}
2025-07-16 00:03:50.651 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:03:50.666 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:03:50.666 INFO  S502.virtualPets.service.PetService : Pet 'AdminPet2' (ID: 9) Updated successfully by the user 'Admin'.
2025-07-16 00:03:50.667 INFO  S.virtualPets.controller.PetController : Pet with ID 9 updated successfully.
2025-07-16 00:03:50.667 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:03:51.205 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=9, name=AdminPet2, type=GOKU, mood=SAD, energyLevel=10, hungerLevel=85, userId=2,  (truncated)...]
2025-07-16 00:03:51.209 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:03:51.213 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:03:52.478 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/9
2025-07-16 00:03:52.480 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:03:52.483 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:03:52.483 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:03:52.485 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@55fb621e
2025-07-16 00:03:52.485 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:03:52.487 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:03:52.488 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:03:52.490 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:03:52.490 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:03:52.496 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1114441072 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1949502431 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:03:52.498 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:03:52.499 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:03:52.503 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:03:52.504 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:03:52.506 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/9
2025-07-16 00:03:52.507 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/9", parameters={}
2025-07-16 00:03:52.508 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:03:52.510 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:03:52.512 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=20, hungerLevel=70]]
2025-07-16 00:03:52.514 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:03:52.515 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:03:52.515 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 9. Info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=20, hungerLevel=70]
2025-07-16 00:03:52.675 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:03:52.675 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Admin
2025-07-16 00:03:52.677 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:03:52.678 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:03:52.679 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@3d007911
2025-07-16 00:03:52.679 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:03:52.681 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:03:52.682 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:03:52.683 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:03:52.684 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:03:52.688 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@555180518 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@15809139 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:03:52.689 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:03:52.690 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:03:53.245 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:03:53.246 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:03:53.247 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 9 by the user 'Admin'. info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=20, hungerLevel=70]
2025-07-16 00:03:53.248 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Admin': false
2025-07-16 00:03:53.249 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : pe1_0
2025-07-16 00:03:53.250 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.PetEntity(7))] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity] 
2025-07-16 00:03:53.250 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [org.hibernate.sql.ast.tree.from.LazyTableGroup@58b7aa6e] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity(7).user] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity(7).user] 
2025-07-16 00:03:53.251 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@ccd8f10
2025-07-16 00:03:53.251 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(7).id) 
2025-07-16 00:03:53.252 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : u1_0
2025-07-16 00:03:53.252 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@501e02fa
2025-07-16 00:03:53.253 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(7).user(8).id) 
2025-07-16 00:03:53.253 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.PetEntity(7)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).createdAt]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).energyLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).hungerLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).mood]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).name]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).petType]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).updatedAt]
 |  \-EntityDelayedFetchImpl [S502.virtualPets.persistence.entity.PetEntity(7).user]

2025-07-16 00:03:53.254 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (pe1 : S502.virtualPets.persistence.entity.PetEntity(7)) {
          primaryTableReference : pets as pe1_0
          TableGroupJoins {
            left  join LazyTableGroup (u1 : S502.virtualPets.persistence.entity.PetEntity(7).user(8)) {
              primaryTableReference : users as u1_0
            }
          }
        }
      }
    }

2025-07-16 00:03:53.255 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:03:53.711 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 left join users u1_0 on u1_0.id=pe1_0.user_id where pe1_0.id=? and u1_0.id=?
2025-07-16 00:03:53.715 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.PetEntity(7) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(7))@1451040664 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.PetEntity))
	  S502.virtualPets.persistence.entity.PetEntity(7).user -> EntityDelayedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(7).user)@281688907 (ToOneAttributeMapping(NavigableRole[S502.virtualPets.persistence.entity.PetEntity.user])@845135647)

2025-07-16 00:03:53.716 DEBUG S502.virtualPets.service.PetService : User 'Admin' updating your pet with ID: 9.
2025-07-16 00:03:53.717 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1123446381<open>)] for JPA transaction
2025-07-16 00:03:53.717 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:03:53.718 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:03:53.718 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:03:53.720 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@3a7051b]
2025-07-16 00:03:53.721 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:03:53.721 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:03:53.722 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1123446381<open>)]
2025-07-16 00:03:53.722 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:03:53.723 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:03:53.724 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:03:53.726 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#2], was: [S502.virtualPets.persistence.entity.UserEntity.roles#2] (initialized)
2025-07-16 00:03:53.727 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2] (initialized)
2025-07-16 00:03:53.728 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 3 objects
2025-07-16 00:03:53.729 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:03:53.730 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:03:54.165 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-13T18:33:24.527572, mood=SAD, energyLevel=20, hungerLevel=70, petType=GOKU, name=AdminPet2, id=9, user=S502.virtualPets.persistence.entity.UserEntity#2, updatedAt=2025-07-16T00:03:50.651326}
2025-07-16 00:03:54.166 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$KkcMzZCoMiyABijofHR8tOFYDqECJ3Yo68OBc8ar/Q4uFoq1RszYK, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#2], accountNotExpired=true, id=2, credentialNoExpired=true, isEnable=true, username=Admin}
2025-07-16 00:03:54.166 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=USER, permissionEntities=[], id=2}
2025-07-16 00:03:54.168 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:03:54.181 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:03:54.182 INFO  S502.virtualPets.service.PetService : Pet 'AdminPet2' (ID: 9) Updated successfully by the user 'Admin'.
2025-07-16 00:03:54.183 INFO  S.virtualPets.controller.PetController : Pet with ID 9 updated successfully.
2025-07-16 00:03:54.184 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:03:54.185 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=9, name=AdminPet2, type=GOKU, mood=SAD, energyLevel=20, hungerLevel=70, userId=2,  (truncated)...]
2025-07-16 00:03:54.187 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:03:54.188 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:03:55.312 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/9
2025-07-16 00:03:55.321 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/9
2025-07-16 00:03:55.324 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:03:55.327 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:03:55.328 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:03:55.329 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@3a1311a7
2025-07-16 00:03:55.330 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:03:55.331 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:03:55.332 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:03:55.333 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:03:55.335 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:03:55.339 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@735564628 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1569004066 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:03:55.341 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:03:55.343 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:03:55.349 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:03:55.350 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:03:55.352 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/9
2025-07-16 00:03:55.354 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/9", parameters={}
2025-07-16 00:03:55.357 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:03:55.359 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:03:55.362 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=30, hungerLevel=55]]
2025-07-16 00:03:55.363 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:03:55.364 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:03:55.365 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 9. Info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=30, hungerLevel=55]
2025-07-16 00:03:55.365 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:03:55.366 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Admin
2025-07-16 00:03:55.367 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:03:55.414 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:03:55.415 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@e89db42
2025-07-16 00:03:55.415 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:03:55.416 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:03:55.417 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:03:55.418 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:03:55.418 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:03:55.421 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1866292890 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1949825929 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:03:55.423 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:03:55.423 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:03:55.428 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:03:55.766 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:03:55.768 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 9 by the user 'Admin'. info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=30, hungerLevel=55]
2025-07-16 00:03:55.769 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Admin': false
2025-07-16 00:03:55.772 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : pe1_0
2025-07-16 00:03:55.774 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.PetEntity(7))] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity] 
2025-07-16 00:03:55.775 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [org.hibernate.sql.ast.tree.from.LazyTableGroup@5e6b24b3] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity(7).user] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity(7).user] 
2025-07-16 00:03:55.777 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@66e3bdc3
2025-07-16 00:03:55.778 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(7).id) 
2025-07-16 00:03:55.779 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : u1_0
2025-07-16 00:03:55.779 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@edaede
2025-07-16 00:03:55.780 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(7).user(8).id) 
2025-07-16 00:03:55.780 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.PetEntity(7)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).createdAt]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).energyLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).hungerLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).mood]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).name]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).petType]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).updatedAt]
 |  \-EntityDelayedFetchImpl [S502.virtualPets.persistence.entity.PetEntity(7).user]

2025-07-16 00:03:55.781 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (pe1 : S502.virtualPets.persistence.entity.PetEntity(7)) {
          primaryTableReference : pets as pe1_0
          TableGroupJoins {
            left  join LazyTableGroup (u1 : S502.virtualPets.persistence.entity.PetEntity(7).user(8)) {
              primaryTableReference : users as u1_0
            }
          }
        }
      }
    }

2025-07-16 00:03:55.783 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:03:55.783 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 left join users u1_0 on u1_0.id=pe1_0.user_id where pe1_0.id=? and u1_0.id=?
2025-07-16 00:03:56.425 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.PetEntity(7) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(7))@812652902 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.PetEntity))
	  S502.virtualPets.persistence.entity.PetEntity(7).user -> EntityDelayedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(7).user)@574114637 (ToOneAttributeMapping(NavigableRole[S502.virtualPets.persistence.entity.PetEntity.user])@845135647)

2025-07-16 00:03:56.427 DEBUG S502.virtualPets.service.PetService : User 'Admin' updating your pet with ID: 9.
2025-07-16 00:03:56.428 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1524382737<open>)] for JPA transaction
2025-07-16 00:03:56.429 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:03:56.430 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:03:56.430 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:03:56.432 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@3a5e6624]
2025-07-16 00:03:56.433 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:03:56.433 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:03:56.434 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1524382737<open>)]
2025-07-16 00:03:56.434 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:03:56.434 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:03:56.435 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:03:56.435 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#2], was: [S502.virtualPets.persistence.entity.UserEntity.roles#2] (initialized)
2025-07-16 00:03:56.436 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2] (initialized)
2025-07-16 00:03:56.437 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 3 objects
2025-07-16 00:03:56.438 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:03:56.438 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:03:56.438 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-13T18:33:24.527572, mood=SAD, energyLevel=30, hungerLevel=55, petType=GOKU, name=AdminPet2, id=9, user=S502.virtualPets.persistence.entity.UserEntity#2, updatedAt=2025-07-16T00:03:54.167691}
2025-07-16 00:03:57.247 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$KkcMzZCoMiyABijofHR8tOFYDqECJ3Yo68OBc8ar/Q4uFoq1RszYK, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#2], accountNotExpired=true, id=2, credentialNoExpired=true, isEnable=true, username=Admin}
2025-07-16 00:03:57.247 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=USER, permissionEntities=[], id=2}
2025-07-16 00:03:57.248 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:03:57.264 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:03:57.264 INFO  S502.virtualPets.service.PetService : Pet 'AdminPet2' (ID: 9) Updated successfully by the user 'Admin'.
2025-07-16 00:03:57.265 INFO  S.virtualPets.controller.PetController : Pet with ID 9 updated successfully.
2025-07-16 00:03:57.265 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:03:57.266 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=9, name=AdminPet2, type=GOKU, mood=SAD, energyLevel=30, hungerLevel=55, userId=2,  (truncated)...]
2025-07-16 00:03:57.268 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:03:57.271 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:03:58.238 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/9
2025-07-16 00:03:58.242 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:03:58.245 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:03:58.246 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:03:58.248 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@5136291
2025-07-16 00:03:58.249 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:03:58.250 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:03:58.251 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:03:58.252 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:03:58.252 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:03:58.257 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@978396262 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1734987114 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:03:58.259 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:03:58.260 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:03:58.297 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:03:58.298 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:03:58.299 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/9
2025-07-16 00:03:58.300 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/9", parameters={}
2025-07-16 00:03:58.301 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:03:58.302 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:03:58.305 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=40, hungerLevel=40]]
2025-07-16 00:03:58.307 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:03:58.310 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:03:58.311 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 9. Info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=40, hungerLevel=40]
2025-07-16 00:03:58.312 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:03:58.312 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Admin
2025-07-16 00:03:58.314 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:03:58.314 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:03:58.315 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@3291d211
2025-07-16 00:03:58.316 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:03:58.316 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:03:58.317 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:03:58.318 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:03:58.319 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:03:58.324 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@569561979 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1400602325 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:03:58.495 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:03:58.496 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:03:58.499 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:03:58.500 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:03:58.500 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 9 by the user 'Admin'. info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=40, hungerLevel=40]
2025-07-16 00:03:58.500 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Admin': false
2025-07-16 00:03:58.502 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : pe1_0
2025-07-16 00:03:58.503 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.PetEntity(7))] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity] 
2025-07-16 00:03:58.505 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [org.hibernate.sql.ast.tree.from.LazyTableGroup@41e9f873] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity(7).user] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity(7).user] 
2025-07-16 00:03:58.506 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@cc42e96
2025-07-16 00:03:58.508 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(7).id) 
2025-07-16 00:03:58.509 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : u1_0
2025-07-16 00:03:58.510 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@5709ba9d
2025-07-16 00:03:58.510 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(7).user(8).id) 
2025-07-16 00:03:58.511 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.PetEntity(7)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).createdAt]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).energyLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).hungerLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).mood]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).name]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).petType]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).updatedAt]
 |  \-EntityDelayedFetchImpl [S502.virtualPets.persistence.entity.PetEntity(7).user]

2025-07-16 00:03:59.445 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (pe1 : S502.virtualPets.persistence.entity.PetEntity(7)) {
          primaryTableReference : pets as pe1_0
          TableGroupJoins {
            left  join LazyTableGroup (u1 : S502.virtualPets.persistence.entity.PetEntity(7).user(8)) {
              primaryTableReference : users as u1_0
            }
          }
        }
      }
    }

2025-07-16 00:03:59.445 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@6cf1dd12: (connection has passed maxLifetime)
2025-07-16 00:03:59.446 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:03:59.446 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 left join users u1_0 on u1_0.id=pe1_0.user_id where pe1_0.id=? and u1_0.id=?
2025-07-16 00:03:59.450 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Attempting to create/setup new connection (757b1cd9-717e-448c-ac2c-c42dba26917d)
2025-07-16 00:03:59.451 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.PetEntity(7) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(7))@320230707 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.PetEntity))
	  S502.virtualPets.persistence.entity.PetEntity(7).user -> EntityDelayedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(7).user)@2141810866 (ToOneAttributeMapping(NavigableRole[S502.virtualPets.persistence.entity.PetEntity.user])@845135647)

2025-07-16 00:03:59.452 DEBUG S502.virtualPets.service.PetService : User 'Admin' updating your pet with ID: 9.
2025-07-16 00:03:59.453 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1924697961<open>)] for JPA transaction
2025-07-16 00:03:59.454 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:03:59.455 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:03:59.456 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:03:59.459 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@46a04d6c]
2025-07-16 00:03:59.460 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:03:59.461 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:03:59.461 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1924697961<open>)]
2025-07-16 00:03:59.462 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:03:59.484 DEBUG jdk.event.security : X509Certificate: Alg:SHA256withRSA, Serial:02, Subject:CN=MySQL_Server_9.2.0_Auto_Generated_Server_Certificate, Issuer:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Key type:RSA, Length:2048, Cert Id:3807498037, Valid from:20/2/25, 10:36, Valid until:18/2/35, 10:36
2025-07-16 00:03:59.898 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@59780ce is alive
2025-07-16 00:03:59.963 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:03:59.963 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:03:59.963 DEBUG jdk.event.security : X509Certificate: Alg:SHA256withRSA, Serial:01, Subject:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Issuer:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Key type:RSA, Length:2048, Cert Id:3139117285, Valid from:20/2/25, 10:36, Valid until:18/2/35, 10:36
2025-07-16 00:03:59.964 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#2], was: [S502.virtualPets.persistence.entity.UserEntity.roles#2] (initialized)
2025-07-16 00:03:59.965 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2] (initialized)
2025-07-16 00:03:59.965 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 3 objects
2025-07-16 00:03:59.966 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:03:59.967 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:03:59.967 DEBUG jdk.event.security :  TLSHandshake: localhost:3306, TLSv1.3, TLS_AES_128_GCM_SHA256, 3807498037
2025-07-16 00:03:59.967 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-13T18:33:24.527572, mood=SAD, energyLevel=40, hungerLevel=40, petType=GOKU, name=AdminPet2, id=9, user=S502.virtualPets.persistence.entity.UserEntity#2, updatedAt=2025-07-16T00:03:57.248939}
2025-07-16 00:03:59.968 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$KkcMzZCoMiyABijofHR8tOFYDqECJ3Yo68OBc8ar/Q4uFoq1RszYK, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#2], accountNotExpired=true, id=2, credentialNoExpired=true, isEnable=true, username=Admin}
2025-07-16 00:03:59.970 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=USER, permissionEntities=[], id=2}
2025-07-16 00:03:59.973 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:03:59.978 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Established new connection (757b1cd9-717e-448c-ac2c-c42dba26917d)
2025-07-16 00:03:59.979 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@98e358a
2025-07-16 00:03:59.986 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:03:59.987 INFO  S502.virtualPets.service.PetService : Pet 'AdminPet2' (ID: 9) Updated successfully by the user 'Admin'.
2025-07-16 00:04:00.024 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Connection not added, stats (total=10/10, idle=9/10, active=1, waiting=0)
2025-07-16 00:04:00.510 INFO  S.virtualPets.controller.PetController : Pet with ID 9 updated successfully.
2025-07-16 00:04:00.510 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:04:00.511 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=9, name=AdminPet2, type=GOKU, mood=SAD, energyLevel=40, hungerLevel=40, userId=2,  (truncated)...]
2025-07-16 00:04:00.513 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:04:00.514 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@a1cd9e7: (connection was evicted)
2025-07-16 00:04:00.514 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:04:00.516 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Attempting to create/setup new connection (c38c07d8-17f4-40a5-9a3b-c2543db4251b)
2025-07-16 00:04:00.546 DEBUG jdk.event.security : X509Certificate: Alg:SHA256withRSA, Serial:02, Subject:CN=MySQL_Server_9.2.0_Auto_Generated_Server_Certificate, Issuer:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Key type:RSA, Length:2048, Cert Id:3807498037, Valid from:20/2/25, 10:36, Valid until:18/2/35, 10:36
2025-07-16 00:04:00.547 DEBUG jdk.event.security : X509Certificate: Alg:SHA256withRSA, Serial:01, Subject:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Issuer:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Key type:RSA, Length:2048, Cert Id:3139117285, Valid from:20/2/25, 10:36, Valid until:18/2/35, 10:36
2025-07-16 00:04:00.555 DEBUG jdk.event.security :  TLSHandshake: localhost:3306, TLSv1.3, TLS_AES_128_GCM_SHA256, 3807498037
2025-07-16 00:04:00.564 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Established new connection (c38c07d8-17f4-40a5-9a3b-c2543db4251b)
2025-07-16 00:04:00.565 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@48b33fb1
2025-07-16 00:04:01.458 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/9
2025-07-16 00:04:01.466 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/9
2025-07-16 00:04:01.468 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:04:01.471 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:04:01.472 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:04:01.473 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@8648fe5
2025-07-16 00:04:01.474 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:04:01.474 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:04:01.475 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:04:01.477 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:01.477 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:04:01.481 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1117121870 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1511837206 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:04:01.482 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:04:01.482 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:04:01.839 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:04:01.840 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:04:01.841 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/9
2025-07-16 00:04:01.842 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/9", parameters={}
2025-07-16 00:04:01.843 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:04:01.844 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:04:01.848 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=50, hungerLevel=25]]
2025-07-16 00:04:01.849 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:04:01.851 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:04:01.852 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 9. Info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=50, hungerLevel=25]
2025-07-16 00:04:01.853 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:04:01.853 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Admin
2025-07-16 00:04:01.854 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:04:01.855 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:04:01.856 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@61116aa
2025-07-16 00:04:01.857 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:04:01.857 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:04:02.820 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:04:02.822 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:02.823 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:04:02.828 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@181845134 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@632503619 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:04:02.829 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:04:02.830 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:04:02.834 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:04:02.835 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:04:02.836 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 9 by the user 'Admin'. info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=50, hungerLevel=25]
2025-07-16 00:04:02.837 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Admin': false
2025-07-16 00:04:02.839 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : pe1_0
2025-07-16 00:04:02.840 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.PetEntity(7))] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity] 
2025-07-16 00:04:02.841 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [org.hibernate.sql.ast.tree.from.LazyTableGroup@20e7a270] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity(7).user] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity(7).user] 
2025-07-16 00:04:03.647 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@6049351e
2025-07-16 00:04:03.648 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(7).id) 
2025-07-16 00:04:03.649 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : u1_0
2025-07-16 00:04:03.650 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@268b336f
2025-07-16 00:04:03.651 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(7).user(8).id) 
2025-07-16 00:04:03.654 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.PetEntity(7)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).createdAt]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).energyLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).hungerLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).mood]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).name]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).petType]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).updatedAt]
 |  \-EntityDelayedFetchImpl [S502.virtualPets.persistence.entity.PetEntity(7).user]

2025-07-16 00:04:03.655 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (pe1 : S502.virtualPets.persistence.entity.PetEntity(7)) {
          primaryTableReference : pets as pe1_0
          TableGroupJoins {
            left  join LazyTableGroup (u1 : S502.virtualPets.persistence.entity.PetEntity(7).user(8)) {
              primaryTableReference : users as u1_0
            }
          }
        }
      }
    }

2025-07-16 00:04:03.657 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:03.658 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 left join users u1_0 on u1_0.id=pe1_0.user_id where pe1_0.id=? and u1_0.id=?
2025-07-16 00:04:03.663 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.PetEntity(7) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(7))@1102678883 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.PetEntity))
	  S502.virtualPets.persistence.entity.PetEntity(7).user -> EntityDelayedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(7).user)@835517962 (ToOneAttributeMapping(NavigableRole[S502.virtualPets.persistence.entity.PetEntity.user])@845135647)

2025-07-16 00:04:03.664 DEBUG S502.virtualPets.service.PetService : User 'Admin' updating your pet with ID: 9.
2025-07-16 00:04:03.665 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1862410362<open>)] for JPA transaction
2025-07-16 00:04:04.090 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:04:04.091 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:04:04.092 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:04:04.094 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@39e8bf3e]
2025-07-16 00:04:04.095 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:04:04.096 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:04:04.097 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1862410362<open>)]
2025-07-16 00:04:04.097 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:04:04.099 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:04:04.100 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:04:04.100 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#2], was: [S502.virtualPets.persistence.entity.UserEntity.roles#2] (initialized)
2025-07-16 00:04:04.102 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2] (initialized)
2025-07-16 00:04:04.104 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 3 objects
2025-07-16 00:04:04.105 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:04:04.106 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:04:04.106 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-13T18:33:24.527572, mood=SAD, energyLevel=50, hungerLevel=25, petType=GOKU, name=AdminPet2, id=9, user=S502.virtualPets.persistence.entity.UserEntity#2, updatedAt=2025-07-16T00:03:59.972766}
2025-07-16 00:04:04.107 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$KkcMzZCoMiyABijofHR8tOFYDqECJ3Yo68OBc8ar/Q4uFoq1RszYK, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#2], accountNotExpired=true, id=2, credentialNoExpired=true, isEnable=true, username=Admin}
2025-07-16 00:04:04.108 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=USER, permissionEntities=[], id=2}
2025-07-16 00:04:04.109 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:04:04.123 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:04:04.124 INFO  S502.virtualPets.service.PetService : Pet 'AdminPet2' (ID: 9) Updated successfully by the user 'Admin'.
2025-07-16 00:04:04.705 INFO  S.virtualPets.controller.PetController : Pet with ID 9 updated successfully.
2025-07-16 00:04:04.707 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:04:04.708 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=9, name=AdminPet2, type=GOKU, mood=SAD, energyLevel=50, hungerLevel=25, userId=2,  (truncated)...]
2025-07-16 00:04:04.710 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:04:04.712 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:04:05.775 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/9
2025-07-16 00:04:05.777 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:04:05.779 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:04:05.780 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:04:05.781 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@73963dc7
2025-07-16 00:04:05.782 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:04:05.784 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:04:05.785 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:04:05.787 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:05.788 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:04:05.793 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1657425509 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1990021964 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:04:05.794 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:04:05.795 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:04:05.799 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:04:05.800 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:04:05.802 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/9
2025-07-16 00:04:05.804 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/9", parameters={}
2025-07-16 00:04:05.805 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:04:05.806 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:04:05.808 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=60, hungerLevel=10]]
2025-07-16 00:04:05.809 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:04:05.811 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:04:05.811 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 9. Info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=60, hungerLevel=10]
2025-07-16 00:04:05.811 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:04:05.812 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Admin
2025-07-16 00:04:05.813 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:04:05.814 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:04:05.817 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@5eb659b4
2025-07-16 00:04:05.818 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:04:05.819 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:04:05.820 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:04:05.821 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:05.821 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:04:05.914 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@508448746 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@802087835 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:04:05.916 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:04:05.917 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:04:05.921 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:04:05.922 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:04:05.923 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 9 by the user 'Admin'. info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=60, hungerLevel=10]
2025-07-16 00:04:05.923 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Admin': false
2025-07-16 00:04:05.925 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : pe1_0
2025-07-16 00:04:05.925 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.PetEntity(7))] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity] 
2025-07-16 00:04:05.926 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [org.hibernate.sql.ast.tree.from.LazyTableGroup@3718945f] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity(7).user] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity(7).user] 
2025-07-16 00:04:05.928 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@2b30da8d
2025-07-16 00:04:05.929 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(7).id) 
2025-07-16 00:04:05.929 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : u1_0
2025-07-16 00:04:05.930 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@4f97bc81
2025-07-16 00:04:05.931 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(7).user(8).id) 
2025-07-16 00:04:07.027 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.PetEntity(7)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).createdAt]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).energyLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).hungerLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).mood]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).name]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).petType]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).updatedAt]
 |  \-EntityDelayedFetchImpl [S502.virtualPets.persistence.entity.PetEntity(7).user]

2025-07-16 00:04:07.029 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (pe1 : S502.virtualPets.persistence.entity.PetEntity(7)) {
          primaryTableReference : pets as pe1_0
          TableGroupJoins {
            left  join LazyTableGroup (u1 : S502.virtualPets.persistence.entity.PetEntity(7).user(8)) {
              primaryTableReference : users as u1_0
            }
          }
        }
      }
    }

2025-07-16 00:04:07.030 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:07.031 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 left join users u1_0 on u1_0.id=pe1_0.user_id where pe1_0.id=? and u1_0.id=?
2025-07-16 00:04:07.035 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.PetEntity(7) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(7))@382373546 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.PetEntity))
	  S502.virtualPets.persistence.entity.PetEntity(7).user -> EntityDelayedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(7).user)@2130033535 (ToOneAttributeMapping(NavigableRole[S502.virtualPets.persistence.entity.PetEntity.user])@845135647)

2025-07-16 00:04:07.037 DEBUG S502.virtualPets.service.PetService : User 'Admin' updating your pet with ID: 9.
2025-07-16 00:04:07.038 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(29161219<open>)] for JPA transaction
2025-07-16 00:04:07.038 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:04:07.039 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:04:07.039 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:04:07.041 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@52418a08]
2025-07-16 00:04:07.042 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:04:07.929 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:04:07.929 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(29161219<open>)]
2025-07-16 00:04:07.930 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:04:07.931 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:04:07.932 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:04:07.933 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#2], was: [S502.virtualPets.persistence.entity.UserEntity.roles#2] (initialized)
2025-07-16 00:04:07.934 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2] (initialized)
2025-07-16 00:04:07.935 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 3 objects
2025-07-16 00:04:07.936 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:04:07.936 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:04:07.937 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-13T18:33:24.527572, mood=NEUTRAL, energyLevel=60, hungerLevel=10, petType=GOKU, name=AdminPet2, id=9, user=S502.virtualPets.persistence.entity.UserEntity#2, updatedAt=2025-07-16T00:04:04.109790}
2025-07-16 00:04:07.938 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$KkcMzZCoMiyABijofHR8tOFYDqECJ3Yo68OBc8ar/Q4uFoq1RszYK, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#2], accountNotExpired=true, id=2, credentialNoExpired=true, isEnable=true, username=Admin}
2025-07-16 00:04:07.938 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=USER, permissionEntities=[], id=2}
2025-07-16 00:04:07.940 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:04:07.954 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:04:07.955 INFO  S502.virtualPets.service.PetService : Pet 'AdminPet2' (ID: 9) Updated successfully by the user 'Admin'.
2025-07-16 00:04:07.955 INFO  S.virtualPets.controller.PetController : Pet with ID 9 updated successfully.
2025-07-16 00:04:07.956 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:04:07.957 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=9, name=AdminPet2, type=GOKU, mood=NEUTRAL, energyLevel=60, hungerLevel=10, userId (truncated)...]
2025-07-16 00:04:07.959 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:04:07.960 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:04:09.107 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/9
2025-07-16 00:04:09.117 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/9
2025-07-16 00:04:09.120 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:04:09.122 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:04:09.123 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:04:09.124 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@6887a1f0
2025-07-16 00:04:09.124 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:04:09.125 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:04:09.126 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:04:09.127 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:09.127 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:04:09.132 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@661548046 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1223581557 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:04:09.134 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:04:09.134 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:04:09.248 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:04:09.249 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:04:09.251 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/9
2025-07-16 00:04:09.252 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/9", parameters={}
2025-07-16 00:04:09.253 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:04:09.254 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:04:09.255 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=70, hungerLevel=0]]
2025-07-16 00:04:09.256 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:04:09.257 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:04:09.258 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 9. Info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=70, hungerLevel=0]
2025-07-16 00:04:09.258 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:04:09.259 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Admin
2025-07-16 00:04:09.261 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:04:09.262 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:04:09.264 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@3a518339
2025-07-16 00:04:09.265 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:04:09.266 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:04:09.267 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:04:09.750 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:09.751 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:04:09.755 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1967907566 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1554453759 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:04:09.757 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:04:09.757 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:04:09.764 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:04:09.765 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:04:09.766 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 9 by the user 'Admin'. info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=70, hungerLevel=0]
2025-07-16 00:04:09.767 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Admin': false
2025-07-16 00:04:09.768 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : pe1_0
2025-07-16 00:04:09.769 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.PetEntity(7))] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity] 
2025-07-16 00:04:09.769 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [org.hibernate.sql.ast.tree.from.LazyTableGroup@3ac1e059] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity(7).user] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity(7).user] 
2025-07-16 00:04:09.770 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@2043ce03
2025-07-16 00:04:09.771 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(7).id) 
2025-07-16 00:04:10.398 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=9/10, active=1, waiting=0)
2025-07-16 00:04:10.464 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:04:10.465 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : u1_0
2025-07-16 00:04:10.465 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@2bb4d147
2025-07-16 00:04:10.466 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(7).user(8).id) 
2025-07-16 00:04:10.467 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.PetEntity(7)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).createdAt]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).energyLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).hungerLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).mood]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).name]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).petType]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).updatedAt]
 |  \-EntityDelayedFetchImpl [S502.virtualPets.persistence.entity.PetEntity(7).user]

2025-07-16 00:04:10.468 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (pe1 : S502.virtualPets.persistence.entity.PetEntity(7)) {
          primaryTableReference : pets as pe1_0
          TableGroupJoins {
            left  join LazyTableGroup (u1 : S502.virtualPets.persistence.entity.PetEntity(7).user(8)) {
              primaryTableReference : users as u1_0
            }
          }
        }
      }
    }

2025-07-16 00:04:10.469 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:10.470 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 left join users u1_0 on u1_0.id=pe1_0.user_id where pe1_0.id=? and u1_0.id=?
2025-07-16 00:04:10.473 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.PetEntity(7) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(7))@1705385945 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.PetEntity))
	  S502.virtualPets.persistence.entity.PetEntity(7).user -> EntityDelayedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(7).user)@302063171 (ToOneAttributeMapping(NavigableRole[S502.virtualPets.persistence.entity.PetEntity.user])@845135647)

2025-07-16 00:04:10.474 DEBUG S502.virtualPets.service.PetService : User 'Admin' updating your pet with ID: 9.
2025-07-16 00:04:10.475 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1159139104<open>)] for JPA transaction
2025-07-16 00:04:10.476 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:04:11.032 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:04:11.033 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:04:11.035 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@5f7ee2c7]
2025-07-16 00:04:11.036 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:04:11.036 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:04:11.037 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1159139104<open>)]
2025-07-16 00:04:11.037 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:04:11.037 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:04:11.037 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:04:11.038 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#2], was: [S502.virtualPets.persistence.entity.UserEntity.roles#2] (initialized)
2025-07-16 00:04:11.038 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2] (initialized)
2025-07-16 00:04:11.039 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 3 objects
2025-07-16 00:04:11.039 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:04:11.040 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:04:11.040 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-13T18:33:24.527572, mood=NEUTRAL, energyLevel=70, hungerLevel=0, petType=GOKU, name=AdminPet2, id=9, user=S502.virtualPets.persistence.entity.UserEntity#2, updatedAt=2025-07-16T00:04:07.939530}
2025-07-16 00:04:11.041 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$KkcMzZCoMiyABijofHR8tOFYDqECJ3Yo68OBc8ar/Q4uFoq1RszYK, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#2], accountNotExpired=true, id=2, credentialNoExpired=true, isEnable=true, username=Admin}
2025-07-16 00:04:11.041 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=USER, permissionEntities=[], id=2}
2025-07-16 00:04:11.042 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:04:11.057 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:04:11.058 INFO  S502.virtualPets.service.PetService : Pet 'AdminPet2' (ID: 9) Updated successfully by the user 'Admin'.
2025-07-16 00:04:11.058 INFO  S.virtualPets.controller.PetController : Pet with ID 9 updated successfully.
2025-07-16 00:04:11.059 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:04:11.201 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1eebc3dc is alive
2025-07-16 00:04:11.482 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=9, name=AdminPet2, type=GOKU, mood=NEUTRAL, energyLevel=70, hungerLevel=0, userId= (truncated)...]
2025-07-16 00:04:11.484 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:04:11.486 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:04:12.574 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/9
2025-07-16 00:04:12.577 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:04:12.581 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:04:12.582 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:04:12.585 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@32eec64
2025-07-16 00:04:12.585 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:04:12.588 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:04:12.589 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:04:12.591 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:12.592 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:04:12.600 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1155535422 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1276083325 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:04:12.603 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:04:12.604 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:04:12.608 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:04:12.609 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:04:12.611 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/9
2025-07-16 00:04:12.612 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/9", parameters={}
2025-07-16 00:04:12.613 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:04:12.615 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:04:12.618 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=HAPPY, energyLevel=80, hungerLevel=0]]
2025-07-16 00:04:12.619 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:04:12.620 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:04:12.621 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 9. Info: UpdatePetRequestDTO[name=null, mood=HAPPY, energyLevel=80, hungerLevel=0]
2025-07-16 00:04:12.622 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:04:12.622 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Admin
2025-07-16 00:04:12.624 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:04:12.625 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:04:12.757 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@11e7c12b
2025-07-16 00:04:12.758 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:04:12.762 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:04:12.765 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:04:12.767 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:12.768 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:04:12.772 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1946862179 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@484051834 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:04:12.773 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:04:12.774 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:04:12.779 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:04:12.781 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:04:12.804 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@63525b31 is alive
2025-07-16 00:04:13.884 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 9 by the user 'Admin'. info: UpdatePetRequestDTO[name=null, mood=HAPPY, energyLevel=80, hungerLevel=0]
2025-07-16 00:04:13.885 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Admin': false
2025-07-16 00:04:13.886 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : pe1_0
2025-07-16 00:04:13.887 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.PetEntity(7))] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity] 
2025-07-16 00:04:13.887 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [org.hibernate.sql.ast.tree.from.LazyTableGroup@3deb2365] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity(7).user] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity(7).user] 
2025-07-16 00:04:13.888 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@27f099d0
2025-07-16 00:04:13.889 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(7).id) 
2025-07-16 00:04:13.890 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : u1_0
2025-07-16 00:04:13.890 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@5da595dc
2025-07-16 00:04:13.891 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(7).user(8).id) 
2025-07-16 00:04:13.891 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.PetEntity(7)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).createdAt]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).energyLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).hungerLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).mood]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).name]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).petType]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).updatedAt]
 |  \-EntityDelayedFetchImpl [S502.virtualPets.persistence.entity.PetEntity(7).user]

2025-07-16 00:04:13.893 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (pe1 : S502.virtualPets.persistence.entity.PetEntity(7)) {
          primaryTableReference : pets as pe1_0
          TableGroupJoins {
            left  join LazyTableGroup (u1 : S502.virtualPets.persistence.entity.PetEntity(7).user(8)) {
              primaryTableReference : users as u1_0
            }
          }
        }
      }
    }

2025-07-16 00:04:13.895 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:13.896 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 left join users u1_0 on u1_0.id=pe1_0.user_id where pe1_0.id=? and u1_0.id=?
2025-07-16 00:04:14.343 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.PetEntity(7) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(7))@767117996 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.PetEntity))
	  S502.virtualPets.persistence.entity.PetEntity(7).user -> EntityDelayedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(7).user)@558562995 (ToOneAttributeMapping(NavigableRole[S502.virtualPets.persistence.entity.PetEntity.user])@845135647)

2025-07-16 00:04:14.345 DEBUG S502.virtualPets.service.PetService : User 'Admin' updating your pet with ID: 9.
2025-07-16 00:04:14.346 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(95052457<open>)] for JPA transaction
2025-07-16 00:04:14.347 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:04:14.348 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:04:14.348 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:04:14.350 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@7363abc9]
2025-07-16 00:04:14.350 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:04:14.351 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:04:14.351 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(95052457<open>)]
2025-07-16 00:04:14.352 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:04:14.352 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:04:14.353 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:04:14.353 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#2], was: [S502.virtualPets.persistence.entity.UserEntity.roles#2] (initialized)
2025-07-16 00:04:14.354 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2] (initialized)
2025-07-16 00:04:14.354 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 3 objects
2025-07-16 00:04:14.354 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:04:14.355 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:04:14.355 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-13T18:33:24.527572, mood=HAPPY, energyLevel=80, hungerLevel=0, petType=GOKU, name=AdminPet2, id=9, user=S502.virtualPets.persistence.entity.UserEntity#2, updatedAt=2025-07-16T00:04:11.042620}
2025-07-16 00:04:14.951 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$KkcMzZCoMiyABijofHR8tOFYDqECJ3Yo68OBc8ar/Q4uFoq1RszYK, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#2], accountNotExpired=true, id=2, credentialNoExpired=true, isEnable=true, username=Admin}
2025-07-16 00:04:14.952 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=USER, permissionEntities=[], id=2}
2025-07-16 00:04:14.953 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:04:14.968 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:04:14.969 INFO  S502.virtualPets.service.PetService : Pet 'AdminPet2' (ID: 9) Updated successfully by the user 'Admin'.
2025-07-16 00:04:14.969 INFO  S.virtualPets.controller.PetController : Pet with ID 9 updated successfully.
2025-07-16 00:04:14.970 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:04:14.971 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=9, name=AdminPet2, type=GOKU, mood=HAPPY, energyLevel=80, hungerLevel=0, userId=2, (truncated)...]
2025-07-16 00:04:14.972 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:04:14.973 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:04:15.908 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/9
2025-07-16 00:04:15.915 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/9
2025-07-16 00:04:15.918 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:04:15.920 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:04:15.921 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:04:15.922 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@1162444d
2025-07-16 00:04:15.923 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:04:15.924 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:04:15.925 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:04:15.927 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:15.928 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:04:15.933 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@949927843 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1756098438 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:04:15.935 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:04:15.935 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:04:15.984 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:04:15.985 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:04:15.986 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/9
2025-07-16 00:04:15.987 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/9", parameters={}
2025-07-16 00:04:15.988 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:04:15.989 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:04:15.991 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=HAPPY, energyLevel=90, hungerLevel=0]]
2025-07-16 00:04:15.993 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:04:15.994 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:04:15.995 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 9. Info: UpdatePetRequestDTO[name=null, mood=HAPPY, energyLevel=90, hungerLevel=0]
2025-07-16 00:04:15.995 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:04:15.995 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Admin
2025-07-16 00:04:15.996 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:04:15.997 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:04:15.998 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@3b9f5d81
2025-07-16 00:04:15.998 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:04:15.999 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:04:16.000 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:04:16.500 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:16.501 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:04:16.504 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@19194533 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@14370791 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:04:16.505 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:04:16.506 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:04:16.511 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:04:16.512 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:04:16.513 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 9 by the user 'Admin'. info: UpdatePetRequestDTO[name=null, mood=HAPPY, energyLevel=90, hungerLevel=0]
2025-07-16 00:04:16.513 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Admin': false
2025-07-16 00:04:16.515 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : pe1_0
2025-07-16 00:04:16.515 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.PetEntity(7))] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity] 
2025-07-16 00:04:16.516 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [org.hibernate.sql.ast.tree.from.LazyTableGroup@1b094da7] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity(7).user] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity(7).user] 
2025-07-16 00:04:16.516 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@be4108a
2025-07-16 00:04:16.517 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(7).id) 
2025-07-16 00:04:17.264 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : u1_0
2025-07-16 00:04:17.265 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@28d5a6ea
2025-07-16 00:04:17.265 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(7).user(8).id) 
2025-07-16 00:04:17.266 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.PetEntity(7)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).createdAt]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).energyLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).hungerLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).mood]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).name]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).petType]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).updatedAt]
 |  \-EntityDelayedFetchImpl [S502.virtualPets.persistence.entity.PetEntity(7).user]

2025-07-16 00:04:17.267 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (pe1 : S502.virtualPets.persistence.entity.PetEntity(7)) {
          primaryTableReference : pets as pe1_0
          TableGroupJoins {
            left  join LazyTableGroup (u1 : S502.virtualPets.persistence.entity.PetEntity(7).user(8)) {
              primaryTableReference : users as u1_0
            }
          }
        }
      }
    }

2025-07-16 00:04:17.268 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:17.269 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 left join users u1_0 on u1_0.id=pe1_0.user_id where pe1_0.id=? and u1_0.id=?
2025-07-16 00:04:17.273 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.PetEntity(7) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(7))@1299538935 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.PetEntity))
	  S502.virtualPets.persistence.entity.PetEntity(7).user -> EntityDelayedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(7).user)@1395557373 (ToOneAttributeMapping(NavigableRole[S502.virtualPets.persistence.entity.PetEntity.user])@845135647)

2025-07-16 00:04:17.275 DEBUG S502.virtualPets.service.PetService : User 'Admin' updating your pet with ID: 9.
2025-07-16 00:04:17.277 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1289745373<open>)] for JPA transaction
2025-07-16 00:04:17.278 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:04:17.279 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:04:17.279 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:04:18.030 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@6b49a0d0]
2025-07-16 00:04:18.031 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:04:18.032 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:04:18.033 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1289745373<open>)]
2025-07-16 00:04:18.033 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:04:18.034 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:04:18.035 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:04:18.035 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#2], was: [S502.virtualPets.persistence.entity.UserEntity.roles#2] (initialized)
2025-07-16 00:04:18.035 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2] (initialized)
2025-07-16 00:04:18.036 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 3 objects
2025-07-16 00:04:18.036 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:04:18.037 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:04:18.037 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-13T18:33:24.527572, mood=HAPPY, energyLevel=90, hungerLevel=0, petType=GOKU, name=AdminPet2, id=9, user=S502.virtualPets.persistence.entity.UserEntity#2, updatedAt=2025-07-16T00:04:14.953518}
2025-07-16 00:04:18.038 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$KkcMzZCoMiyABijofHR8tOFYDqECJ3Yo68OBc8ar/Q4uFoq1RszYK, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#2], accountNotExpired=true, id=2, credentialNoExpired=true, isEnable=true, username=Admin}
2025-07-16 00:04:18.039 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=USER, permissionEntities=[], id=2}
2025-07-16 00:04:18.043 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:04:18.054 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:04:18.055 INFO  S502.virtualPets.service.PetService : Pet 'AdminPet2' (ID: 9) Updated successfully by the user 'Admin'.
2025-07-16 00:04:18.055 INFO  S.virtualPets.controller.PetController : Pet with ID 9 updated successfully.
2025-07-16 00:04:18.056 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:04:18.058 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=9, name=AdminPet2, type=GOKU, mood=HAPPY, energyLevel=90, hungerLevel=0, userId=2, (truncated)...]
2025-07-16 00:04:19.294 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:04:19.295 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:04:20.326 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/9
2025-07-16 00:04:20.329 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:04:20.331 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:04:20.332 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:04:20.333 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@2f76e9f4
2025-07-16 00:04:20.334 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:04:20.334 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:04:20.336 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:04:20.340 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:20.341 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:04:20.345 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@484468432 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1604184715 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:04:20.347 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:04:20.347 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:04:20.351 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:04:20.352 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:04:20.353 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/9
2025-07-16 00:04:20.353 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/9", parameters={}
2025-07-16 00:04:20.355 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:04:20.355 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:04:20.358 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=HAPPY, energyLevel=100, hungerLevel=0]]
2025-07-16 00:04:20.359 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:04:20.361 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:04:20.361 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 9. Info: UpdatePetRequestDTO[name=null, mood=HAPPY, energyLevel=100, hungerLevel=0]
2025-07-16 00:04:20.361 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:04:20.362 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Admin
2025-07-16 00:04:20.363 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:04:20.415 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:04:20.416 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@435ef84f
2025-07-16 00:04:20.417 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:04:20.418 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:04:20.419 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:04:20.420 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:20.420 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:04:20.425 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@102838767 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@307697887 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:04:20.426 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:04:20.427 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:04:20.431 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:04:21.086 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:04:21.087 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 9 by the user 'Admin'. info: UpdatePetRequestDTO[name=null, mood=HAPPY, energyLevel=100, hungerLevel=0]
2025-07-16 00:04:21.088 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Admin': false
2025-07-16 00:04:21.091 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : pe1_0
2025-07-16 00:04:21.092 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.PetEntity(7))] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity] 
2025-07-16 00:04:21.093 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [org.hibernate.sql.ast.tree.from.LazyTableGroup@2435592] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity(7).user] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity(7).user] 
2025-07-16 00:04:21.097 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@546a8983
2025-07-16 00:04:21.098 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(7).id) 
2025-07-16 00:04:21.099 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : u1_0
2025-07-16 00:04:21.099 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@22fe6a9d
2025-07-16 00:04:21.101 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(7).user(8).id) 
2025-07-16 00:04:21.102 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.PetEntity(7)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).createdAt]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).energyLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).hungerLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).mood]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).name]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).petType]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).updatedAt]
 |  \-EntityDelayedFetchImpl [S502.virtualPets.persistence.entity.PetEntity(7).user]

2025-07-16 00:04:21.107 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (pe1 : S502.virtualPets.persistence.entity.PetEntity(7)) {
          primaryTableReference : pets as pe1_0
          TableGroupJoins {
            left  join LazyTableGroup (u1 : S502.virtualPets.persistence.entity.PetEntity(7).user(8)) {
              primaryTableReference : users as u1_0
            }
          }
        }
      }
    }

2025-07-16 00:04:21.111 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:21.112 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 left join users u1_0 on u1_0.id=pe1_0.user_id where pe1_0.id=? and u1_0.id=?
2025-07-16 00:04:21.701 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.PetEntity(7) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(7))@1765766672 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.PetEntity))
	  S502.virtualPets.persistence.entity.PetEntity(7).user -> EntityDelayedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(7).user)@1280320318 (ToOneAttributeMapping(NavigableRole[S502.virtualPets.persistence.entity.PetEntity.user])@845135647)

2025-07-16 00:04:21.702 DEBUG S502.virtualPets.service.PetService : User 'Admin' updating your pet with ID: 9.
2025-07-16 00:04:21.703 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(2140518964<open>)] for JPA transaction
2025-07-16 00:04:21.704 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:04:21.705 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:04:21.706 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:04:21.709 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@32112f2b]
2025-07-16 00:04:21.710 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:04:21.711 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:04:21.711 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(2140518964<open>)]
2025-07-16 00:04:21.711 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:04:21.712 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:04:21.713 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:04:21.713 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#2], was: [S502.virtualPets.persistence.entity.UserEntity.roles#2] (initialized)
2025-07-16 00:04:21.714 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2] (initialized)
2025-07-16 00:04:21.715 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 3 objects
2025-07-16 00:04:21.715 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:04:21.716 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:04:21.716 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-13T18:33:24.527572, mood=HAPPY, energyLevel=100, hungerLevel=0, petType=GOKU, name=AdminPet2, id=9, user=S502.virtualPets.persistence.entity.UserEntity#2, updatedAt=2025-07-16T00:04:18.042897}
2025-07-16 00:04:22.542 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$KkcMzZCoMiyABijofHR8tOFYDqECJ3Yo68OBc8ar/Q4uFoq1RszYK, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#2], accountNotExpired=true, id=2, credentialNoExpired=true, isEnable=true, username=Admin}
2025-07-16 00:04:22.543 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=USER, permissionEntities=[], id=2}
2025-07-16 00:04:22.544 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:04:22.558 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:04:22.558 INFO  S502.virtualPets.service.PetService : Pet 'AdminPet2' (ID: 9) Updated successfully by the user 'Admin'.
2025-07-16 00:04:22.559 INFO  S.virtualPets.controller.PetController : Pet with ID 9 updated successfully.
2025-07-16 00:04:22.560 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:04:22.560 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=9, name=AdminPet2, type=GOKU, mood=HAPPY, energyLevel=100, hungerLevel=0, userId=2 (truncated)...]
2025-07-16 00:04:22.562 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:04:22.563 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:04:22.895 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@64aff3bb is alive
2025-07-16 00:04:24.295 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/9
2025-07-16 00:04:24.301 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/9
2025-07-16 00:04:24.306 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:04:24.310 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:04:24.311 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:04:24.313 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@4a82d5a5
2025-07-16 00:04:24.314 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:04:24.315 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:04:24.316 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:04:24.318 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:24.319 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:04:24.323 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@102086369 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1093420939 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:04:24.324 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:04:24.325 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:04:24.364 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1e943acb is alive
2025-07-16 00:04:24.368 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:04:24.369 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:04:24.370 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/9
2025-07-16 00:04:24.370 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/9", parameters={}
2025-07-16 00:04:24.371 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:04:24.372 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:04:24.374 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=HAPPY, energyLevel=100, hungerLevel=0]]
2025-07-16 00:04:24.376 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:04:24.377 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:04:24.378 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 9. Info: UpdatePetRequestDTO[name=null, mood=HAPPY, energyLevel=100, hungerLevel=0]
2025-07-16 00:04:24.379 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:04:24.380 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Admin
2025-07-16 00:04:24.383 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:04:24.384 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:04:24.385 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@1e6c958c
2025-07-16 00:04:24.386 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:04:24.387 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:04:25.128 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:04:25.130 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:25.131 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:04:25.137 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@428184806 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@293498226 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:04:25.138 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:04:25.139 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:04:25.143 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2]
2025-07-16 00:04:25.144 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#2]
2025-07-16 00:04:25.144 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 9 by the user 'Admin'. info: UpdatePetRequestDTO[name=null, mood=HAPPY, energyLevel=100, hungerLevel=0]
2025-07-16 00:04:25.145 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Admin': false
2025-07-16 00:04:25.147 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : pe1_0
2025-07-16 00:04:25.148 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.PetEntity(7))] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity] 
2025-07-16 00:04:25.149 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [org.hibernate.sql.ast.tree.from.LazyTableGroup@28745928] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity(7).user] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity(7).user] 
2025-07-16 00:04:25.151 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@38d94912
2025-07-16 00:04:26.022 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(7).id) 
2025-07-16 00:04:26.023 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : u1_0
2025-07-16 00:04:26.025 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@6f621496
2025-07-16 00:04:26.026 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(7).user(8).id) 
2025-07-16 00:04:26.026 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.PetEntity(7)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).createdAt]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).energyLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).hungerLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).mood]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).name]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).petType]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(7).updatedAt]
 |  \-EntityDelayedFetchImpl [S502.virtualPets.persistence.entity.PetEntity(7).user]

2025-07-16 00:04:26.027 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (pe1 : S502.virtualPets.persistence.entity.PetEntity(7)) {
          primaryTableReference : pets as pe1_0
          TableGroupJoins {
            left  join LazyTableGroup (u1 : S502.virtualPets.persistence.entity.PetEntity(7).user(8)) {
              primaryTableReference : users as u1_0
            }
          }
        }
      }
    }

2025-07-16 00:04:26.029 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:26.030 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 left join users u1_0 on u1_0.id=pe1_0.user_id where pe1_0.id=? and u1_0.id=?
2025-07-16 00:04:26.034 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.PetEntity(7) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(7))@2021455368 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.PetEntity))
	  S502.virtualPets.persistence.entity.PetEntity(7).user -> EntityDelayedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(7).user)@778583711 (ToOneAttributeMapping(NavigableRole[S502.virtualPets.persistence.entity.PetEntity.user])@845135647)

2025-07-16 00:04:26.036 DEBUG S502.virtualPets.service.PetService : User 'Admin' updating your pet with ID: 9.
2025-07-16 00:04:26.037 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(101350537<open>)] for JPA transaction
2025-07-16 00:04:26.038 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:04:26.039 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:04:26.790 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:04:26.793 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@69f93611]
2025-07-16 00:04:26.794 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:04:26.795 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:04:26.795 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(101350537<open>)]
2025-07-16 00:04:26.796 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:04:26.796 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:04:26.797 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:04:26.797 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#2], was: [S502.virtualPets.persistence.entity.UserEntity.roles#2] (initialized)
2025-07-16 00:04:26.798 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#2] (initialized)
2025-07-16 00:04:26.799 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 0 updates, 0 deletions to 3 objects
2025-07-16 00:04:26.799 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:04:26.800 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:04:26.801 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-13T18:33:24.527572, mood=HAPPY, energyLevel=100, hungerLevel=0, petType=GOKU, name=AdminPet2, id=9, user=S502.virtualPets.persistence.entity.UserEntity#2, updatedAt=2025-07-16T00:04:22.544241}
2025-07-16 00:04:26.801 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$KkcMzZCoMiyABijofHR8tOFYDqECJ3Yo68OBc8ar/Q4uFoq1RszYK, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#2], accountNotExpired=true, id=2, credentialNoExpired=true, isEnable=true, username=Admin}
2025-07-16 00:04:26.802 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=USER, permissionEntities=[], id=2}
2025-07-16 00:04:26.807 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:04:26.808 INFO  S502.virtualPets.service.PetService : Pet 'AdminPet2' (ID: 9) Updated successfully by the user 'Admin'.
2025-07-16 00:04:26.808 INFO  S.virtualPets.controller.PetController : Pet with ID 9 updated successfully.
2025-07-16 00:04:26.809 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:04:26.811 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=9, name=AdminPet2, type=GOKU, mood=HAPPY, energyLevel=100, hungerLevel=0, userId=2 (truncated)...]
2025-07-16 00:04:26.814 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:04:27.244 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:04:38.903 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /auth/log-in
2025-07-16 00:04:38.910 DEBUG o.s.security.web.FilterChainProxy : Securing POST /auth/log-in
2025-07-16 00:04:38.912 DEBUG o.s.s.w.a.AnonymousAuthenticationFilter : Set SecurityContextHolder to anonymous SecurityContext
2025-07-16 00:04:38.914 DEBUG o.s.security.web.FilterChainProxy : Secured POST /auth/log-in
2025-07-16 00:04:38.914 DEBUG o.s.web.servlet.DispatcherServlet : POST "/auth/log-in", parameters={}
2025-07-16 00:04:38.915 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.AuthenticationController#login(AuthLoginRequestDTO)
2025-07-16 00:04:38.915 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:04:38.918 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [AuthLoginRequestDTO[username=Sergio, password=1234]]
2025-07-16 00:04:38.926 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:04:38.928 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:04:38.929 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@4a0528f5
2025-07-16 00:04:38.930 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:04:38.930 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:04:38.931 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:04:38.932 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:38.932 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:04:38.934 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@41398130 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@100434799 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:04:38.935 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:04:38.936 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:04:38.981 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:04:38.982 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:04:39.154 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:04:39.157 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [AuthResponseDTO[username=Sergio, message=User logged successfully, jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6I (truncated)...]
2025-07-16 00:04:39.160 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:04:39.162 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:04:39.201 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/my-pets
2025-07-16 00:04:39.210 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/my-pets
2025-07-16 00:04:39.212 DEBUG o.s.security.web.FilterChainProxy : Securing GET /api/pets/my-pets
2025-07-16 00:04:39.215 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:04:39.217 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:04:39.218 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:04:39.219 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@66837023
2025-07-16 00:04:39.220 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:04:39.221 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:04:39.222 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:04:39.223 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:39.555 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:04:39.558 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@961502045 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@66466054 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:04:39.560 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:04:39.561 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:04:39.564 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:04:39.564 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:04:39.565 DEBUG o.s.security.web.FilterChainProxy : Secured GET /api/pets/my-pets
2025-07-16 00:04:39.565 DEBUG o.s.web.servlet.DispatcherServlet : GET "/api/pets/my-pets", parameters={}
2025-07-16 00:04:39.566 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#getMyPets()
2025-07-16 00:04:39.566 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:04:39.567 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.getMyPets(); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:04:39.567 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.getMyPets(); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:04:39.568 INFO  S.virtualPets.controller.PetController : GET petition received to obtain the authenticated user pets
2025-07-16 00:04:39.568 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:04:39.568 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:04:39.569 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:04:39.570 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:04:40.474 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:04:40.504 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:04:40.505 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@c027191
2025-07-16 00:04:40.506 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:04:40.508 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:04:40.509 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:04:40.510 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:40.510 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:04:40.513 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1662749304 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1021345666 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:04:40.514 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:04:40.515 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:04:40.518 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:04:40.851 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:04:40.852 INFO  S502.virtualPets.service.PetService : Request to obtain user pets 'Sergio'.
2025-07-16 00:04:40.853 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : pe1_0
2025-07-16 00:04:40.853 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.PetEntity(11))] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity] 
2025-07-16 00:04:40.854 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [org.hibernate.sql.ast.tree.from.LazyTableGroup@2cb94712] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity(11).user] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity(11).user] 
2025-07-16 00:04:40.855 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : u1_0
2025-07-16 00:04:40.856 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@715e0514
2025-07-16 00:04:40.856 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(11).user(12).id) 
2025-07-16 00:04:40.857 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.PetEntity(11)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).createdAt]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).energyLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).hungerLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).mood]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).name]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).petType]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).updatedAt]
 |  \-EntityDelayedFetchImpl [S502.virtualPets.persistence.entity.PetEntity(11).user]

2025-07-16 00:04:40.858 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (pe1 : S502.virtualPets.persistence.entity.PetEntity(11)) {
          primaryTableReference : pets as pe1_0
          TableGroupJoins {
            left  join LazyTableGroup (u1 : S502.virtualPets.persistence.entity.PetEntity(11).user(12)) {
              primaryTableReference : users as u1_0
            }
          }
        }
      }
    }

2025-07-16 00:04:40.860 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:40.860 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 left join users u1_0 on u1_0.id=pe1_0.user_id where u1_0.id=?
2025-07-16 00:04:40.863 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.PetEntity(11).user -> EntityDelayedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(11).user)@417862553 (ToOneAttributeMapping(NavigableRole[S502.virtualPets.persistence.entity.PetEntity.user])@845135647)
	  S502.virtualPets.persistence.entity.PetEntity(11) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(11))@1472100406 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.PetEntity))

2025-07-16 00:04:41.378 INFO  S502.virtualPets.service.PetService : They recovered 4 User pets 'Sergio'.
2025-07-16 00:04:41.378 INFO  S.virtualPets.controller.PetController : Returned 4 Pets for the current user.
2025-07-16 00:04:41.379 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:04:41.379 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [[PetResponseDTO[id=6, name=petx, type=GOKU, mood=NEUTRAL, energyLevel=75, hungerLevel=0, userId=1, u (truncated)...]
2025-07-16 00:04:41.381 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:04:41.381 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:04:41.386 DEBUG o.s.security.web.FilterChainProxy : Securing GET /api/pets/my-pets
2025-07-16 00:04:41.387 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:04:41.390 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:04:41.393 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:04:41.393 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@571f7869
2025-07-16 00:04:41.394 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:04:41.394 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:04:41.395 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:04:41.396 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:41.397 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:04:42.010 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1352108958 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1077180617 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:04:42.011 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:04:42.012 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:04:42.016 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:04:42.017 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:04:42.018 DEBUG o.s.security.web.FilterChainProxy : Secured GET /api/pets/my-pets
2025-07-16 00:04:42.021 DEBUG o.s.web.servlet.DispatcherServlet : GET "/api/pets/my-pets", parameters={}
2025-07-16 00:04:42.023 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#getMyPets()
2025-07-16 00:04:42.023 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:04:42.024 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.getMyPets(); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:04:42.025 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.getMyPets(); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:04:42.026 INFO  S.virtualPets.controller.PetController : GET petition received to obtain the authenticated user pets
2025-07-16 00:04:42.026 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:04:42.027 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:04:42.028 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:04:42.029 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:04:42.029 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@b570633
2025-07-16 00:04:42.566 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:04:42.567 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:04:42.568 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:04:42.569 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:42.569 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:04:42.574 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@381023080 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@657705652 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:04:42.575 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:04:42.576 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:04:42.580 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:04:42.580 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:04:42.581 INFO  S502.virtualPets.service.PetService : Request to obtain user pets 'Sergio'.
2025-07-16 00:04:42.582 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : pe1_0
2025-07-16 00:04:42.583 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.PetEntity(11))] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity] 
2025-07-16 00:04:43.193 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [org.hibernate.sql.ast.tree.from.LazyTableGroup@6f0aa7c7] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity(11).user] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity(11).user] 
2025-07-16 00:04:43.194 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : u1_0
2025-07-16 00:04:43.194 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@670a629a
2025-07-16 00:04:43.195 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(11).user(12).id) 
2025-07-16 00:04:43.195 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.PetEntity(11)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).createdAt]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).energyLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).hungerLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).mood]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).name]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).petType]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).updatedAt]
 |  \-EntityDelayedFetchImpl [S502.virtualPets.persistence.entity.PetEntity(11).user]

2025-07-16 00:04:43.196 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (pe1 : S502.virtualPets.persistence.entity.PetEntity(11)) {
          primaryTableReference : pets as pe1_0
          TableGroupJoins {
            left  join LazyTableGroup (u1 : S502.virtualPets.persistence.entity.PetEntity(11).user(12)) {
              primaryTableReference : users as u1_0
            }
          }
        }
      }
    }

2025-07-16 00:04:43.197 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:43.198 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 left join users u1_0 on u1_0.id=pe1_0.user_id where u1_0.id=?
2025-07-16 00:04:43.201 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.PetEntity(11).user -> EntityDelayedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(11).user)@901552833 (ToOneAttributeMapping(NavigableRole[S502.virtualPets.persistence.entity.PetEntity.user])@845135647)
	  S502.virtualPets.persistence.entity.PetEntity(11) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(11))@369090336 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.PetEntity))

2025-07-16 00:04:43.203 INFO  S502.virtualPets.service.PetService : They recovered 4 User pets 'Sergio'.
2025-07-16 00:04:43.204 INFO  S.virtualPets.controller.PetController : Returned 4 Pets for the current user.
2025-07-16 00:04:43.205 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:04:44.100 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [[PetResponseDTO[id=6, name=petx, type=GOKU, mood=NEUTRAL, energyLevel=75, hungerLevel=0, userId=1, u (truncated)...]
2025-07-16 00:04:44.102 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:04:44.104 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:04:46.870 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/13
2025-07-16 00:04:46.884 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:04:46.888 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:04:46.892 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:04:46.893 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:04:46.894 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@27b9d794
2025-07-16 00:04:46.895 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:04:46.896 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:04:46.897 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:04:46.898 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:46.898 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:04:46.902 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1308528212 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@817449754 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:04:46.903 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:04:46.903 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:04:46.907 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:04:46.955 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:04:46.956 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:04:46.957 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:04:46.958 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:04:46.959 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:04:46.961 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=HAPPY, energyLevel=100, hungerLevel=0]]
2025-07-16 00:04:46.963 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:04:46.964 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:04:46.965 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=HAPPY, energyLevel=100, hungerLevel=0]
2025-07-16 00:04:46.965 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:04:46.965 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:04:46.967 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:04:46.969 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:04:46.971 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@1bffcebe
2025-07-16 00:04:46.972 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:04:46.974 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:04:46.975 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:04:47.271 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:04:47.272 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:04:47.275 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@271614780 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@918628260 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:04:47.277 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:04:47.277 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:04:47.281 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:04:47.282 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:04:47.282 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=HAPPY, energyLevel=100, hungerLevel=0]
2025-07-16 00:04:47.283 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:04:47.283 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(281182329<open>)] for JPA transaction
2025-07-16 00:04:47.284 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:04:47.285 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@552094663 wrapping com.mysql.cj.jdbc.ConnectionImpl@4208a94e] read-only
2025-07-16 00:04:47.287 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:04:47.288 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:04:47.290 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@7a9847ca]
2025-07-16 00:04:47.292 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:04:47.864 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:04:47.868 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:04:47.869 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(281182329<open>)]
2025-07-16 00:04:47.870 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:04:47.874 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@552094663 wrapping com.mysql.cj.jdbc.ConnectionImpl@4208a94e]
2025-07-16 00:04:47.876 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:04:47.876 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:04:47.877 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(281182329<open>)] for JPA transaction
2025-07-16 00:04:47.877 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:04:47.878 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:04:47.879 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@585e6c8]
2025-07-16 00:04:47.880 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:04:47.881 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:04:47.881 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(281182329<open>)]
2025-07-16 00:04:47.882 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:04:47.882 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:04:47.883 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:04:47.884 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:04:47.885 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:04:47.886 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:04:47.886 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:04:47.887 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:04:47.888 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:04:48.555 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:04:48.556 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:04:48.556 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:04:48.557 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:04:48.557 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:04:48.558 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=HAPPY, energyLevel=100, hungerLevel=0, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-15T23:22:56.665095}
2025-07-16 00:04:48.560 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:04:48.574 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:04:48.575 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:04:48.575 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:04:48.576 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:04:48.576 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=HAPPY, energyLevel=100, hungerLevel=0, userId=1, use (truncated)...]
2025-07-16 00:04:48.578 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:04:48.578 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:04:53.842 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@5a13b511 is alive
2025-07-16 00:05:10.520 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:05:10.521 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:05:26.627 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@7b2c99ca is alive
2025-07-16 00:05:31.478 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@4208a94e is alive
2025-07-16 00:05:40.529 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:05:40.530 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:05:42.041 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@98e358a is alive
2025-07-16 00:05:47.988 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1eebc3dc is alive
2025-07-16 00:05:54.177 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@59780ce is alive
2025-07-16 00:05:58.167 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@63525b31 is alive
2025-07-16 00:05:59.957 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@48b33fb1 is alive
2025-07-16 00:06:01.078 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1e943acb is alive
2025-07-16 00:06:07.513 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@64aff3bb is alive
2025-07-16 00:06:10.538 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:06:10.539 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:06:34.174 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/16
2025-07-16 00:06:34.185 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/16
2025-07-16 00:06:34.187 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:06:34.194 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:06:34.194 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:06:34.196 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@65c35f06
2025-07-16 00:06:34.196 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:06:34.199 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:06:34.200 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:06:34.201 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:06:34.202 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:06:34.207 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1007918869 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1686478465 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:06:34.209 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:06:34.210 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:06:34.214 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:06:34.215 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:06:34.216 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/16
2025-07-16 00:06:34.217 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/16", parameters={}
2025-07-16 00:06:34.218 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:06:34.219 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:06:34.223 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=70, hungerLevel=80]]
2025-07-16 00:06:34.592 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:06:34.594 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:06:34.595 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 16. Info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=70, hungerLevel=80]
2025-07-16 00:06:34.595 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:06:34.595 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:06:34.597 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:06:34.597 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:06:34.598 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@6d0592a4
2025-07-16 00:06:34.599 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:06:34.599 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:06:34.600 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:06:34.601 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:06:34.601 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:06:34.605 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1976893346 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@100024573 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:06:35.158 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:06:35.158 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:06:35.162 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:06:35.162 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:06:35.163 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 16 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=70, hungerLevel=80]
2025-07-16 00:06:35.164 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:06:35.164 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(884969116<open>)] for JPA transaction
2025-07-16 00:06:35.165 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:06:35.165 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1490188849 wrapping com.mysql.cj.jdbc.ConnectionImpl@4208a94e] read-only
2025-07-16 00:06:35.167 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:06:35.167 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:06:35.169 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@12d5be27]
2025-07-16 00:06:35.170 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:06:35.171 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:06:35.175 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:06:35.176 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(884969116<open>)]
2025-07-16 00:06:35.177 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:06:35.179 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1490188849 wrapping com.mysql.cj.jdbc.ConnectionImpl@4208a94e]
2025-07-16 00:06:36.089 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:06:36.090 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 16.
2025-07-16 00:06:36.091 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(884969116<open>)] for JPA transaction
2025-07-16 00:06:36.092 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:06:36.092 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:06:36.094 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@5258be95]
2025-07-16 00:06:36.095 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:06:36.095 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:06:36.096 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(884969116<open>)]
2025-07-16 00:06:36.096 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:06:36.097 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:06:36.097 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:06:36.098 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:06:36.098 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:06:36.099 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:06:36.099 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:06:36.099 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:06:36.100 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:06:36.100 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:06:36.100 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T22:48:42.167443, mood=ANGRY, energyLevel=70, hungerLevel=80, petType=FREZER, name=XX, id=16, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-15T23:34:12.291851}
2025-07-16 00:06:36.101 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:06:36.432 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:06:36.432 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:06:36.432 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:06:36.434 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:06:36.447 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:06:36.448 INFO  S502.virtualPets.service.PetService : Pet 'XX' (ID: 16) Updated successfully by the user 'Sergio'.
2025-07-16 00:06:36.449 INFO  S.virtualPets.controller.PetController : Pet with ID 16 updated successfully.
2025-07-16 00:06:36.449 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:06:36.450 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=16, name=XX, type=FREZER, mood=ANGRY, energyLevel=70, hungerLevel=80, userId=1, us (truncated)...]
2025-07-16 00:06:36.453 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:06:36.456 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:06:38.349 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/16
2025-07-16 00:06:38.351 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:06:38.354 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:06:38.355 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:06:38.356 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@55cdc641
2025-07-16 00:06:38.357 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:06:38.358 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:06:38.359 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:06:38.360 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:06:38.361 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:06:38.366 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1528709728 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1269397617 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:06:38.368 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:06:38.368 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:06:38.372 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:06:38.373 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:06:38.374 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/16
2025-07-16 00:06:38.375 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/16", parameters={}
2025-07-16 00:06:38.375 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:06:38.376 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:06:38.379 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=80, hungerLevel=65]]
2025-07-16 00:06:38.381 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:06:38.382 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:06:38.382 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 16. Info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=80, hungerLevel=65]
2025-07-16 00:06:38.383 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:06:38.383 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:06:38.384 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:06:38.384 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:06:38.396 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@38ea5424
2025-07-16 00:06:38.397 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:06:38.398 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:06:38.399 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:06:38.400 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:06:38.400 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:06:38.403 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1466773720 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1657193803 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:06:38.406 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:06:38.407 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:06:38.410 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:06:38.411 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:06:38.819 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 16 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=80, hungerLevel=65]
2025-07-16 00:06:38.820 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:06:38.821 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1030753675<open>)] for JPA transaction
2025-07-16 00:06:38.821 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:06:38.821 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@969130912 wrapping com.mysql.cj.jdbc.ConnectionImpl@4208a94e] read-only
2025-07-16 00:06:38.823 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:06:38.824 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:06:38.827 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@afd1071]
2025-07-16 00:06:38.828 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:06:38.829 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:06:38.832 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:06:38.833 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1030753675<open>)]
2025-07-16 00:06:38.833 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:06:38.835 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@969130912 wrapping com.mysql.cj.jdbc.ConnectionImpl@4208a94e]
2025-07-16 00:06:38.837 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:06:38.838 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 16.
2025-07-16 00:06:38.839 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1030753675<open>)] for JPA transaction
2025-07-16 00:06:38.839 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:06:38.840 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:06:38.841 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@125fef2e]
2025-07-16 00:06:38.842 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:06:39.445 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:06:39.446 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1030753675<open>)]
2025-07-16 00:06:39.446 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:06:39.447 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:06:39.447 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:06:39.448 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:06:39.448 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:06:39.449 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:06:39.450 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:06:39.450 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:06:39.450 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:06:39.451 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:06:39.451 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T22:48:42.167443, mood=ANGRY, energyLevel=80, hungerLevel=65, petType=FREZER, name=XX, id=16, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:06:36.433678}
2025-07-16 00:06:39.452 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:06:39.453 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:06:39.453 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:06:39.454 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:06:39.455 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:06:39.469 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:06:39.470 INFO  S502.virtualPets.service.PetService : Pet 'XX' (ID: 16) Updated successfully by the user 'Sergio'.
2025-07-16 00:06:39.470 INFO  S.virtualPets.controller.PetController : Pet with ID 16 updated successfully.
2025-07-16 00:06:39.932 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:06:39.933 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=16, name=XX, type=FREZER, mood=ANGRY, energyLevel=80, hungerLevel=65, userId=1, us (truncated)...]
2025-07-16 00:06:39.935 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:06:39.937 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:06:40.552 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:06:40.552 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:06:40.917 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/16
2025-07-16 00:06:40.927 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/16
2025-07-16 00:06:40.931 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:06:40.937 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:06:40.938 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:06:40.939 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@6b48f26d
2025-07-16 00:06:40.940 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:06:40.941 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:06:40.943 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:06:40.944 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:06:40.944 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:06:40.948 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@489781232 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@2071712355 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:06:40.949 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:06:40.950 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:06:40.955 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:06:40.956 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:06:40.958 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/16
2025-07-16 00:06:40.959 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/16", parameters={}
2025-07-16 00:06:40.959 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:06:40.960 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:06:40.961 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=90, hungerLevel=50]]
2025-07-16 00:06:40.963 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:06:40.964 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:06:40.965 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 16. Info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=90, hungerLevel=50]
2025-07-16 00:06:41.319 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:06:41.319 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:06:41.321 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:06:41.322 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:06:41.323 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@15af9c44
2025-07-16 00:06:41.323 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:06:41.324 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:06:41.325 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:06:41.325 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:06:41.326 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:06:41.328 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@2057949805 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@143934040 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:06:41.329 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:06:41.330 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:06:42.027 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:06:42.028 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:06:42.029 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 16 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=90, hungerLevel=50]
2025-07-16 00:06:42.030 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:06:42.031 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(379198152<open>)] for JPA transaction
2025-07-16 00:06:42.032 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:06:42.032 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@881371855 wrapping com.mysql.cj.jdbc.ConnectionImpl@4208a94e] read-only
2025-07-16 00:06:42.035 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:06:42.036 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:06:42.038 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@17038c2d]
2025-07-16 00:06:42.039 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:06:42.040 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:06:42.043 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:06:42.043 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(379198152<open>)]
2025-07-16 00:06:42.044 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:06:42.046 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@881371855 wrapping com.mysql.cj.jdbc.ConnectionImpl@4208a94e]
2025-07-16 00:06:42.048 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:06:42.049 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 16.
2025-07-16 00:06:42.050 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(379198152<open>)] for JPA transaction
2025-07-16 00:06:42.050 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:06:42.051 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:06:42.053 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@2bcb1fd1]
2025-07-16 00:06:42.660 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:06:42.662 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:06:42.662 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(379198152<open>)]
2025-07-16 00:06:42.663 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:06:42.664 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:06:42.665 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:06:42.665 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:06:42.666 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:06:42.668 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:06:42.668 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:06:42.669 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:06:42.669 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:06:42.670 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:06:42.670 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T22:48:42.167443, mood=ANGRY, energyLevel=90, hungerLevel=50, petType=FREZER, name=XX, id=16, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:06:39.455022}
2025-07-16 00:06:42.671 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:06:42.671 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:06:42.671 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:06:42.671 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:06:42.673 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:06:42.688 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:06:43.105 INFO  S502.virtualPets.service.PetService : Pet 'XX' (ID: 16) Updated successfully by the user 'Sergio'.
2025-07-16 00:06:43.105 INFO  S.virtualPets.controller.PetController : Pet with ID 16 updated successfully.
2025-07-16 00:06:43.106 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:06:43.107 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=16, name=XX, type=FREZER, mood=ANGRY, energyLevel=90, hungerLevel=50, userId=1, us (truncated)...]
2025-07-16 00:06:43.109 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:06:43.110 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:06:44.109 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/16
2025-07-16 00:06:44.113 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:06:44.115 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:06:44.116 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:06:44.117 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@24ab8edc
2025-07-16 00:06:44.118 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:06:44.120 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:06:44.121 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:06:44.122 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:06:44.123 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:06:44.127 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1581194108 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1818529231 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:06:44.129 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:06:44.130 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:06:44.134 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:06:44.135 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:06:44.137 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/16
2025-07-16 00:06:44.138 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/16", parameters={}
2025-07-16 00:06:44.139 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:06:44.139 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:06:44.141 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=100, hungerLevel=35]]
2025-07-16 00:06:44.142 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:06:44.143 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:06:44.144 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 16. Info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=100, hungerLevel=35]
2025-07-16 00:06:44.144 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:06:44.145 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:06:44.146 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:06:44.147 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:06:44.148 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@42c516b8
2025-07-16 00:06:44.149 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:06:44.150 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:06:44.151 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:06:44.152 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:06:44.184 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:06:44.187 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@340030557 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@2039527207 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:06:44.188 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:06:44.189 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:06:44.192 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:06:44.193 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:06:44.194 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 16 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=100, hungerLevel=35]
2025-07-16 00:06:44.194 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:06:44.194 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(923342684<open>)] for JPA transaction
2025-07-16 00:06:44.195 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:06:44.195 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@269304304 wrapping com.mysql.cj.jdbc.ConnectionImpl@4208a94e] read-only
2025-07-16 00:06:44.197 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:06:44.198 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:06:44.201 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@7faf4cdb]
2025-07-16 00:06:44.202 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:06:44.203 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:06:44.686 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:06:44.686 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(923342684<open>)]
2025-07-16 00:06:44.687 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:06:44.689 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@269304304 wrapping com.mysql.cj.jdbc.ConnectionImpl@4208a94e]
2025-07-16 00:06:44.691 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:06:44.692 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 16.
2025-07-16 00:06:44.693 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(923342684<open>)] for JPA transaction
2025-07-16 00:06:44.693 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:06:44.694 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:06:44.695 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@21bd368d]
2025-07-16 00:06:44.697 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:06:44.698 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:06:44.698 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(923342684<open>)]
2025-07-16 00:06:44.699 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:06:44.699 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:06:44.700 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:06:44.701 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:06:44.703 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:06:44.704 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:06:44.706 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:06:44.706 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:06:44.707 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:06:45.333 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:06:45.334 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T22:48:42.167443, mood=ANGRY, energyLevel=100, hungerLevel=35, petType=FREZER, name=XX, id=16, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:06:42.672631}
2025-07-16 00:06:45.335 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:06:45.335 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:06:45.336 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:06:45.336 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:06:45.337 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:06:45.351 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:06:45.351 INFO  S502.virtualPets.service.PetService : Pet 'XX' (ID: 16) Updated successfully by the user 'Sergio'.
2025-07-16 00:06:45.352 INFO  S.virtualPets.controller.PetController : Pet with ID 16 updated successfully.
2025-07-16 00:06:45.353 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:06:45.353 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=16, name=XX, type=FREZER, mood=ANGRY, energyLevel=100, hungerLevel=35, userId=1, u (truncated)...]
2025-07-16 00:06:45.355 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:06:45.356 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:06:46.456 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@5a13b511 is alive
2025-07-16 00:07:00.778 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/16
2025-07-16 00:07:00.784 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/16
2025-07-16 00:07:00.788 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:07:00.790 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:07:00.791 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:07:00.792 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@254da47a
2025-07-16 00:07:00.792 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:07:00.793 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:07:00.794 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:07:00.795 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:07:00.795 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:07:00.799 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@2032431861 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@954914658 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:07:00.801 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:07:00.801 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:07:00.851 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:07:00.851 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:07:00.853 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/16
2025-07-16 00:07:00.853 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/16", parameters={}
2025-07-16 00:07:00.855 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:07:00.856 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:07:00.858 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=85, hungerLevel=50]]
2025-07-16 00:07:00.860 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:07:00.861 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:07:00.861 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 16. Info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=85, hungerLevel=50]
2025-07-16 00:07:00.862 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:07:00.862 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:07:00.864 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:07:00.864 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:07:00.865 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@792b49c9
2025-07-16 00:07:00.865 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:07:00.866 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:07:00.867 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:07:01.224 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:07:01.224 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:07:01.227 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@2033096108 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@2014839921 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:07:01.228 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:07:01.229 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:07:01.232 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:07:01.233 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:07:01.233 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 16 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=85, hungerLevel=50]
2025-07-16 00:07:01.234 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:07:01.234 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(58172745<open>)] for JPA transaction
2025-07-16 00:07:01.234 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:07:01.235 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1597827693 wrapping com.mysql.cj.jdbc.ConnectionImpl@4208a94e] read-only
2025-07-16 00:07:01.237 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:07:01.238 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:07:01.241 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@297e62b2]
2025-07-16 00:07:02.410 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:07:02.411 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:07:02.414 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:07:02.415 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(58172745<open>)]
2025-07-16 00:07:02.415 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:07:02.418 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1597827693 wrapping com.mysql.cj.jdbc.ConnectionImpl@4208a94e]
2025-07-16 00:07:02.421 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:07:02.422 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 16.
2025-07-16 00:07:02.423 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(58172745<open>)] for JPA transaction
2025-07-16 00:07:02.424 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:07:02.425 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:07:02.427 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@1b72edc4]
2025-07-16 00:07:02.428 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:07:02.429 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:07:02.429 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(58172745<open>)]
2025-07-16 00:07:02.429 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:07:02.430 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:07:02.430 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:07:02.431 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:07:02.431 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:07:02.432 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:07:02.432 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:07:02.432 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:07:02.741 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:07:02.742 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:07:02.743 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T22:48:42.167443, mood=ANGRY, energyLevel=85, hungerLevel=50, petType=FREZER, name=XX, id=16, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:06:45.337897}
2025-07-16 00:07:02.743 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:07:02.744 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:07:02.745 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:07:02.745 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:07:02.747 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:07:02.764 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:07:02.765 INFO  S502.virtualPets.service.PetService : Pet 'XX' (ID: 16) Updated successfully by the user 'Sergio'.
2025-07-16 00:07:02.765 INFO  S.virtualPets.controller.PetController : Pet with ID 16 updated successfully.
2025-07-16 00:07:02.766 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:07:02.766 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=16, name=XX, type=FREZER, mood=ANGRY, energyLevel=85, hungerLevel=50, userId=1, us (truncated)...]
2025-07-16 00:07:02.769 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:07:02.770 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:07:03.865 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/16
2025-07-16 00:07:03.875 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:07:03.878 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:07:03.879 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:07:03.880 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@360aab9d
2025-07-16 00:07:03.881 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:07:03.882 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:07:03.883 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:07:03.885 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:07:03.886 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:07:03.890 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1644049699 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1709843442 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:07:03.892 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:07:03.892 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:07:04.125 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:07:04.126 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:07:04.128 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/16
2025-07-16 00:07:04.128 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/16", parameters={}
2025-07-16 00:07:04.130 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:07:04.130 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:07:04.132 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=70, hungerLevel=65]]
2025-07-16 00:07:04.135 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:07:04.136 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:07:04.137 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 16. Info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=70, hungerLevel=65]
2025-07-16 00:07:04.137 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:07:04.138 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:07:04.139 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:07:04.140 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:07:04.142 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@60b9b649
2025-07-16 00:07:04.142 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:07:04.143 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:07:04.416 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:07:04.418 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:07:04.420 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:07:04.423 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1750415024 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@373786432 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:07:04.425 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:07:04.426 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:07:04.429 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:07:04.429 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:07:04.430 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 16 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=70, hungerLevel=65]
2025-07-16 00:07:04.431 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:07:04.432 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(342522514<open>)] for JPA transaction
2025-07-16 00:07:04.432 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:07:04.433 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@197024005 wrapping com.mysql.cj.jdbc.ConnectionImpl@4208a94e] read-only
2025-07-16 00:07:04.435 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:07:04.435 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:07:04.437 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@4ea3787]
2025-07-16 00:07:04.839 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:07:04.839 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:07:04.843 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:07:04.844 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(342522514<open>)]
2025-07-16 00:07:04.844 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:07:04.846 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@197024005 wrapping com.mysql.cj.jdbc.ConnectionImpl@4208a94e]
2025-07-16 00:07:04.848 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:07:04.848 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 16.
2025-07-16 00:07:04.849 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(342522514<open>)] for JPA transaction
2025-07-16 00:07:04.849 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:07:04.850 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:07:04.852 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@6e9bfe5c]
2025-07-16 00:07:04.853 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:07:04.854 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:07:04.854 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(342522514<open>)]
2025-07-16 00:07:04.854 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:07:04.855 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:07:04.855 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:07:04.856 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:07:04.856 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:07:04.856 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:07:04.857 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:07:04.857 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:07:05.415 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:07:05.416 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:07:05.417 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T22:48:42.167443, mood=ANGRY, energyLevel=70, hungerLevel=65, petType=FREZER, name=XX, id=16, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:07:02.746681}
2025-07-16 00:07:05.418 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:07:05.418 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:07:05.419 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:07:05.419 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:07:05.420 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:07:05.435 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:07:05.436 INFO  S502.virtualPets.service.PetService : Pet 'XX' (ID: 16) Updated successfully by the user 'Sergio'.
2025-07-16 00:07:05.437 INFO  S.virtualPets.controller.PetController : Pet with ID 16 updated successfully.
2025-07-16 00:07:05.438 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:07:05.439 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=16, name=XX, type=FREZER, mood=ANGRY, energyLevel=70, hungerLevel=65, userId=1, us (truncated)...]
2025-07-16 00:07:05.440 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:07:05.441 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:07:06.533 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/16
2025-07-16 00:07:06.539 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/16
2025-07-16 00:07:06.543 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:07:06.545 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:07:06.545 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:07:06.546 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@36d9693b
2025-07-16 00:07:06.547 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:07:06.548 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:07:06.550 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:07:06.551 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:07:06.552 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:07:06.558 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@678562857 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1713406969 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:07:06.559 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:07:06.560 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:07:06.607 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:07:06.607 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:07:06.609 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/16
2025-07-16 00:07:06.610 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/16", parameters={}
2025-07-16 00:07:06.611 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:07:06.611 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:07:06.613 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=55, hungerLevel=80]]
2025-07-16 00:07:06.615 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:07:06.616 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:07:06.617 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 16. Info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=55, hungerLevel=80]
2025-07-16 00:07:06.618 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:07:06.618 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:07:06.619 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:07:06.620 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:07:06.621 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@b31ab4d
2025-07-16 00:07:06.622 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:07:06.623 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:07:06.623 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:07:07.101 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:07:07.102 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:07:07.105 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@380206649 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1499957700 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:07:07.107 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:07:07.108 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:07:07.112 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:07:07.113 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:07:07.114 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 16 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=55, hungerLevel=80]
2025-07-16 00:07:07.115 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:07:07.117 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1171538238<open>)] for JPA transaction
2025-07-16 00:07:07.118 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:07:07.119 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1948805759 wrapping com.mysql.cj.jdbc.ConnectionImpl@4208a94e] read-only
2025-07-16 00:07:07.120 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:07:07.121 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:07:07.122 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@2ae3a246]
2025-07-16 00:07:07.522 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:07:07.522 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:07:07.526 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:07:07.527 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1171538238<open>)]
2025-07-16 00:07:07.528 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:07:07.530 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1948805759 wrapping com.mysql.cj.jdbc.ConnectionImpl@4208a94e]
2025-07-16 00:07:07.532 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:07:07.533 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 16.
2025-07-16 00:07:07.533 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1171538238<open>)] for JPA transaction
2025-07-16 00:07:07.534 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:07:07.534 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:07:07.536 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@47f0f069]
2025-07-16 00:07:07.537 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:07:07.537 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:07:07.538 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1171538238<open>)]
2025-07-16 00:07:07.538 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:07:07.538 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:07:07.538 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:07:07.540 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:07:07.540 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:07:07.541 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:07:07.541 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:07:07.541 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:07:08.050 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:07:08.051 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:07:08.052 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T22:48:42.167443, mood=ANGRY, energyLevel=55, hungerLevel=80, petType=FREZER, name=XX, id=16, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:07:05.420812}
2025-07-16 00:07:08.053 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:07:08.053 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:07:08.054 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:07:08.054 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:07:08.055 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:07:08.069 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:07:08.069 INFO  S502.virtualPets.service.PetService : Pet 'XX' (ID: 16) Updated successfully by the user 'Sergio'.
2025-07-16 00:07:08.070 INFO  S.virtualPets.controller.PetController : Pet with ID 16 updated successfully.
2025-07-16 00:07:08.071 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:07:08.072 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=16, name=XX, type=FREZER, mood=ANGRY, energyLevel=55, hungerLevel=80, userId=1, us (truncated)...]
2025-07-16 00:07:08.075 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:07:08.076 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:07:09.252 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/16
2025-07-16 00:07:09.257 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:07:09.261 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:07:09.262 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:07:09.263 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@16e37c32
2025-07-16 00:07:09.264 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:07:09.265 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:07:09.266 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:07:09.268 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:07:09.268 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:07:09.272 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@382567427 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1289247411 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:07:09.274 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:07:09.275 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:07:09.279 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:07:09.319 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:07:09.321 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/16
2025-07-16 00:07:09.321 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/16", parameters={}
2025-07-16 00:07:09.322 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:07:09.323 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:07:09.325 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=40, hungerLevel=95]]
2025-07-16 00:07:09.326 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:07:09.327 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:07:09.327 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 16. Info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=40, hungerLevel=95]
2025-07-16 00:07:09.327 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:07:09.328 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:07:09.329 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:07:09.330 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:07:09.331 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@54afde49
2025-07-16 00:07:09.331 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:07:09.332 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:07:09.334 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:07:09.786 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:07:09.787 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:07:09.791 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1023939501 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1074141799 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:07:09.792 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:07:09.793 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:07:09.797 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:07:09.798 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:07:09.799 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 16 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=40, hungerLevel=95]
2025-07-16 00:07:09.800 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:07:09.801 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1091903714<open>)] for JPA transaction
2025-07-16 00:07:09.802 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:07:09.803 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1668713714 wrapping com.mysql.cj.jdbc.ConnectionImpl@4208a94e] read-only
2025-07-16 00:07:09.805 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:07:09.805 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:07:09.807 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@7915703]
2025-07-16 00:07:09.808 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:07:10.333 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:07:10.337 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:07:10.338 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1091903714<open>)]
2025-07-16 00:07:10.338 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:07:10.341 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1668713714 wrapping com.mysql.cj.jdbc.ConnectionImpl@4208a94e]
2025-07-16 00:07:10.343 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:07:10.344 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 16.
2025-07-16 00:07:10.344 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1091903714<open>)] for JPA transaction
2025-07-16 00:07:10.345 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:07:10.345 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:07:10.347 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@4d849604]
2025-07-16 00:07:10.348 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:07:10.349 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:07:10.350 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1091903714<open>)]
2025-07-16 00:07:10.350 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:07:10.350 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:07:10.351 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:07:10.351 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:07:10.351 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:07:10.352 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:07:10.352 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:07:10.352 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:07:10.352 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:07:10.566 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=9/10, active=1, waiting=0)
2025-07-16 00:07:10.901 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:07:10.901 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:07:10.902 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T22:48:42.167443, mood=ANGRY, energyLevel=40, hungerLevel=95, petType=FREZER, name=XX, id=16, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:07:08.055954}
2025-07-16 00:07:10.902 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:07:10.902 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:07:10.903 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:07:10.903 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:07:10.904 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:07:10.919 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:07:10.920 INFO  S502.virtualPets.service.PetService : Pet 'XX' (ID: 16) Updated successfully by the user 'Sergio'.
2025-07-16 00:07:10.921 INFO  S.virtualPets.controller.PetController : Pet with ID 16 updated successfully.
2025-07-16 00:07:10.922 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:07:10.922 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=16, name=XX, type=FREZER, mood=ANGRY, energyLevel=40, hungerLevel=95, userId=1, us (truncated)...]
2025-07-16 00:07:10.924 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:07:10.925 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:07:14.017 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@7b2c99ca is alive
2025-07-16 00:07:21.658 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@64aff3bb: (connection has passed maxLifetime)
2025-07-16 00:07:21.663 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Attempting to create/setup new connection (892cf9a0-9e86-4bda-b078-2803104d9196)
2025-07-16 00:07:21.691 DEBUG jdk.event.security : X509Certificate: Alg:SHA256withRSA, Serial:02, Subject:CN=MySQL_Server_9.2.0_Auto_Generated_Server_Certificate, Issuer:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Key type:RSA, Length:2048, Cert Id:3807498037, Valid from:20/2/25, 10:36, Valid until:18/2/35, 10:36
2025-07-16 00:07:21.692 DEBUG jdk.event.security : X509Certificate: Alg:SHA256withRSA, Serial:01, Subject:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Issuer:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Key type:RSA, Length:2048, Cert Id:3139117285, Valid from:20/2/25, 10:36, Valid until:18/2/35, 10:36
2025-07-16 00:07:21.696 DEBUG jdk.event.security :  TLSHandshake: localhost:3306, TLSv1.3, TLS_AES_128_GCM_SHA256, 3807498037
2025-07-16 00:07:21.705 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Established new connection (892cf9a0-9e86-4bda-b078-2803104d9196)
2025-07-16 00:07:21.706 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@80f4492
2025-07-16 00:07:21.877 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@4208a94e is alive
2025-07-16 00:07:24.110 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@98e358a is alive
2025-07-16 00:07:24.491 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1eebc3dc is alive
2025-07-16 00:07:26.764 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/13
2025-07-16 00:07:26.773 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:07:26.777 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:07:26.782 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:07:26.783 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:07:26.790 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@1d496cb1
2025-07-16 00:07:26.791 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:07:26.792 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:07:26.793 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:07:26.795 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:07:26.795 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:07:26.800 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@201984046 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@479726854 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:07:26.803 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:07:26.804 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:07:26.808 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:07:26.808 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:07:26.810 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:07:26.811 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:07:26.812 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:07:26.849 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:07:26.853 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=85, hungerLevel=15]]
2025-07-16 00:07:26.857 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:07:26.859 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:07:26.860 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=85, hungerLevel=15]
2025-07-16 00:07:26.860 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:07:26.861 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:07:26.863 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:07:26.864 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:07:26.865 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@5a4e1ede
2025-07-16 00:07:26.866 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:07:26.866 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:07:26.867 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:07:26.868 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:07:26.868 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:07:27.319 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1249143389 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1689321515 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:07:27.320 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:07:27.321 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:07:27.325 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:07:27.326 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:07:27.326 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=85, hungerLevel=15]
2025-07-16 00:07:27.327 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:07:27.328 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1573510701<open>)] for JPA transaction
2025-07-16 00:07:27.328 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:07:27.330 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1236028087 wrapping com.mysql.cj.jdbc.ConnectionImpl@4208a94e] read-only
2025-07-16 00:07:27.332 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:07:27.333 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:07:27.336 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@5d343ff0]
2025-07-16 00:07:27.339 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:07:27.339 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:07:27.343 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:07:27.344 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1573510701<open>)]
2025-07-16 00:07:27.677 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:07:27.680 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1236028087 wrapping com.mysql.cj.jdbc.ConnectionImpl@4208a94e]
2025-07-16 00:07:27.682 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:07:27.683 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:07:27.684 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1573510701<open>)] for JPA transaction
2025-07-16 00:07:27.685 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:07:27.686 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:07:27.688 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@5dc17c2c]
2025-07-16 00:07:27.689 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:07:27.690 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:07:27.691 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1573510701<open>)]
2025-07-16 00:07:27.692 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:07:27.693 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:07:27.694 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:07:27.695 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:07:27.696 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:07:27.698 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:07:27.698 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:07:27.699 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:07:27.700 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:07:27.700 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:07:27.701 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:07:28.097 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:07:28.097 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:07:28.098 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:07:28.098 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=EXCITED, energyLevel=85, hungerLevel=15, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:04:48.560417}
2025-07-16 00:07:28.103 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:07:28.117 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:07:28.117 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:07:28.118 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:07:28.120 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:07:28.121 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=EXCITED, energyLevel=85, hungerLevel=15, userId=1, u (truncated)...]
2025-07-16 00:07:28.123 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:07:28.125 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:07:29.230 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:07:29.233 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:07:29.236 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:07:29.237 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:07:29.239 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@3d7e4e99
2025-07-16 00:07:29.240 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:07:29.242 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:07:29.243 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:07:29.244 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:07:29.245 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:07:29.249 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@115851649 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1751732673 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:07:29.250 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:07:29.251 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:07:29.256 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:07:29.257 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:07:29.258 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:07:29.259 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:07:29.260 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:07:29.260 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:07:29.263 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=70, hungerLevel=30]]
2025-07-16 00:07:29.265 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:07:29.267 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:07:29.268 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=70, hungerLevel=30]
2025-07-16 00:07:29.269 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:07:29.269 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:07:29.270 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:07:29.271 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:07:29.272 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@465a83d1
2025-07-16 00:07:29.272 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:07:29.273 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:07:29.407 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:07:29.408 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:07:29.408 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:07:29.411 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@373073114 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@126443259 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:07:29.412 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:07:29.413 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:07:29.417 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:07:29.418 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:07:29.419 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=70, hungerLevel=30]
2025-07-16 00:07:29.420 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:07:29.421 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(313559568<open>)] for JPA transaction
2025-07-16 00:07:29.422 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:07:29.422 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@113384945 wrapping com.mysql.cj.jdbc.ConnectionImpl@4208a94e] read-only
2025-07-16 00:07:29.424 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:07:29.425 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:07:29.426 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@38fa60a0]
2025-07-16 00:07:29.968 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:07:29.969 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:07:29.973 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:07:29.973 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(313559568<open>)]
2025-07-16 00:07:29.974 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:07:29.976 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@113384945 wrapping com.mysql.cj.jdbc.ConnectionImpl@4208a94e]
2025-07-16 00:07:29.979 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:07:29.979 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:07:29.980 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(313559568<open>)] for JPA transaction
2025-07-16 00:07:29.980 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:07:29.980 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:07:29.982 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@2e148d83]
2025-07-16 00:07:29.984 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:07:29.986 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:07:29.986 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(313559568<open>)]
2025-07-16 00:07:29.987 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:07:29.988 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:07:29.988 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:07:29.989 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:07:29.989 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:07:29.990 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:07:29.991 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:07:29.991 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:07:30.627 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:07:30.628 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:07:30.629 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:07:30.630 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:07:30.630 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:07:30.630 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:07:30.630 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=EXCITED, energyLevel=70, hungerLevel=30, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:07:28.102353}
2025-07-16 00:07:30.632 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:07:30.645 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:07:30.646 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:07:30.647 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:07:30.647 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:07:30.648 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=EXCITED, energyLevel=70, hungerLevel=30, userId=1, u (truncated)...]
2025-07-16 00:07:30.651 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:07:30.653 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:07:31.492 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:07:31.494 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:07:31.496 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:07:31.498 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:07:31.499 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@4d3a75b0
2025-07-16 00:07:31.500 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:07:31.500 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:07:31.501 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:07:31.502 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:07:31.503 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:07:31.508 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1515083354 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@472288513 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:07:31.509 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:07:31.510 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:07:31.541 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:07:31.542 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:07:31.543 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:07:31.544 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:07:31.545 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:07:31.545 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:07:31.548 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=55, hungerLevel=45]]
2025-07-16 00:07:31.550 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:07:31.551 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:07:31.552 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=55, hungerLevel=45]
2025-07-16 00:07:31.552 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:07:31.553 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:07:31.555 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:07:31.556 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:07:31.557 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@793af3cb
2025-07-16 00:07:31.558 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:07:31.559 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:07:32.087 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:07:32.088 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:07:32.089 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:07:32.093 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@335758229 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@714983724 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:07:32.094 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:07:32.095 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:07:32.100 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:07:32.102 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:07:32.102 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=55, hungerLevel=45]
2025-07-16 00:07:32.103 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:07:32.103 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1774661419<open>)] for JPA transaction
2025-07-16 00:07:32.104 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:07:32.105 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1872403278 wrapping com.mysql.cj.jdbc.ConnectionImpl@4208a94e] read-only
2025-07-16 00:07:32.107 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:07:32.107 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:07:32.720 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@7602f8a2]
2025-07-16 00:07:32.721 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:07:32.722 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:07:32.724 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:07:32.725 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1774661419<open>)]
2025-07-16 00:07:32.725 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:07:32.728 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1872403278 wrapping com.mysql.cj.jdbc.ConnectionImpl@4208a94e]
2025-07-16 00:07:32.730 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:07:32.731 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:07:32.732 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1774661419<open>)] for JPA transaction
2025-07-16 00:07:32.733 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:07:32.734 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:07:32.737 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@a9c9750]
2025-07-16 00:07:32.737 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:07:32.739 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:07:32.739 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1774661419<open>)]
2025-07-16 00:07:32.740 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:07:32.740 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:07:32.741 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:07:32.742 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:07:32.742 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:07:32.743 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:07:33.171 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:07:33.171 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:07:33.172 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:07:33.173 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:07:33.173 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:07:33.174 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:07:33.174 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:07:33.174 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:07:33.175 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=EXCITED, energyLevel=55, hungerLevel=45, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:07:30.632242}
2025-07-16 00:07:33.176 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:07:33.190 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:07:33.191 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:07:33.191 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:07:33.193 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:07:33.194 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=EXCITED, energyLevel=55, hungerLevel=45, userId=1, u (truncated)...]
2025-07-16 00:07:33.196 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:07:33.197 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:07:34.054 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/13
2025-07-16 00:07:34.060 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:07:34.063 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:07:34.065 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:07:34.066 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:07:34.067 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@12bcccbf
2025-07-16 00:07:34.068 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:07:34.068 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:07:34.070 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:07:34.071 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:07:34.072 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:07:34.075 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@587882463 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@156942324 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:07:34.077 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:07:34.079 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:07:34.212 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:07:34.213 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:07:34.214 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:07:34.216 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:07:34.216 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:07:34.217 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:07:34.219 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=40, hungerLevel=60]]
2025-07-16 00:07:34.220 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:07:34.221 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:07:34.222 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=40, hungerLevel=60]
2025-07-16 00:07:34.223 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:07:34.223 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:07:34.225 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:07:34.226 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:07:34.227 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@44540906
2025-07-16 00:07:34.228 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:07:34.228 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:07:34.602 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:07:34.603 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:07:34.604 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:07:34.608 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@592181138 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1748729060 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:07:34.609 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:07:34.610 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:07:34.615 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:07:34.616 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:07:34.616 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=40, hungerLevel=60]
2025-07-16 00:07:34.617 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:07:34.617 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(823997024<open>)] for JPA transaction
2025-07-16 00:07:34.617 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:07:34.618 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1612961157 wrapping com.mysql.cj.jdbc.ConnectionImpl@4208a94e] read-only
2025-07-16 00:07:34.620 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:07:35.854 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:07:35.856 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@157a4309]
2025-07-16 00:07:35.857 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:07:35.858 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:07:35.862 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:07:35.863 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(823997024<open>)]
2025-07-16 00:07:35.864 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:07:35.869 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1612961157 wrapping com.mysql.cj.jdbc.ConnectionImpl@4208a94e]
2025-07-16 00:07:35.872 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:07:35.873 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:07:35.873 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(823997024<open>)] for JPA transaction
2025-07-16 00:07:35.874 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:07:35.874 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:07:35.876 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@2a0f4a8b]
2025-07-16 00:07:35.876 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:07:35.878 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:07:35.878 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(823997024<open>)]
2025-07-16 00:07:35.879 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:07:35.879 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:07:35.880 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:07:35.880 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:07:35.881 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:07:35.882 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:07:36.333 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:07:36.333 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:07:36.334 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:07:36.334 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:07:36.334 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:07:36.335 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:07:36.335 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:07:36.335 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:07:36.336 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=EXCITED, energyLevel=40, hungerLevel=60, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:07:33.176734}
2025-07-16 00:07:36.337 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:07:36.350 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:07:36.351 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:07:36.351 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:07:36.352 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:07:36.353 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=EXCITED, energyLevel=40, hungerLevel=60, userId=1, u (truncated)...]
2025-07-16 00:07:36.354 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:07:36.355 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:07:37.786 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1e943acb is alive
2025-07-16 00:07:40.904 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:07:40.905 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:07:42.450 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@63525b31 is alive
2025-07-16 00:07:48.398 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@59780ce is alive
2025-07-16 00:07:59.347 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@48b33fb1 is alive
2025-07-16 00:08:10.919 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:08:10.920 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:08:30.045 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@4208a94e: (connection has passed maxLifetime)
2025-07-16 00:08:30.049 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Attempting to create/setup new connection (e2839fe7-9ddc-4483-9e2a-69cd94033472)
2025-07-16 00:08:30.081 DEBUG jdk.event.security : X509Certificate: Alg:SHA256withRSA, Serial:02, Subject:CN=MySQL_Server_9.2.0_Auto_Generated_Server_Certificate, Issuer:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Key type:RSA, Length:2048, Cert Id:3807498037, Valid from:20/2/25, 10:36, Valid until:18/2/35, 10:36
2025-07-16 00:08:30.083 DEBUG jdk.event.security : X509Certificate: Alg:SHA256withRSA, Serial:01, Subject:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Issuer:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Key type:RSA, Length:2048, Cert Id:3139117285, Valid from:20/2/25, 10:36, Valid until:18/2/35, 10:36
2025-07-16 00:08:30.087 DEBUG jdk.event.security :  TLSHandshake: localhost:3306, TLSv1.3, TLS_AES_128_GCM_SHA256, 3807498037
2025-07-16 00:08:30.096 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Established new connection (e2839fe7-9ddc-4483-9e2a-69cd94033472)
2025-07-16 00:08:30.097 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@4c76b4fa
2025-07-16 00:08:39.076 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@5a13b511 is alive
2025-07-16 00:08:39.236 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@59780ce: (connection has passed maxLifetime)
2025-07-16 00:08:39.240 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Attempting to create/setup new connection (b75798b0-7e3c-424c-84c8-835e011892d8)
2025-07-16 00:08:39.268 DEBUG jdk.event.security : X509Certificate: Alg:SHA256withRSA, Serial:02, Subject:CN=MySQL_Server_9.2.0_Auto_Generated_Server_Certificate, Issuer:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Key type:RSA, Length:2048, Cert Id:3807498037, Valid from:20/2/25, 10:36, Valid until:18/2/35, 10:36
2025-07-16 00:08:39.270 DEBUG jdk.event.security : X509Certificate: Alg:SHA256withRSA, Serial:01, Subject:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Issuer:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Key type:RSA, Length:2048, Cert Id:3139117285, Valid from:20/2/25, 10:36, Valid until:18/2/35, 10:36
2025-07-16 00:08:39.274 DEBUG jdk.event.security :  TLSHandshake: localhost:3306, TLSv1.3, TLS_AES_128_GCM_SHA256, 3807498037
2025-07-16 00:08:39.280 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Established new connection (b75798b0-7e3c-424c-84c8-835e011892d8)
2025-07-16 00:08:39.281 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@22063a0c
2025-07-16 00:08:40.922 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:08:40.923 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:09:00.324 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@80f4492 is alive
2025-07-16 00:09:00.995 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1eebc3dc is alive
2025-07-16 00:09:01.421 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@7b2c99ca is alive
2025-07-16 00:09:06.172 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@98e358a is alive
2025-07-16 00:09:10.926 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:09:10.927 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:09:14.506 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1e943acb is alive
2025-07-16 00:09:26.739 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@63525b31 is alive
2025-07-16 00:09:40.939 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:09:40.939 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:09:58.746 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@48b33fb1 is alive
2025-07-16 00:10:07.231 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@4c76b4fa is alive
2025-07-16 00:10:09.808 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/13
2025-07-16 00:10:09.814 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:10:09.816 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:10:09.818 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:10:09.819 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:10:09.820 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@5d0752ab
2025-07-16 00:10:09.821 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:10:09.822 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:10:09.823 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:10:09.824 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:10:09.826 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:10:09.832 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@171573035 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1793501024 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:10:09.835 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:10:09.837 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:10:09.842 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:10:09.843 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:10:09.844 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:10:09.845 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:10:09.846 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:10:09.846 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:10:09.848 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=25, hungerLevel=75]]
2025-07-16 00:10:09.850 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:10:09.851 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:10:09.852 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=25, hungerLevel=75]
2025-07-16 00:10:09.853 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:10:09.853 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:10:09.854 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:10:09.856 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:10:09.873 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@18c45cb4
2025-07-16 00:10:09.874 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:10:09.874 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:10:09.876 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:10:09.877 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:10:09.877 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:10:09.882 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@364975563 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1587830175 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:10:09.883 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:10:09.884 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:10:09.888 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:10:09.889 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:10:10.347 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=25, hungerLevel=75]
2025-07-16 00:10:10.348 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:10:10.349 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1338364003<open>)] for JPA transaction
2025-07-16 00:10:10.350 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:10:10.350 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@622727350 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511] read-only
2025-07-16 00:10:10.353 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:10:10.353 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:10:10.356 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@6fdb228f]
2025-07-16 00:10:10.358 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:10:10.358 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:10:10.362 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:10:10.363 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1338364003<open>)]
2025-07-16 00:10:10.363 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:10:10.366 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@622727350 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511]
2025-07-16 00:10:10.368 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:10:10.369 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:10:10.370 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1338364003<open>)] for JPA transaction
2025-07-16 00:10:10.371 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:10:10.371 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:10:10.373 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@8ea3948]
2025-07-16 00:10:10.373 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:10:10.948 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=9/10, active=1, waiting=0)
2025-07-16 00:10:10.998 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:10:10.999 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:10:11.000 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1338364003<open>)]
2025-07-16 00:10:11.001 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:10:11.002 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:10:11.003 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:10:11.005 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:10:11.005 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:10:11.006 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:10:11.006 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:10:11.007 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:10:11.007 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:10:11.008 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:10:11.008 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:10:11.008 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:10:11.008 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:10:11.008 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:10:11.009 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=EXCITED, energyLevel=25, hungerLevel=75, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:07:36.336628}
2025-07-16 00:10:11.010 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:10:11.028 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:10:11.371 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:10:11.372 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:10:11.373 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:10:11.373 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=EXCITED, energyLevel=25, hungerLevel=75, userId=1, u (truncated)...]
2025-07-16 00:10:11.375 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:10:11.376 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:10:13.251 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:10:13.254 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:10:13.255 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:10:13.256 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:10:13.257 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@697a1e61
2025-07-16 00:10:13.258 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:10:13.259 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:10:13.261 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:10:13.263 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:10:13.264 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:10:13.270 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@2004779398 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1779943452 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:10:13.271 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:10:13.272 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:10:13.277 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:10:13.279 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:10:13.281 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:10:13.282 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:10:13.283 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:10:13.284 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:10:13.287 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=35, hungerLevel=60]]
2025-07-16 00:10:13.288 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:10:13.289 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:10:13.290 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=35, hungerLevel=60]
2025-07-16 00:10:13.290 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:10:13.291 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:10:13.292 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:10:13.292 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:10:13.293 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@3e26b079
2025-07-16 00:10:13.293 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:10:13.294 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:10:13.295 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:10:13.353 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:10:13.353 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:10:13.356 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@884233359 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@912359476 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:10:13.359 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:10:13.360 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:10:13.365 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:10:13.365 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:10:13.366 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=35, hungerLevel=60]
2025-07-16 00:10:13.367 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:10:13.367 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(2068749126<open>)] for JPA transaction
2025-07-16 00:10:13.368 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:10:13.368 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1447030977 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511] read-only
2025-07-16 00:10:13.370 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:10:13.370 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:10:13.372 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@4b0d5995]
2025-07-16 00:10:13.792 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:10:13.793 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:10:13.797 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:10:13.798 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(2068749126<open>)]
2025-07-16 00:10:13.798 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:10:13.802 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1447030977 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511]
2025-07-16 00:10:13.803 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:10:13.803 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:10:13.804 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(2068749126<open>)] for JPA transaction
2025-07-16 00:10:13.804 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:10:13.805 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:10:13.806 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@6e22ae52]
2025-07-16 00:10:13.807 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:10:13.808 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:10:13.808 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(2068749126<open>)]
2025-07-16 00:10:13.809 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:10:13.809 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:10:13.809 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:10:13.811 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:10:13.813 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:10:13.814 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:10:13.815 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:10:13.815 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:10:14.382 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:10:14.383 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:10:14.384 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:10:14.385 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:10:14.385 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:10:14.386 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:10:14.386 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=EXCITED, energyLevel=35, hungerLevel=60, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:10:11.009888}
2025-07-16 00:10:14.387 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:10:14.403 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:10:14.404 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:10:14.405 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:10:14.406 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:10:14.407 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=EXCITED, energyLevel=35, hungerLevel=60, userId=1, u (truncated)...]
2025-07-16 00:10:14.408 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:10:14.409 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:10:15.251 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/13
2025-07-16 00:10:15.257 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:10:15.260 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:10:15.263 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:10:15.264 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:10:15.265 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@510259d0
2025-07-16 00:10:15.266 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:10:15.267 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:10:15.268 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:10:15.269 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:10:15.269 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:10:15.273 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1016999850 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@442109263 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:10:15.275 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:10:15.276 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:10:15.610 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:10:15.611 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:10:15.612 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:10:15.613 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:10:15.614 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:10:15.615 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:10:15.619 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=45, hungerLevel=45]]
2025-07-16 00:10:15.621 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:10:15.623 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:10:15.623 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=45, hungerLevel=45]
2025-07-16 00:10:15.624 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:10:15.625 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:10:15.627 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:10:15.632 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:10:15.632 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@40d2d671
2025-07-16 00:10:15.634 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:10:15.634 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:10:16.538 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:10:16.540 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:10:16.540 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:10:16.544 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@2051162463 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@389471986 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:10:16.545 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:10:16.546 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:10:16.551 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:10:16.552 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:10:16.552 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=45, hungerLevel=45]
2025-07-16 00:10:16.552 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:10:16.553 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1506550919<open>)] for JPA transaction
2025-07-16 00:10:16.553 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:10:16.554 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1492675499 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511] read-only
2025-07-16 00:10:16.555 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:10:17.706 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:10:17.708 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@6957109c]
2025-07-16 00:10:17.709 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:10:17.710 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:10:17.714 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:10:17.715 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1506550919<open>)]
2025-07-16 00:10:17.715 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:10:17.718 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1492675499 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511]
2025-07-16 00:10:17.720 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:10:17.721 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:10:17.721 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1506550919<open>)] for JPA transaction
2025-07-16 00:10:17.722 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:10:17.722 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:10:17.724 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@337a45ef]
2025-07-16 00:10:17.725 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:10:17.729 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:10:17.730 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1506550919<open>)]
2025-07-16 00:10:17.731 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:10:17.732 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:10:17.732 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:10:17.733 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:10:17.734 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:10:17.736 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:10:18.397 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:10:18.397 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:10:18.399 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:10:18.400 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:10:18.400 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:10:18.400 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:10:18.401 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:10:18.403 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:10:18.404 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=EXCITED, energyLevel=45, hungerLevel=45, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:10:14.387385}
2025-07-16 00:10:18.404 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:10:18.418 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:10:18.419 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:10:18.419 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:10:18.420 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:10:18.421 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=EXCITED, energyLevel=45, hungerLevel=45, userId=1, u (truncated)...]
2025-07-16 00:10:18.424 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:10:18.426 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:10:19.574 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:10:19.578 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:10:19.580 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:10:19.580 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:10:19.582 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@60d347b
2025-07-16 00:10:19.584 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:10:19.585 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:10:19.585 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:10:19.586 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:10:19.586 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:10:19.590 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@2104785336 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@745865307 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:10:19.591 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:10:19.592 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:10:19.596 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:10:19.598 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:10:19.599 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:10:19.646 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:10:19.647 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:10:19.648 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:10:19.650 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=55, hungerLevel=30]]
2025-07-16 00:10:19.652 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:10:19.654 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:10:19.654 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=55, hungerLevel=30]
2025-07-16 00:10:19.655 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:10:19.655 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:10:19.657 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:10:19.657 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:10:19.659 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@547a4ee8
2025-07-16 00:10:19.659 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:10:19.661 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:10:19.662 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:10:19.663 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:10:19.663 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:10:20.405 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1997513240 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@8569990 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:10:20.407 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:10:20.408 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:10:20.412 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:10:20.413 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:10:20.414 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=55, hungerLevel=30]
2025-07-16 00:10:20.415 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:10:20.415 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1428784184<open>)] for JPA transaction
2025-07-16 00:10:20.417 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:10:20.418 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1577562558 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511] read-only
2025-07-16 00:10:20.419 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:10:20.420 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:10:20.422 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@385a0563]
2025-07-16 00:10:20.423 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:10:20.424 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:10:21.139 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:10:21.140 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1428784184<open>)]
2025-07-16 00:10:21.141 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:10:21.144 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1577562558 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511]
2025-07-16 00:10:21.147 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:10:21.148 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:10:21.148 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1428784184<open>)] for JPA transaction
2025-07-16 00:10:21.149 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:10:21.149 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:10:21.151 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@d959a33]
2025-07-16 00:10:21.152 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:10:21.153 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:10:21.154 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1428784184<open>)]
2025-07-16 00:10:21.154 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:10:21.155 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:10:21.155 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:10:21.156 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:10:21.157 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:10:21.158 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:10:21.159 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:10:21.160 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:10:21.160 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:10:21.160 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:10:21.160 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:10:21.733 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@22063a0c is alive
2025-07-16 00:10:21.782 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:10:21.782 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:10:21.783 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:10:21.784 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=EXCITED, energyLevel=55, hungerLevel=30, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:10:18.404996}
2025-07-16 00:10:21.785 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:10:21.800 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:10:21.800 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:10:21.800 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:10:21.801 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:10:21.802 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=EXCITED, energyLevel=55, hungerLevel=30, userId=1, u (truncated)...]
2025-07-16 00:10:21.804 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:10:21.805 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:10:31.713 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@5a13b511 is alive
2025-07-16 00:10:37.504 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1eebc3dc is alive
2025-07-16 00:10:38.939 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@80f4492 is alive
2025-07-16 00:10:41.012 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:10:41.015 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:10:48.238 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@98e358a is alive
2025-07-16 00:10:48.816 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@7b2c99ca is alive
2025-07-16 00:10:51.214 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1e943acb is alive
2025-07-16 00:11:11.015 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@63525b31 is alive
2025-07-16 00:11:11.029 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:11:11.030 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:11:12.355 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/16
2025-07-16 00:11:12.362 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/16
2025-07-16 00:11:12.365 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:11:12.367 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:11:12.368 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:11:12.369 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@111c60f2
2025-07-16 00:11:12.370 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:11:12.373 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:11:12.374 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:11:12.376 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:11:12.376 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:11:12.382 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@33896356 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@341870295 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:11:12.384 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:11:12.384 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:11:12.388 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:11:12.390 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:11:12.392 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/16
2025-07-16 00:11:12.393 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/16", parameters={}
2025-07-16 00:11:12.395 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:11:12.395 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:11:12.398 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=50, hungerLevel=80]]
2025-07-16 00:11:12.399 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:11:12.401 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:11:12.402 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 16. Info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=50, hungerLevel=80]
2025-07-16 00:11:12.599 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:11:12.600 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:11:12.601 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:11:12.602 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:11:12.603 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@5389187
2025-07-16 00:11:12.604 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:11:12.605 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:11:12.607 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:11:12.608 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:11:12.609 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:11:12.612 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1850717932 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1016762695 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:11:12.614 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:11:12.615 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:11:13.432 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:11:13.433 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:11:13.434 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 16 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=50, hungerLevel=80]
2025-07-16 00:11:13.435 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:11:13.437 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1985613622<open>)] for JPA transaction
2025-07-16 00:11:13.437 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:11:13.438 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1591231275 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511] read-only
2025-07-16 00:11:13.440 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:11:13.441 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:11:13.443 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@1557de8b]
2025-07-16 00:11:13.444 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:11:13.445 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:11:13.450 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:11:13.452 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1985613622<open>)]
2025-07-16 00:11:13.452 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:11:13.457 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1591231275 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511]
2025-07-16 00:11:13.459 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:11:13.459 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 16.
2025-07-16 00:11:13.461 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1985613622<open>)] for JPA transaction
2025-07-16 00:11:13.462 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:11:13.463 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:11:13.465 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@2725dc15]
2025-07-16 00:11:14.346 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:11:14.347 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:11:14.348 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1985613622<open>)]
2025-07-16 00:11:14.348 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:11:14.349 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:11:14.349 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:11:14.350 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:11:14.351 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:11:14.352 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:11:14.353 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:11:14.353 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:11:14.354 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:11:14.355 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:11:14.355 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T22:48:42.167443, mood=ANGRY, energyLevel=50, hungerLevel=80, petType=FREZER, name=XX, id=16, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:07:10.904160}
2025-07-16 00:11:14.356 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:11:14.356 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:11:14.356 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:11:14.356 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:11:14.358 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:11:14.373 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:11:15.131 INFO  S502.virtualPets.service.PetService : Pet 'XX' (ID: 16) Updated successfully by the user 'Sergio'.
2025-07-16 00:11:15.131 INFO  S.virtualPets.controller.PetController : Pet with ID 16 updated successfully.
2025-07-16 00:11:15.132 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:11:15.134 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=16, name=XX, type=FREZER, mood=ANGRY, energyLevel=50, hungerLevel=80, userId=1, us (truncated)...]
2025-07-16 00:11:15.137 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:11:15.138 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:11:18.567 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/16
2025-07-16 00:11:18.575 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/16
2025-07-16 00:11:18.577 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:11:18.578 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:11:18.579 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:11:18.580 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@3e8ab2bd
2025-07-16 00:11:18.582 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:11:18.585 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:11:18.586 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:11:18.587 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:11:18.588 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:11:18.592 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@825988421 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@524623742 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:11:18.593 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:11:18.594 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:11:18.655 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:11:18.656 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:11:18.658 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/16
2025-07-16 00:11:18.658 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/16", parameters={}
2025-07-16 00:11:18.659 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:11:18.660 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:11:18.662 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=35, hungerLevel=95]]
2025-07-16 00:11:18.663 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:11:18.665 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:11:18.665 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 16. Info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=35, hungerLevel=95]
2025-07-16 00:11:18.667 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:11:18.668 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:11:18.670 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:11:18.671 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:11:18.672 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@78c111d4
2025-07-16 00:11:18.673 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:11:18.674 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:11:20.026 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:11:20.028 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:11:20.028 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:11:20.033 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1715988776 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1782867164 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:11:20.035 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:11:20.036 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:11:20.040 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:11:20.041 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:11:20.042 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 16 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=35, hungerLevel=95]
2025-07-16 00:11:20.042 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:11:20.043 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(776414996<open>)] for JPA transaction
2025-07-16 00:11:20.044 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:11:20.044 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1446590882 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511] read-only
2025-07-16 00:11:20.047 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:11:20.048 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:11:20.050 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@458df38e]
2025-07-16 00:11:22.167 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:11:22.167 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:11:22.171 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:11:22.172 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(776414996<open>)]
2025-07-16 00:11:22.173 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:11:22.177 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1446590882 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511]
2025-07-16 00:11:22.181 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:11:22.182 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 16.
2025-07-16 00:11:22.183 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(776414996<open>)] for JPA transaction
2025-07-16 00:11:22.183 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:11:22.184 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:11:22.185 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@aeae67]
2025-07-16 00:11:22.186 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:11:22.187 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:11:22.188 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(776414996<open>)]
2025-07-16 00:11:22.189 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:11:22.189 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:11:22.190 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:11:22.190 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:11:22.191 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:11:22.192 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:11:22.193 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:11:22.194 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:11:23.425 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:11:23.426 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:11:23.427 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T22:48:42.167443, mood=ANGRY, energyLevel=35, hungerLevel=95, petType=FREZER, name=XX, id=16, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:11:14.357047}
2025-07-16 00:11:23.428 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:11:23.429 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:11:23.429 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:11:23.429 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:11:23.431 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:11:23.443 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:11:23.444 INFO  S502.virtualPets.service.PetService : Pet 'XX' (ID: 16) Updated successfully by the user 'Sergio'.
2025-07-16 00:11:23.444 INFO  S.virtualPets.controller.PetController : Pet with ID 16 updated successfully.
2025-07-16 00:11:23.445 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:11:23.446 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=16, name=XX, type=FREZER, mood=ANGRY, energyLevel=35, hungerLevel=95, userId=1, us (truncated)...]
2025-07-16 00:11:23.449 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:11:23.450 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:11:25.734 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/16
2025-07-16 00:11:25.740 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/16
2025-07-16 00:11:25.742 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:11:25.745 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:11:25.745 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:11:25.747 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@240277fd
2025-07-16 00:11:25.749 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:11:25.750 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:11:25.751 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:11:25.752 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:11:25.752 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:11:25.756 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1814696789 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1068350177 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:11:25.757 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:11:25.759 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:11:25.765 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:11:25.766 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:11:25.767 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/16
2025-07-16 00:11:25.768 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/16", parameters={}
2025-07-16 00:11:25.768 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:11:25.769 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:11:25.771 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=45, hungerLevel=80]]
2025-07-16 00:11:25.773 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:11:25.775 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:11:25.775 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 16. Info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=45, hungerLevel=80]
2025-07-16 00:11:25.776 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:11:25.776 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:11:25.778 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:11:25.779 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:11:25.780 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@333fc6e3
2025-07-16 00:11:25.781 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:11:25.782 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:11:25.783 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:11:25.874 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:11:25.875 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:11:25.879 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@541038860 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1952714243 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:11:25.881 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:11:25.881 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:11:25.885 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:11:25.886 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:11:25.887 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 16 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=45, hungerLevel=80]
2025-07-16 00:11:25.896 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:11:25.899 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(904220907<open>)] for JPA transaction
2025-07-16 00:11:25.899 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:11:25.900 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@2024688378 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511] read-only
2025-07-16 00:11:25.902 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:11:25.903 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:11:25.905 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@6e68fc20]
2025-07-16 00:11:26.267 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:11:26.268 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:11:26.271 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:11:26.272 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(904220907<open>)]
2025-07-16 00:11:26.272 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:11:26.275 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@2024688378 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511]
2025-07-16 00:11:26.278 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:11:26.278 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 16.
2025-07-16 00:11:26.279 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(904220907<open>)] for JPA transaction
2025-07-16 00:11:26.280 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:11:26.280 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:11:26.282 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@4d26fdd9]
2025-07-16 00:11:26.283 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:11:26.284 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:11:26.285 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(904220907<open>)]
2025-07-16 00:11:26.286 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:11:26.287 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:11:26.288 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:11:26.289 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:11:26.290 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:11:26.292 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:11:26.292 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:11:26.293 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:11:27.206 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:11:27.207 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:11:27.207 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T22:48:42.167443, mood=ANGRY, energyLevel=45, hungerLevel=80, petType=FREZER, name=XX, id=16, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:11:23.430425}
2025-07-16 00:11:27.208 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:11:27.209 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:11:27.210 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:11:27.210 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:11:27.212 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:11:27.227 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:11:27.227 INFO  S502.virtualPets.service.PetService : Pet 'XX' (ID: 16) Updated successfully by the user 'Sergio'.
2025-07-16 00:11:27.228 INFO  S.virtualPets.controller.PetController : Pet with ID 16 updated successfully.
2025-07-16 00:11:27.229 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:11:27.230 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=16, name=XX, type=FREZER, mood=ANGRY, energyLevel=45, hungerLevel=80, userId=1, us (truncated)...]
2025-07-16 00:11:27.231 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:11:27.232 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:11:28.252 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/16
2025-07-16 00:11:28.255 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:11:28.257 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:11:28.258 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:11:28.259 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@616094ef
2025-07-16 00:11:28.260 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:11:28.261 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:11:28.262 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:11:28.263 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:11:28.264 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:11:28.268 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1790509953 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@227545705 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:11:28.269 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:11:28.269 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:11:28.516 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:11:28.517 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:11:28.519 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/16
2025-07-16 00:11:28.520 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/16", parameters={}
2025-07-16 00:11:28.520 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:11:28.520 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:11:28.523 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=55, hungerLevel=65]]
2025-07-16 00:11:28.525 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:11:28.525 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:11:28.527 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 16. Info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=55, hungerLevel=65]
2025-07-16 00:11:28.528 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:11:28.530 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:11:28.531 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:11:28.531 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:11:28.532 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@66860b6b
2025-07-16 00:11:28.532 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:11:28.534 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:11:29.350 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:11:29.351 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:11:29.352 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:11:29.357 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1241239469 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1809375324 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:11:29.359 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:11:29.359 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:11:29.363 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:11:29.363 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:11:29.364 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 16 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=55, hungerLevel=65]
2025-07-16 00:11:29.365 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:11:29.365 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(529479288<open>)] for JPA transaction
2025-07-16 00:11:29.366 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:11:29.367 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1773860099 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511] read-only
2025-07-16 00:11:29.369 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:11:29.370 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:11:29.372 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@1516bb56]
2025-07-16 00:11:30.070 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:11:30.070 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:11:30.074 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:11:30.075 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(529479288<open>)]
2025-07-16 00:11:30.076 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:11:30.079 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1773860099 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511]
2025-07-16 00:11:30.081 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:11:30.082 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 16.
2025-07-16 00:11:30.083 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(529479288<open>)] for JPA transaction
2025-07-16 00:11:30.084 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:11:30.084 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:11:30.086 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@43eb5355]
2025-07-16 00:11:30.087 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:11:30.088 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:11:30.089 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(529479288<open>)]
2025-07-16 00:11:30.090 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:11:30.090 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:11:30.091 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:11:30.092 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:11:30.093 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:11:30.094 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:11:30.095 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:11:30.095 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:11:30.530 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:11:30.531 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:11:30.532 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T22:48:42.167443, mood=ANGRY, energyLevel=55, hungerLevel=65, petType=FREZER, name=XX, id=16, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:11:27.212634}
2025-07-16 00:11:30.533 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:11:30.533 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:11:30.534 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:11:30.535 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:11:30.537 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:11:30.550 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:11:30.551 INFO  S502.virtualPets.service.PetService : Pet 'XX' (ID: 16) Updated successfully by the user 'Sergio'.
2025-07-16 00:11:30.551 INFO  S.virtualPets.controller.PetController : Pet with ID 16 updated successfully.
2025-07-16 00:11:30.552 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:11:30.553 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=16, name=XX, type=FREZER, mood=ANGRY, energyLevel=55, hungerLevel=65, userId=1, us (truncated)...]
2025-07-16 00:11:30.554 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:11:30.555 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:11:37.965 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/13
2025-07-16 00:11:37.973 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:11:37.974 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:11:37.976 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:11:37.977 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:11:37.979 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@790d4d5b
2025-07-16 00:11:37.980 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:11:37.981 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:11:37.982 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:11:37.983 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:11:37.984 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:11:37.990 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@686832780 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@149985497 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:11:37.991 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:11:37.991 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:11:37.995 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:11:37.996 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:11:37.997 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:11:37.998 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:11:37.999 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:11:38.000 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:11:38.004 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=40, hungerLevel=45]]
2025-07-16 00:11:38.007 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:11:38.009 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:11:38.009 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=40, hungerLevel=45]
2025-07-16 00:11:38.010 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:11:38.010 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:11:38.011 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:11:38.012 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:11:38.180 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@416e124f
2025-07-16 00:11:38.181 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:11:38.182 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:11:38.183 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:11:38.185 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:11:38.186 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:11:38.189 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1752275180 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@338634179 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:11:38.191 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:11:38.191 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:11:38.194 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:11:38.195 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:11:38.679 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=40, hungerLevel=45]
2025-07-16 00:11:38.680 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:11:38.680 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1220784752<open>)] for JPA transaction
2025-07-16 00:11:38.680 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:11:38.681 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@659353505 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511] read-only
2025-07-16 00:11:38.682 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:11:38.683 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:11:38.685 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@485e65e0]
2025-07-16 00:11:38.687 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:11:38.688 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:11:38.691 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:11:38.692 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1220784752<open>)]
2025-07-16 00:11:38.692 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:11:38.696 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@659353505 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511]
2025-07-16 00:11:38.698 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:11:38.699 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:11:38.699 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1220784752<open>)] for JPA transaction
2025-07-16 00:11:38.700 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:11:38.701 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:11:38.702 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@1ca6138c]
2025-07-16 00:11:38.703 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:11:39.584 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:11:39.585 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1220784752<open>)]
2025-07-16 00:11:39.587 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:11:39.588 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:11:39.589 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:11:39.590 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:11:39.591 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:11:39.593 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:11:39.593 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:11:39.594 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:11:39.594 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:11:39.594 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:11:39.594 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:11:39.595 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:11:39.596 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:11:39.597 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:11:39.597 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=EXCITED, energyLevel=40, hungerLevel=45, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:10:21.785375}
2025-07-16 00:11:39.599 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:11:39.614 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:11:39.615 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:11:39.616 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:11:40.207 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:11:40.208 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=EXCITED, energyLevel=40, hungerLevel=45, userId=1, u (truncated)...]
2025-07-16 00:11:40.210 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:11:40.211 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:11:41.033 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:11:41.035 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:11:44.357 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@4c76b4fa is alive
2025-07-16 00:11:45.978 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/13
2025-07-16 00:11:45.984 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:11:45.986 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:11:45.989 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:11:45.990 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:11:45.991 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@1728cf9a
2025-07-16 00:11:45.991 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:11:45.992 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:11:45.994 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:11:45.995 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:11:45.996 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:11:46.000 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@982392408 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@2030414712 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:11:46.002 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:11:46.003 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:11:46.008 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:11:46.009 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:11:46.010 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:11:46.011 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:11:46.013 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:11:46.014 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:11:46.016 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=25, hungerLevel=60]]
2025-07-16 00:11:46.017 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:11:46.018 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:11:46.019 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=25, hungerLevel=60]
2025-07-16 00:11:46.019 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:11:46.020 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:11:46.021 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:11:46.022 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:11:46.023 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@11a0ad8f
2025-07-16 00:11:46.023 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:11:46.024 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:11:46.024 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:11:46.069 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:11:46.070 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:11:46.073 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@683690239 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@87655712 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:11:46.074 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:11:46.075 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:11:46.080 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:11:46.080 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:11:46.081 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=25, hungerLevel=60]
2025-07-16 00:11:46.081 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:11:46.082 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(582205424<open>)] for JPA transaction
2025-07-16 00:11:46.083 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:11:46.084 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1648398113 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511] read-only
2025-07-16 00:11:46.086 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:11:46.086 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:11:46.090 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@36d8628f]
2025-07-16 00:11:46.091 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:11:46.774 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:11:46.778 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:11:46.779 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(582205424<open>)]
2025-07-16 00:11:46.779 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:11:46.782 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1648398113 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511]
2025-07-16 00:11:46.783 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:11:46.783 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:11:46.784 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(582205424<open>)] for JPA transaction
2025-07-16 00:11:46.784 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:11:46.784 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:11:46.786 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@1bd141fa]
2025-07-16 00:11:46.786 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:11:46.787 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:11:46.788 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(582205424<open>)]
2025-07-16 00:11:46.788 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:11:46.789 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:11:46.789 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:11:46.789 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:11:46.789 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:11:46.790 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:11:46.790 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:11:46.790 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:11:46.790 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:11:47.332 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:11:47.332 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:11:47.333 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:11:47.333 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:11:47.333 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:11:47.333 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=EXCITED, energyLevel=25, hungerLevel=60, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:11:39.599908}
2025-07-16 00:11:47.335 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:11:47.349 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:11:47.349 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:11:47.350 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:11:47.351 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:11:47.352 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=EXCITED, energyLevel=25, hungerLevel=60, userId=1, u (truncated)...]
2025-07-16 00:11:47.354 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:11:47.355 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:11:50.651 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:11:50.655 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:11:50.656 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:11:50.658 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:11:50.659 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@5ff7eaf5
2025-07-16 00:11:50.659 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:11:50.661 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:11:50.663 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:11:50.664 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:11:50.665 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:11:50.669 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1360288637 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1235961972 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:11:50.670 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:11:50.671 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:11:50.675 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:11:50.676 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:11:50.679 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:11:50.680 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:11:50.681 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:11:50.682 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:11:50.685 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=10, hungerLevel=75]]
2025-07-16 00:11:50.686 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:11:50.687 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:11:50.688 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=10, hungerLevel=75]
2025-07-16 00:11:50.689 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:11:50.689 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:11:50.690 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:11:50.690 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:11:50.692 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@70e4190e
2025-07-16 00:11:50.693 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:11:50.693 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:11:50.694 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:11:50.726 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:11:50.727 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:11:50.730 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1427740589 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1313928673 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:11:50.731 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:11:50.732 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:11:50.735 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:11:50.736 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:11:50.737 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=10, hungerLevel=75]
2025-07-16 00:11:50.737 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:11:50.738 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1744287225<open>)] for JPA transaction
2025-07-16 00:11:50.739 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:11:50.741 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@771464392 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511] read-only
2025-07-16 00:11:50.744 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:11:50.744 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:11:50.746 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@21e1a1b7]
2025-07-16 00:11:50.747 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:11:51.302 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:11:51.305 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:11:51.306 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1744287225<open>)]
2025-07-16 00:11:51.307 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:11:51.310 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@771464392 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511]
2025-07-16 00:11:51.313 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:11:51.313 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:11:51.314 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1744287225<open>)] for JPA transaction
2025-07-16 00:11:51.314 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:11:51.315 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:11:51.317 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@7bbe4fe5]
2025-07-16 00:11:51.318 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:11:51.318 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:11:51.319 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1744287225<open>)]
2025-07-16 00:11:51.319 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:11:51.320 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:11:51.320 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:11:51.321 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:11:51.321 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:11:51.323 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:11:51.324 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:11:51.325 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:11:51.325 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:11:51.618 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:11:51.619 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:11:51.619 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:11:51.620 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:11:51.620 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:11:51.620 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=SAD, energyLevel=10, hungerLevel=75, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:11:47.334639}
2025-07-16 00:11:51.622 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:11:51.637 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:11:51.638 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:11:51.639 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:11:51.640 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:11:51.641 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=SAD, energyLevel=10, hungerLevel=75, userId=1, usern (truncated)...]
2025-07-16 00:11:51.643 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:11:51.644 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:11:58.136 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@48b33fb1 is alive
2025-07-16 00:12:00.653 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/13
2025-07-16 00:12:00.660 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:12:00.662 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:12:00.664 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:12:00.665 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:12:00.666 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@e21b945
2025-07-16 00:12:00.667 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:12:00.668 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:12:00.669 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:12:00.671 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:12:00.671 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:12:00.675 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@706088561 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@631602579 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:12:00.676 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:12:00.677 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:12:00.680 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:12:00.725 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:12:00.726 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:12:00.726 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:12:00.728 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:12:00.728 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:12:00.730 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=20, hungerLevel=60]]
2025-07-16 00:12:00.732 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:12:00.734 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:12:00.735 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=20, hungerLevel=60]
2025-07-16 00:12:00.735 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:12:00.735 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:12:00.736 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:12:00.737 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:12:00.738 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@29e8458
2025-07-16 00:12:00.739 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:12:00.740 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:12:00.741 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:12:01.147 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:12:01.147 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:12:01.150 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1338606399 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1055374826 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:12:01.151 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:12:01.152 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:12:01.156 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:12:01.156 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:12:01.157 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=20, hungerLevel=60]
2025-07-16 00:12:01.158 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:12:01.159 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(156368124<open>)] for JPA transaction
2025-07-16 00:12:01.160 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:12:01.160 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1990973797 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511] read-only
2025-07-16 00:12:01.163 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:12:01.164 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:12:01.165 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@4d1c54fb]
2025-07-16 00:12:01.166 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:12:01.712 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:12:01.715 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:12:01.716 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(156368124<open>)]
2025-07-16 00:12:01.717 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:12:01.721 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1990973797 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511]
2025-07-16 00:12:01.723 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:12:01.724 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:12:01.724 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(156368124<open>)] for JPA transaction
2025-07-16 00:12:01.725 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:12:01.726 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:12:01.727 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@21284f4a]
2025-07-16 00:12:01.728 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:12:01.729 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:12:01.729 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(156368124<open>)]
2025-07-16 00:12:01.730 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:12:01.730 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:12:01.730 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:12:01.731 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:12:01.731 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:12:01.732 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:12:01.733 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:12:01.733 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:12:01.734 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:12:02.382 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:12:02.383 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:12:02.384 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:12:02.386 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:12:02.387 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:12:02.387 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=SAD, energyLevel=20, hungerLevel=60, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:11:51.621956}
2025-07-16 00:12:02.389 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:12:02.405 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:12:02.405 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:12:02.406 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:12:02.407 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:12:02.407 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=SAD, energyLevel=20, hungerLevel=60, userId=1, usern (truncated)...]
2025-07-16 00:12:02.409 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:12:02.409 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:12:03.510 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:12:03.513 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:12:03.522 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:12:03.524 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:12:03.525 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@e5ed1d7
2025-07-16 00:12:03.526 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:12:03.526 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:12:03.527 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:12:03.528 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:12:03.529 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:12:03.533 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@2070963442 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1505667606 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:12:03.534 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:12:03.536 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:12:03.886 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:12:03.887 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:12:03.888 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:12:03.889 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:12:03.890 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:12:03.891 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:12:03.892 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=30, hungerLevel=45]]
2025-07-16 00:12:03.894 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:12:03.896 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:12:03.897 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=30, hungerLevel=45]
2025-07-16 00:12:03.899 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:12:03.899 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:12:03.902 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:12:03.902 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:12:03.903 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@39336273
2025-07-16 00:12:03.904 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:12:03.904 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:12:04.245 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@22063a0c is alive
2025-07-16 00:12:04.295 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:12:04.296 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:12:04.296 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:12:04.299 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1673254238 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@2081830088 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:12:04.301 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:12:04.302 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:12:04.305 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:12:04.306 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:12:04.307 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=30, hungerLevel=45]
2025-07-16 00:12:04.308 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:12:04.309 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(2130793082<open>)] for JPA transaction
2025-07-16 00:12:04.309 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:12:04.311 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1463327924 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511] read-only
2025-07-16 00:12:04.313 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:12:04.746 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:12:04.749 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@59588603]
2025-07-16 00:12:04.751 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:12:04.751 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:12:04.755 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:12:04.755 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(2130793082<open>)]
2025-07-16 00:12:04.756 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:12:04.760 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1463327924 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511]
2025-07-16 00:12:04.762 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:12:04.763 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:12:04.764 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(2130793082<open>)] for JPA transaction
2025-07-16 00:12:04.765 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:12:04.765 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:12:04.767 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@12d220ac]
2025-07-16 00:12:04.768 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:12:04.768 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:12:04.769 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(2130793082<open>)]
2025-07-16 00:12:04.769 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:12:04.769 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:12:04.769 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:12:04.770 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:12:04.770 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:12:04.771 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:12:05.923 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:12:05.924 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:12:05.924 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:12:05.926 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:12:05.926 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:12:05.926 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:12:05.926 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:12:05.926 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:12:05.927 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=SAD, energyLevel=30, hungerLevel=45, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:12:02.388604}
2025-07-16 00:12:05.928 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:12:05.941 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:12:05.941 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:12:05.942 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:12:05.942 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:12:05.943 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=SAD, energyLevel=30, hungerLevel=45, userId=1, usern (truncated)...]
2025-07-16 00:12:05.944 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:12:05.945 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:12:06.959 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/13
2025-07-16 00:12:06.965 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:12:06.968 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:12:06.970 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:12:06.971 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:12:06.973 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@53df189c
2025-07-16 00:12:06.974 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:12:06.976 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:12:06.977 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:12:06.978 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:12:06.978 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:12:06.982 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@2040674234 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@670688265 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:12:06.983 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:12:06.984 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:12:07.259 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:12:07.259 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:12:07.260 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:12:07.261 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:12:07.262 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:12:07.263 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:12:07.265 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=40, hungerLevel=30]]
2025-07-16 00:12:07.267 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:12:07.268 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:12:07.269 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=40, hungerLevel=30]
2025-07-16 00:12:07.269 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:12:07.269 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:12:07.271 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:12:07.271 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:12:07.272 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@51f8f044
2025-07-16 00:12:07.273 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:12:07.273 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:12:07.902 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:12:07.904 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:12:07.904 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:12:07.909 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1457698594 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@282541403 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:12:07.912 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:12:07.913 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:12:07.916 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:12:07.917 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:12:07.918 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=40, hungerLevel=30]
2025-07-16 00:12:07.918 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:12:07.919 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(2031148251<open>)] for JPA transaction
2025-07-16 00:12:07.919 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:12:07.919 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@508522509 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511] read-only
2025-07-16 00:12:07.921 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:12:08.603 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:12:08.604 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@842aff1]
2025-07-16 00:12:08.606 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:12:08.606 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:12:08.610 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:12:08.610 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(2031148251<open>)]
2025-07-16 00:12:08.610 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:12:08.613 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@508522509 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511]
2025-07-16 00:12:08.615 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:12:08.616 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:12:08.616 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(2031148251<open>)] for JPA transaction
2025-07-16 00:12:08.617 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:12:08.617 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:12:08.618 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@ee8a0b5]
2025-07-16 00:12:08.619 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:12:08.620 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:12:08.621 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(2031148251<open>)]
2025-07-16 00:12:08.622 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:12:08.622 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:12:08.623 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:12:08.624 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:12:08.625 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:12:08.626 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:12:09.284 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:12:09.284 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:12:09.285 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:12:09.285 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:12:09.286 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:12:09.286 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:12:09.287 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:12:09.287 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:12:09.288 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=SAD, energyLevel=40, hungerLevel=30, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:12:05.928997}
2025-07-16 00:12:09.289 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:12:09.305 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:12:09.306 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:12:09.306 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:12:09.307 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:12:09.308 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=SAD, energyLevel=40, hungerLevel=30, userId=1, usern (truncated)...]
2025-07-16 00:12:09.310 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:12:09.312 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:12:10.432 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:12:10.434 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:12:10.436 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:12:10.437 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:12:10.438 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@570ed70d
2025-07-16 00:12:10.438 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:12:10.439 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:12:10.440 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:12:10.440 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:12:10.441 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:12:10.446 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1381325223 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@164702666 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:12:10.447 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:12:10.448 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:12:10.508 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:12:10.509 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:12:10.510 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:12:10.511 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:12:10.512 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:12:10.512 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:12:10.514 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=50, hungerLevel=15]]
2025-07-16 00:12:10.516 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:12:10.516 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:12:10.517 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=50, hungerLevel=15]
2025-07-16 00:12:10.517 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:12:10.517 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:12:10.519 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:12:10.520 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:12:10.522 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@1bb372af
2025-07-16 00:12:10.522 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:12:10.524 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:12:11.047 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:12:11.095 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:12:11.095 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:12:11.096 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:12:11.097 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:12:11.101 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1820903566 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1114406992 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:12:11.102 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:12:11.103 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:12:11.106 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:12:11.107 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:12:11.108 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=50, hungerLevel=15]
2025-07-16 00:12:11.109 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:12:11.110 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1885883051<open>)] for JPA transaction
2025-07-16 00:12:11.110 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:12:11.110 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1453892606 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511] read-only
2025-07-16 00:12:11.644 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:12:11.645 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:12:11.647 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@3f55448b]
2025-07-16 00:12:11.649 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:12:11.649 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:12:11.652 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:12:11.653 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1885883051<open>)]
2025-07-16 00:12:11.654 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:12:11.657 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1453892606 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511]
2025-07-16 00:12:11.660 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:12:11.661 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:12:11.661 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1885883051<open>)] for JPA transaction
2025-07-16 00:12:11.662 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:12:11.662 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:12:11.664 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@290adffa]
2025-07-16 00:12:11.665 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:12:11.666 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:12:11.666 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1885883051<open>)]
2025-07-16 00:12:11.666 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:12:11.667 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:12:11.667 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:12:11.668 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:12:11.668 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:12:12.289 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:12:12.290 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:12:12.290 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:12:12.291 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:12:12.291 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:12:12.292 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:12:12.293 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:12:12.294 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:12:12.294 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:12:12.294 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=NEUTRAL, energyLevel=50, hungerLevel=15, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:12:09.289584}
2025-07-16 00:12:12.295 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:12:12.310 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:12:12.311 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:12:12.311 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:12:12.312 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:12:12.313 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=NEUTRAL, energyLevel=50, hungerLevel=15, userId=1, u (truncated)...]
2025-07-16 00:12:12.315 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:12:12.316 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:12:13.380 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/13
2025-07-16 00:12:13.387 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:12:13.389 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:12:13.391 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:12:13.392 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:12:13.394 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@b37ae03
2025-07-16 00:12:13.394 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:12:13.395 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:12:13.396 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:12:13.397 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:12:13.397 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:12:13.402 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1794534742 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@267920421 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:12:13.403 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:12:13.404 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:12:13.429 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:12:13.429 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:12:13.430 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:12:13.431 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:12:13.432 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:12:13.434 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:12:13.436 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=60, hungerLevel=0]]
2025-07-16 00:12:13.438 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:12:13.439 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:12:13.440 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=60, hungerLevel=0]
2025-07-16 00:12:13.440 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:12:13.440 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:12:13.442 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:12:13.442 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:12:13.443 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@ef950df
2025-07-16 00:12:13.444 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:12:13.444 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:12:14.004 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1eebc3dc is alive
2025-07-16 00:12:14.229 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:12:14.230 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:12:14.231 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:12:14.236 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@155800749 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1003121570 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:12:14.238 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:12:14.239 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:12:14.244 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:12:14.245 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:12:14.245 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=60, hungerLevel=0]
2025-07-16 00:12:14.247 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:12:14.249 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(688143923<open>)] for JPA transaction
2025-07-16 00:12:14.251 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:12:14.253 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@485830078 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511] read-only
2025-07-16 00:12:15.330 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:12:15.331 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:12:15.333 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@5b99b400]
2025-07-16 00:12:15.335 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:12:15.335 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:12:15.338 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:12:15.339 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(688143923<open>)]
2025-07-16 00:12:15.340 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:12:15.344 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@485830078 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511]
2025-07-16 00:12:15.347 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:12:15.347 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:12:15.348 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(688143923<open>)] for JPA transaction
2025-07-16 00:12:15.349 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:12:15.350 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:12:15.353 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@f83658f]
2025-07-16 00:12:15.354 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:12:15.355 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:12:15.356 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(688143923<open>)]
2025-07-16 00:12:15.357 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:12:15.357 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:12:15.358 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:12:15.359 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:12:15.359 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:12:15.861 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:12:15.862 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:12:15.863 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:12:15.863 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:12:15.863 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:12:15.863 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:12:15.863 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:12:15.864 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:12:15.864 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:12:15.864 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=NEUTRAL, energyLevel=60, hungerLevel=0, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:12:12.295275}
2025-07-16 00:12:15.866 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:12:15.879 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:12:15.880 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:12:15.880 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:12:15.882 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:12:15.882 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=NEUTRAL, energyLevel=60, hungerLevel=0, userId=1, us (truncated)...]
2025-07-16 00:12:15.885 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:12:15.886 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:12:17.564 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@80f4492 is alive
2025-07-16 00:12:23.341 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/13
2025-07-16 00:12:23.348 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:12:23.351 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:12:23.354 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:12:23.355 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:12:23.356 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@1b816285
2025-07-16 00:12:23.357 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:12:23.357 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:12:23.358 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:12:23.359 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:12:23.360 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:12:23.364 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1347951960 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@2146217249 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:12:23.367 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:12:23.368 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:12:23.372 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:12:23.373 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:12:23.374 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:12:23.376 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:12:23.377 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:12:23.378 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:12:23.380 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=45, hungerLevel=15]]
2025-07-16 00:12:23.382 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:12:23.384 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:12:23.385 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=45, hungerLevel=15]
2025-07-16 00:12:23.385 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:12:23.385 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:12:23.387 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:12:23.388 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:12:23.389 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@5db392f1
2025-07-16 00:12:23.390 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:12:23.390 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:12:23.462 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:12:23.463 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:12:23.463 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:12:23.467 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1397883655 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@523230312 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:12:23.469 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:12:23.470 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:12:23.475 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:12:23.475 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:12:23.476 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=45, hungerLevel=15]
2025-07-16 00:12:23.477 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:12:23.477 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(980080057<open>)] for JPA transaction
2025-07-16 00:12:23.478 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:12:23.937 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1963276823 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511] read-only
2025-07-16 00:12:23.940 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:12:23.940 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:12:23.942 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@5b209968]
2025-07-16 00:12:23.944 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:12:23.944 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:12:23.948 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:12:23.948 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(980080057<open>)]
2025-07-16 00:12:23.949 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:12:23.951 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1963276823 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511]
2025-07-16 00:12:23.953 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:12:23.954 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:12:23.955 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(980080057<open>)] for JPA transaction
2025-07-16 00:12:23.955 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:12:23.956 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:12:23.957 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@1a7e4678]
2025-07-16 00:12:23.958 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:12:23.959 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:12:23.960 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(980080057<open>)]
2025-07-16 00:12:23.961 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:12:23.961 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:12:23.962 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:12:23.963 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:12:24.409 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:12:24.410 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:12:24.411 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:12:24.411 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:12:24.411 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:12:24.412 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:12:24.412 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:12:24.412 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:12:24.413 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:12:24.413 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:12:24.413 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=NEUTRAL, energyLevel=45, hungerLevel=15, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:12:15.865508}
2025-07-16 00:12:24.415 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:12:24.434 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:12:24.434 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:12:24.435 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:12:24.435 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:12:24.436 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=NEUTRAL, energyLevel=45, hungerLevel=15, userId=1, u (truncated)...]
2025-07-16 00:12:24.439 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:12:24.440 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:12:27.930 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1e943acb is alive
2025-07-16 00:12:30.296 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@98e358a is alive
2025-07-16 00:12:36.206 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@7b2c99ca is alive
2025-07-16 00:12:41.100 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:12:41.101 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:12:55.293 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@63525b31 is alive
2025-07-16 00:13:11.111 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:13:11.112 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:13:14.048 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/13
2025-07-16 00:13:14.055 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:13:14.057 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:13:14.059 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:13:14.060 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:13:14.061 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@1bba7092
2025-07-16 00:13:14.061 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:13:14.062 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:13:14.064 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:13:14.065 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:13:14.065 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:13:14.070 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1763813726 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1516602309 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:13:14.072 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:13:14.073 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:13:14.077 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:13:14.078 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:13:14.079 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:13:14.080 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:13:14.081 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:13:14.082 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:13:14.083 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=55, hungerLevel=0]]
2025-07-16 00:13:14.086 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:13:14.087 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:13:14.087 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=55, hungerLevel=0]
2025-07-16 00:13:14.087 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:13:14.087 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:13:14.088 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:13:14.089 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:13:14.090 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@6d6febe5
2025-07-16 00:13:14.090 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:13:14.090 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:13:14.120 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:13:14.121 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:13:14.121 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:13:14.124 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1188692245 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@287605529 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:13:14.125 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:13:14.126 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:13:14.130 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:13:14.131 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:13:14.132 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=55, hungerLevel=0]
2025-07-16 00:13:14.133 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:13:14.135 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(957000208<open>)] for JPA transaction
2025-07-16 00:13:14.135 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:13:14.856 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@386627937 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511] read-only
2025-07-16 00:13:14.858 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:13:14.858 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:13:14.860 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@5d5881c7]
2025-07-16 00:13:14.860 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:13:14.861 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:13:14.864 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:13:14.865 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(957000208<open>)]
2025-07-16 00:13:14.865 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:13:14.868 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@386627937 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511]
2025-07-16 00:13:14.871 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:13:14.871 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:13:14.871 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(957000208<open>)] for JPA transaction
2025-07-16 00:13:14.872 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:13:14.872 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:13:14.874 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@277526c0]
2025-07-16 00:13:14.875 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:13:14.875 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:13:14.876 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(957000208<open>)]
2025-07-16 00:13:14.876 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:13:14.876 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:13:14.877 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:13:14.877 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:13:15.417 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:13:15.418 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:13:15.419 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:13:15.419 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:13:15.419 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:13:15.419 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:13:15.420 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:13:15.420 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:13:15.420 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:13:15.421 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:13:15.421 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=NEUTRAL, energyLevel=55, hungerLevel=0, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:12:24.414025}
2025-07-16 00:13:15.423 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:13:15.437 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:13:15.438 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:13:15.438 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:13:15.439 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:13:15.440 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=NEUTRAL, energyLevel=55, hungerLevel=0, userId=1, us (truncated)...]
2025-07-16 00:13:15.441 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:13:15.442 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:13:18.092 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:13:18.098 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:13:18.101 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:13:18.102 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:13:18.104 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@a63092b
2025-07-16 00:13:18.105 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:13:18.107 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:13:18.108 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:13:18.112 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:13:18.113 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:13:18.119 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1507068059 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1518799356 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:13:18.120 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:13:18.121 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:13:18.128 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:13:18.129 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:13:18.130 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:13:18.132 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:13:18.133 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:13:18.134 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:13:18.135 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=65, hungerLevel=0]]
2025-07-16 00:13:18.137 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:13:18.139 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:13:18.139 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=65, hungerLevel=0]
2025-07-16 00:13:18.523 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:13:18.524 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:13:18.525 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:13:18.526 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:13:18.527 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@6ed7f38a
2025-07-16 00:13:18.528 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:13:18.529 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:13:18.530 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:13:18.532 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:13:18.533 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:13:18.537 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1272403183 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@724394146 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:13:18.538 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:13:18.539 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:13:19.063 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:13:19.064 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:13:19.064 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=65, hungerLevel=0]
2025-07-16 00:13:19.065 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:13:19.066 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1651597160<open>)] for JPA transaction
2025-07-16 00:13:19.066 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:13:19.067 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1208542236 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511] read-only
2025-07-16 00:13:19.068 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:13:19.069 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:13:19.070 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@66d72a67]
2025-07-16 00:13:19.072 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:13:19.072 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:13:19.076 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:13:19.077 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1651597160<open>)]
2025-07-16 00:13:19.078 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:13:19.081 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1208542236 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511]
2025-07-16 00:13:19.084 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:13:19.084 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:13:19.085 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1651597160<open>)] for JPA transaction
2025-07-16 00:13:19.086 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:13:19.086 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:13:19.087 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@1adb0325]
2025-07-16 00:13:19.786 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:13:19.787 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:13:19.788 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1651597160<open>)]
2025-07-16 00:13:19.788 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:13:19.789 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:13:19.789 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:13:19.790 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:13:19.790 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:13:19.791 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:13:19.791 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:13:19.791 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:13:19.792 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:13:19.793 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:13:19.794 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:13:19.794 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:13:19.794 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:13:19.795 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:13:19.795 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=NEUTRAL, energyLevel=65, hungerLevel=0, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:13:15.423530}
2025-07-16 00:13:19.797 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:13:19.813 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:13:20.582 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:13:20.582 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:13:20.584 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:13:20.585 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=NEUTRAL, energyLevel=65, hungerLevel=0, userId=1, us (truncated)...]
2025-07-16 00:13:20.587 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:13:20.589 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:13:21.488 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@4c76b4fa is alive
2025-07-16 00:13:41.123 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:13:41.124 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:13:46.755 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@22063a0c is alive
2025-07-16 00:13:50.738 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1eebc3dc is alive
2025-07-16 00:13:56.183 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@80f4492 is alive
2025-07-16 00:13:57.538 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@48b33fb1 is alive
2025-07-16 00:14:04.646 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1e943acb is alive
2025-07-16 00:14:11.137 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:14:11.138 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:14:12.352 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@98e358a is alive
2025-07-16 00:14:16.935 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@5a13b511 is alive
2025-07-16 00:14:23.609 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@7b2c99ca is alive
2025-07-16 00:14:39.571 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@63525b31 is alive
2025-07-16 00:14:41.153 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:14:41.154 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:14:58.621 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@4c76b4fa is alive
2025-07-16 00:15:11.154 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:15:11.155 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:15:27.236 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1eebc3dc is alive
2025-07-16 00:15:29.210 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@22063a0c is alive
2025-07-16 00:15:34.804 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@80f4492 is alive
2025-07-16 00:15:41.169 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:15:41.170 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:15:41.359 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1e943acb is alive
2025-07-16 00:15:54.417 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@98e358a is alive
2025-07-16 00:15:56.938 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@48b33fb1 is alive
2025-07-16 00:16:01.532 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/15
2025-07-16 00:16:01.538 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/15
2025-07-16 00:16:01.540 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:16:01.542 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:16:01.543 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:16:01.544 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@3fef3740
2025-07-16 00:16:01.545 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:16:01.546 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:16:01.547 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:16:01.548 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:16:01.549 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:16:01.552 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1641945407 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@954681082 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:16:01.554 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:16:01.555 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:16:01.561 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:16:01.561 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:16:01.563 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/15
2025-07-16 00:16:01.564 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/15", parameters={}
2025-07-16 00:16:01.565 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:16:01.566 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:16:01.568 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=75, hungerLevel=15]]
2025-07-16 00:16:01.570 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:16:01.571 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:16:01.572 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 15. Info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=75, hungerLevel=15]
2025-07-16 00:16:01.572 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:16:01.572 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:16:01.574 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:16:01.574 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:16:01.575 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@258f7464
2025-07-16 00:16:01.576 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:16:01.576 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:16:01.600 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:16:01.601 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:16:01.602 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:16:01.604 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@10851650 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@726820203 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:16:01.606 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:16:01.606 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:16:01.610 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:16:01.611 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:16:01.611 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 15 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=75, hungerLevel=15]
2025-07-16 00:16:01.612 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:16:01.612 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(906524075<open>)] for JPA transaction
2025-07-16 00:16:01.612 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:16:02.228 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1189384257 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511] read-only
2025-07-16 00:16:02.230 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:16:02.231 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:16:02.232 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@417a5e7b]
2025-07-16 00:16:02.233 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:16:02.234 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:16:02.237 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:16:02.238 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(906524075<open>)]
2025-07-16 00:16:02.239 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:16:02.243 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1189384257 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511]
2025-07-16 00:16:02.244 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:16:02.245 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 15.
2025-07-16 00:16:02.246 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(906524075<open>)] for JPA transaction
2025-07-16 00:16:02.246 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:16:02.247 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:16:02.249 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@29b6d923]
2025-07-16 00:16:02.250 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:16:02.250 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:16:02.251 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(906524075<open>)]
2025-07-16 00:16:02.251 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:16:02.251 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:16:02.252 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:16:02.252 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:16:02.430 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:16:02.431 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:16:02.431 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:16:02.432 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:16:02.432 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:16:02.433 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:16:02.434 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:16:02.434 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:16:02.435 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T19:15:12.829268, mood=EXCITED, energyLevel=75, hungerLevel=15, petType=VEGETA, name=PEPE, id=15, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-15T23:22:35.086801}
2025-07-16 00:16:02.436 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:16:02.436 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:16:02.438 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:16:02.451 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:16:02.452 INFO  S502.virtualPets.service.PetService : Pet 'PEPE' (ID: 15) Updated successfully by the user 'Sergio'.
2025-07-16 00:16:02.452 INFO  S.virtualPets.controller.PetController : Pet with ID 15 updated successfully.
2025-07-16 00:16:02.453 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:16:02.454 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=15, name=PEPE, type=VEGETA, mood=EXCITED, energyLevel=75, hungerLevel=15, userId=1 (truncated)...]
2025-07-16 00:16:02.455 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:16:02.456 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:16:03.084 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/15
2025-07-16 00:16:03.087 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:16:03.090 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:16:03.091 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:16:03.092 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@7408bc13
2025-07-16 00:16:03.093 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:16:03.094 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:16:03.095 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:16:03.096 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:16:03.098 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:16:03.102 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@319600407 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1277709319 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:16:03.104 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:16:03.104 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:16:03.274 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:16:03.275 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:16:03.277 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/15
2025-07-16 00:16:03.278 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/15", parameters={}
2025-07-16 00:16:03.279 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:16:03.279 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:16:03.282 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=60, hungerLevel=30]]
2025-07-16 00:16:03.284 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:16:03.285 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:16:03.285 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 15. Info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=60, hungerLevel=30]
2025-07-16 00:16:03.285 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:16:03.286 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:16:03.287 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:16:03.288 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:16:03.288 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@3a3c4302
2025-07-16 00:16:03.289 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:16:03.290 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:16:03.692 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:16:03.693 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:16:03.694 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:16:03.697 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@824033784 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@811961142 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:16:03.698 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:16:03.699 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:16:03.702 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:16:03.702 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:16:03.703 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 15 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=60, hungerLevel=30]
2025-07-16 00:16:03.703 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:16:03.703 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(351307479<open>)] for JPA transaction
2025-07-16 00:16:03.703 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:16:03.704 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1975932221 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511] read-only
2025-07-16 00:16:03.706 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:16:03.707 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:16:03.927 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@4ccebe3a]
2025-07-16 00:16:03.929 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:16:03.930 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:16:03.932 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:16:03.933 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(351307479<open>)]
2025-07-16 00:16:03.933 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:16:03.935 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1975932221 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511]
2025-07-16 00:16:03.938 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:16:03.938 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 15.
2025-07-16 00:16:03.939 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(351307479<open>)] for JPA transaction
2025-07-16 00:16:03.940 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:16:03.940 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:16:03.942 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@2d0b0d0f]
2025-07-16 00:16:03.943 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:16:03.944 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:16:03.944 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(351307479<open>)]
2025-07-16 00:16:03.944 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:16:03.945 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:16:03.945 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:16:03.946 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:16:03.946 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:16:03.947 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:16:04.534 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:16:04.535 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:16:04.535 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:16:04.536 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:16:04.536 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:16:04.537 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:16:04.538 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T19:15:12.829268, mood=EXCITED, energyLevel=60, hungerLevel=30, petType=VEGETA, name=PEPE, id=15, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:16:02.437575}
2025-07-16 00:16:04.539 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:16:04.539 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:16:04.541 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:16:04.556 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:16:04.556 INFO  S502.virtualPets.service.PetService : Pet 'PEPE' (ID: 15) Updated successfully by the user 'Sergio'.
2025-07-16 00:16:04.557 INFO  S.virtualPets.controller.PetController : Pet with ID 15 updated successfully.
2025-07-16 00:16:04.559 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:16:04.560 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=15, name=PEPE, type=VEGETA, mood=EXCITED, energyLevel=60, hungerLevel=30, userId=1 (truncated)...]
2025-07-16 00:16:04.562 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:16:04.562 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:16:05.390 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/15
2025-07-16 00:16:05.392 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:16:05.394 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:16:05.394 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:16:05.396 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@310a4b28
2025-07-16 00:16:05.397 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:16:05.398 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:16:05.398 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:16:05.400 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:16:05.400 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:16:05.404 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@28388920 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@998948345 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:16:05.405 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:16:05.406 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:16:05.447 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:16:05.447 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:16:05.448 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/15
2025-07-16 00:16:05.449 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/15", parameters={}
2025-07-16 00:16:05.450 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:16:05.451 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:16:05.452 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=45, hungerLevel=45]]
2025-07-16 00:16:05.454 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:16:05.456 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:16:05.457 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 15. Info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=45, hungerLevel=45]
2025-07-16 00:16:05.457 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:16:05.458 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:16:05.460 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:16:05.461 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:16:05.463 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@185f4356
2025-07-16 00:16:05.464 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:16:05.464 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:16:05.880 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:16:05.881 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:16:05.882 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:16:05.885 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@959495124 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1585059055 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:16:05.886 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:16:05.887 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:16:05.892 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:16:05.893 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:16:05.894 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 15 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=45, hungerLevel=45]
2025-07-16 00:16:05.895 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:16:05.895 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1404604885<open>)] for JPA transaction
2025-07-16 00:16:05.896 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:16:05.896 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1651186189 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511] read-only
2025-07-16 00:16:05.898 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:16:05.899 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:16:05.900 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@6aab7050]
2025-07-16 00:16:06.168 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:16:06.169 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:16:06.173 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:16:06.174 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1404604885<open>)]
2025-07-16 00:16:06.175 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:16:06.178 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1651186189 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511]
2025-07-16 00:16:06.181 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:16:06.182 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 15.
2025-07-16 00:16:06.182 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1404604885<open>)] for JPA transaction
2025-07-16 00:16:06.183 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:16:06.183 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:16:06.185 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@12de4bf]
2025-07-16 00:16:06.186 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:16:06.187 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:16:06.187 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1404604885<open>)]
2025-07-16 00:16:06.188 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:16:06.188 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:16:06.188 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:16:06.189 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:16:06.190 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:16:06.191 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:16:06.191 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:16:06.192 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:16:06.833 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:16:06.834 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:16:06.835 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:16:06.835 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:16:06.837 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T19:15:12.829268, mood=EXCITED, energyLevel=45, hungerLevel=45, petType=VEGETA, name=PEPE, id=15, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:16:04.540749}
2025-07-16 00:16:06.838 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:16:06.838 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:16:06.840 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:16:06.852 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:16:06.853 INFO  S502.virtualPets.service.PetService : Pet 'PEPE' (ID: 15) Updated successfully by the user 'Sergio'.
2025-07-16 00:16:06.853 INFO  S.virtualPets.controller.PetController : Pet with ID 15 updated successfully.
2025-07-16 00:16:06.854 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:16:06.856 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=15, name=PEPE, type=VEGETA, mood=EXCITED, energyLevel=45, hungerLevel=45, userId=1 (truncated)...]
2025-07-16 00:16:06.859 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:16:06.860 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:16:09.549 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@5a13b511 is alive
2025-07-16 00:16:11.008 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@7b2c99ca is alive
2025-07-16 00:16:11.176 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:16:11.177 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:16:13.206 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/13
2025-07-16 00:16:13.212 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:16:13.214 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:16:13.216 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:16:13.217 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:16:13.219 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@761f7e87
2025-07-16 00:16:13.219 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:16:13.220 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:16:13.221 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:16:13.222 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:16:13.223 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:16:13.227 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1258407131 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@250882066 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:16:13.229 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:16:13.230 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:16:13.237 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:16:13.238 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:16:13.239 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:16:13.240 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:16:13.240 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:16:13.241 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:16:13.242 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=50, hungerLevel=15]]
2025-07-16 00:16:13.244 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:16:13.244 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:16:13.245 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=50, hungerLevel=15]
2025-07-16 00:16:13.245 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:16:13.246 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:16:13.247 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:16:13.248 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:16:13.249 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@28c31fe8
2025-07-16 00:16:13.250 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:16:13.250 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:16:13.251 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:16:13.330 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:16:13.330 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:16:13.334 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1436061393 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@372861230 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:16:13.335 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:16:13.336 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:16:13.340 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:16:13.341 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:16:13.342 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=50, hungerLevel=15]
2025-07-16 00:16:13.342 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:16:13.343 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1406953585<open>)] for JPA transaction
2025-07-16 00:16:13.343 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:16:13.344 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1329309174 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511] read-only
2025-07-16 00:16:13.346 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:16:13.347 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:16:13.349 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@5fce47b7]
2025-07-16 00:16:13.976 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:16:13.976 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:16:13.979 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:16:13.980 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1406953585<open>)]
2025-07-16 00:16:13.981 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:16:13.984 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1329309174 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511]
2025-07-16 00:16:13.986 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:16:13.987 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:16:13.987 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1406953585<open>)] for JPA transaction
2025-07-16 00:16:13.988 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:16:13.988 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:16:13.991 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@5f3d68da]
2025-07-16 00:16:13.991 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:16:13.992 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:16:13.993 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1406953585<open>)]
2025-07-16 00:16:13.994 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:16:13.994 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:16:13.995 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:16:13.995 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:16:13.996 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:16:13.996 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:16:13.997 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:16:13.997 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:16:15.024 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:16:15.025 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:16:15.026 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:16:15.026 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:16:15.026 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:16:15.026 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:16:15.027 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=NEUTRAL, energyLevel=50, hungerLevel=15, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:13:19.797937}
2025-07-16 00:16:15.028 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:16:15.044 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:16:15.045 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:16:15.045 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:16:15.046 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:16:15.047 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=NEUTRAL, energyLevel=50, hungerLevel=15, userId=1, u (truncated)...]
2025-07-16 00:16:15.050 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:16:15.051 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:16:23.853 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@63525b31 is alive
2025-07-16 00:16:35.750 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@4c76b4fa is alive
2025-07-16 00:16:41.186 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:16:41.187 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:17:03.735 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1eebc3dc is alive
2025-07-16 00:17:11.192 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:17:11.193 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:17:11.674 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@22063a0c is alive
2025-07-16 00:17:13.420 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@80f4492 is alive
2025-07-16 00:17:18.072 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1e943acb is alive
2025-07-16 00:17:36.485 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@98e358a is alive
2025-07-16 00:17:41.209 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:17:41.210 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:17:56.328 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@48b33fb1 is alive
2025-07-16 00:17:58.408 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@7b2c99ca is alive
2025-07-16 00:18:02.166 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@5a13b511 is alive
2025-07-16 00:18:08.137 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@63525b31 is alive
2025-07-16 00:18:11.225 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:18:11.226 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:18:12.877 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@4c76b4fa is alive
2025-07-16 00:18:32.563 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/13
2025-07-16 00:18:32.581 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:18:32.584 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:18:32.587 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:18:32.589 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:18:32.591 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@41a26720
2025-07-16 00:18:32.592 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:18:32.593 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:18:32.593 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:18:32.594 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:18:32.594 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:18:32.597 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@674704089 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@2097462329 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:18:32.599 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:18:32.599 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:18:32.603 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:18:32.604 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:18:32.605 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:18:32.606 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:18:32.607 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:18:32.653 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:18:32.655 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=60, hungerLevel=0]]
2025-07-16 00:18:32.656 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:18:32.657 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:18:32.657 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=60, hungerLevel=0]
2025-07-16 00:18:32.658 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:18:32.658 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:18:32.659 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:18:32.659 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:18:32.660 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@670f5684
2025-07-16 00:18:32.660 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:18:32.660 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:18:32.661 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:18:32.661 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:18:32.662 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:18:33.477 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1921226885 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@402646340 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:18:33.479 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:18:33.480 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:18:33.484 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:18:33.484 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:18:33.484 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=60, hungerLevel=0]
2025-07-16 00:18:33.485 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:18:33.485 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(418626785<open>)] for JPA transaction
2025-07-16 00:18:33.485 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:18:33.485 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@509602731 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511] read-only
2025-07-16 00:18:33.487 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:18:33.488 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:18:33.489 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@2178d2c]
2025-07-16 00:18:33.492 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:18:33.493 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:18:33.497 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:18:33.498 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(418626785<open>)]
2025-07-16 00:18:34.350 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:18:34.352 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@509602731 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511]
2025-07-16 00:18:34.355 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:18:34.355 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:18:34.355 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(418626785<open>)] for JPA transaction
2025-07-16 00:18:34.355 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:18:34.355 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:18:34.357 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@b101d5b]
2025-07-16 00:18:34.358 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:18:34.358 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:18:34.359 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(418626785<open>)]
2025-07-16 00:18:34.359 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:18:34.360 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:18:34.360 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:18:34.360 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:18:34.361 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:18:34.362 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:18:34.362 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:18:34.362 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:18:34.363 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:18:34.363 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:18:34.364 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:18:34.992 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:18:34.993 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:18:34.993 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:18:34.993 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=NEUTRAL, energyLevel=60, hungerLevel=0, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:16:15.028068}
2025-07-16 00:18:34.995 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:18:35.007 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:18:35.007 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:18:35.008 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:18:35.009 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:18:35.009 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=NEUTRAL, energyLevel=60, hungerLevel=0, userId=1, us (truncated)...]
2025-07-16 00:18:35.010 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:18:35.011 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:18:36.879 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:18:36.881 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:18:36.883 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:18:36.883 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:18:36.884 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@11465ac1
2025-07-16 00:18:36.885 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:18:36.886 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:18:36.887 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:18:36.887 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:18:36.888 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:18:36.892 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@496601892 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@485910791 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:18:36.897 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:18:36.897 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:18:36.900 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:18:36.901 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:18:36.902 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:18:36.903 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:18:36.904 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:18:36.904 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:18:36.906 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=45, hungerLevel=15]]
2025-07-16 00:18:36.907 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:18:36.908 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:18:36.909 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=45, hungerLevel=15]
2025-07-16 00:18:36.909 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:18:36.910 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:18:36.911 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:18:36.925 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:18:36.928 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@1825bf60
2025-07-16 00:18:36.928 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:18:36.930 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:18:36.931 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:18:36.932 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:18:36.933 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:18:36.936 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@203614128 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1806479692 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:18:36.937 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:18:36.938 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:18:36.941 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:18:37.331 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:18:37.331 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=45, hungerLevel=15]
2025-07-16 00:18:37.331 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:18:37.332 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(847801472<open>)] for JPA transaction
2025-07-16 00:18:37.332 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:18:37.332 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@897685052 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511] read-only
2025-07-16 00:18:37.334 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:18:37.334 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:18:37.336 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@5b819f6]
2025-07-16 00:18:37.337 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:18:37.337 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:18:37.340 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:18:37.340 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(847801472<open>)]
2025-07-16 00:18:37.341 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:18:37.342 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@897685052 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511]
2025-07-16 00:18:37.345 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:18:37.346 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:18:37.347 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(847801472<open>)] for JPA transaction
2025-07-16 00:18:37.348 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:18:37.349 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:18:37.350 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@3120465]
2025-07-16 00:18:37.350 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:18:37.617 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:18:37.618 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(847801472<open>)]
2025-07-16 00:18:37.618 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:18:37.618 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:18:37.619 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:18:37.619 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:18:37.619 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:18:37.620 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:18:37.620 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:18:37.620 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:18:37.621 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:18:37.622 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:18:37.622 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:18:37.623 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:18:37.623 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:18:37.623 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:18:37.623 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=NEUTRAL, energyLevel=45, hungerLevel=15, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:18:34.994141}
2025-07-16 00:18:37.624 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:18:37.636 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:18:37.637 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:18:38.041 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:18:38.042 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:18:38.042 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=NEUTRAL, energyLevel=45, hungerLevel=15, userId=1, u (truncated)...]
2025-07-16 00:18:38.044 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:18:38.045 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:18:40.125 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/13
2025-07-16 00:18:40.132 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:18:40.134 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:18:40.136 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:18:40.137 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:18:40.138 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@7de02430
2025-07-16 00:18:40.139 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:18:40.140 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:18:40.143 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:18:40.144 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:18:40.144 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:18:40.148 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1955075551 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@2106219047 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:18:40.149 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:18:40.150 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:18:40.153 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:18:40.154 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:18:40.155 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:18:40.156 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:18:40.158 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:18:40.159 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:18:40.206 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=55, hungerLevel=0]]
2025-07-16 00:18:40.207 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:18:40.210 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:18:40.212 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=55, hungerLevel=0]
2025-07-16 00:18:40.213 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:18:40.214 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:18:40.215 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:18:40.215 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:18:40.216 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@6d61eb78
2025-07-16 00:18:40.217 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:18:40.218 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:18:40.219 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:18:40.220 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:18:40.221 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:18:40.234 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1eebc3dc is alive
2025-07-16 00:18:40.800 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1230673451 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1198904452 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:18:40.801 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:18:40.801 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:18:40.805 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:18:40.805 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:18:40.806 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=55, hungerLevel=0]
2025-07-16 00:18:40.806 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:18:40.806 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(754689406<open>)] for JPA transaction
2025-07-16 00:18:40.807 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:18:40.808 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@626392542 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511] read-only
2025-07-16 00:18:40.810 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:18:40.811 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:18:40.812 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@4cce527a]
2025-07-16 00:18:40.813 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:18:40.814 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:18:41.233 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=9/10, active=1, waiting=0)
2025-07-16 00:18:41.329 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:18:41.331 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:18:41.332 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(754689406<open>)]
2025-07-16 00:18:41.332 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:18:41.334 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@626392542 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511]
2025-07-16 00:18:41.335 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:18:41.336 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:18:41.336 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(754689406<open>)] for JPA transaction
2025-07-16 00:18:41.336 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:18:41.337 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:18:41.338 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@34e3289d]
2025-07-16 00:18:41.339 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:18:41.340 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:18:41.340 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(754689406<open>)]
2025-07-16 00:18:41.340 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:18:41.341 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:18:41.341 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:18:41.342 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:18:41.343 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:18:41.344 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:18:41.344 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:18:41.344 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:18:41.344 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:18:41.827 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:18:41.828 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:18:41.828 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:18:41.829 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:18:41.830 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:18:41.830 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=NEUTRAL, energyLevel=55, hungerLevel=0, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:18:37.624945}
2025-07-16 00:18:41.832 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:18:41.844 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:18:41.844 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:18:41.844 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:18:41.845 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:18:41.846 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=NEUTRAL, energyLevel=55, hungerLevel=0, userId=1, us (truncated)...]
2025-07-16 00:18:41.848 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:18:41.848 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:18:43.713 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:18:43.716 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:18:43.718 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:18:43.718 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:18:43.719 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@17a85006
2025-07-16 00:18:43.720 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:18:43.721 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:18:43.721 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:18:43.723 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:18:43.723 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:18:43.729 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1626405117 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@257716893 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:18:43.730 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:18:43.731 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:18:43.734 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:18:43.735 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:18:43.736 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:18:43.737 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:18:43.738 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:18:43.738 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:18:43.741 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=40, hungerLevel=15]]
2025-07-16 00:18:43.742 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:18:43.743 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:18:43.744 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=40, hungerLevel=15]
2025-07-16 00:18:43.834 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:18:43.834 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:18:43.835 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:18:43.836 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:18:43.836 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@3f7bc98c
2025-07-16 00:18:43.836 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:18:43.837 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:18:43.838 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:18:43.838 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:18:43.839 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:18:43.843 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1928454037 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1498168925 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:18:43.844 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:18:43.845 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:18:44.390 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:18:44.391 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:18:44.391 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=40, hungerLevel=15]
2025-07-16 00:18:44.392 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:18:44.392 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1478568569<open>)] for JPA transaction
2025-07-16 00:18:44.392 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:18:44.393 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@796999031 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511] read-only
2025-07-16 00:18:44.394 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:18:44.395 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:18:44.396 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@75607c35]
2025-07-16 00:18:44.397 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:18:44.397 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:18:44.400 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:18:44.401 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1478568569<open>)]
2025-07-16 00:18:44.401 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:18:44.403 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@796999031 wrapping com.mysql.cj.jdbc.ConnectionImpl@5a13b511]
2025-07-16 00:18:44.405 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:18:44.406 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:18:44.406 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1478568569<open>)] for JPA transaction
2025-07-16 00:18:44.407 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:18:44.407 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:18:44.408 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@3b05821e]
2025-07-16 00:18:44.963 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:18:44.964 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:18:44.964 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1478568569<open>)]
2025-07-16 00:18:44.964 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:18:44.965 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:18:44.965 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:18:44.965 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:18:44.966 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:18:44.966 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:18:44.966 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:18:44.966 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:18:44.967 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:18:44.967 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:18:44.967 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:18:44.968 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:18:44.968 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:18:44.968 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:18:44.968 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=NEUTRAL, energyLevel=40, hungerLevel=15, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:18:41.831863}
2025-07-16 00:18:44.970 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:18:44.981 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:18:45.463 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:18:45.464 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:18:45.465 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:18:45.465 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=NEUTRAL, energyLevel=40, hungerLevel=15, userId=1, u (truncated)...]
2025-07-16 00:18:45.466 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:18:45.467 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:18:49.036 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@5a13b511: (connection has passed maxLifetime)
2025-07-16 00:18:49.042 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Attempting to create/setup new connection (8b0a262b-a6e8-4232-8e17-4f82c563e31b)
2025-07-16 00:18:49.072 DEBUG jdk.event.security : X509Certificate: Alg:SHA256withRSA, Serial:02, Subject:CN=MySQL_Server_9.2.0_Auto_Generated_Server_Certificate, Issuer:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Key type:RSA, Length:2048, Cert Id:3807498037, Valid from:20/2/25, 10:36, Valid until:18/2/35, 10:36
2025-07-16 00:18:49.073 DEBUG jdk.event.security : X509Certificate: Alg:SHA256withRSA, Serial:01, Subject:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Issuer:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Key type:RSA, Length:2048, Cert Id:3139117285, Valid from:20/2/25, 10:36, Valid until:18/2/35, 10:36
2025-07-16 00:18:49.076 DEBUG jdk.event.security :  TLSHandshake: localhost:3306, TLSv1.3, TLS_AES_128_GCM_SHA256, 3807498037
2025-07-16 00:18:49.082 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Established new connection (8b0a262b-a6e8-4232-8e17-4f82c563e31b)
2025-07-16 00:18:49.083 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@48cdd8da
2025-07-16 00:18:52.047 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@80f4492 is alive
2025-07-16 00:18:54.139 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@22063a0c is alive
2025-07-16 00:18:54.780 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1e943acb is alive
2025-07-16 00:19:01.258 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/13
2025-07-16 00:19:01.264 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:19:01.266 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:19:01.268 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:19:01.269 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:19:01.270 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@6c841f4c
2025-07-16 00:19:01.271 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:19:01.272 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:19:01.273 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:19:01.273 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:19:01.274 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:19:01.280 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1919108238 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@839929337 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:19:01.282 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:19:01.283 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:19:01.288 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:19:01.289 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:19:01.290 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:19:01.291 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:19:01.292 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:19:01.293 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:19:01.295 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=25, hungerLevel=30]]
2025-07-16 00:19:01.297 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:19:01.298 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:19:01.299 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=25, hungerLevel=30]
2025-07-16 00:19:01.299 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:19:01.299 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:19:01.300 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:19:01.301 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:19:01.315 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@2d3760cd
2025-07-16 00:19:01.315 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:19:01.316 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:19:01.317 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:19:01.317 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:19:01.318 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:19:01.322 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1028487424 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1680310975 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:19:01.323 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:19:01.324 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:19:01.329 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:19:01.329 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:19:02.269 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=25, hungerLevel=30]
2025-07-16 00:19:02.270 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:19:02.270 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1345675716<open>)] for JPA transaction
2025-07-16 00:19:02.270 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:19:02.271 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@497522140 wrapping com.mysql.cj.jdbc.ConnectionImpl@63525b31] read-only
2025-07-16 00:19:02.273 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:19:02.273 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:19:02.275 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@470f95b0]
2025-07-16 00:19:02.276 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:19:02.277 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:19:02.280 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:19:02.281 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1345675716<open>)]
2025-07-16 00:19:02.281 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:19:02.284 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@497522140 wrapping com.mysql.cj.jdbc.ConnectionImpl@63525b31]
2025-07-16 00:19:02.286 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:19:02.287 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:19:02.287 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1345675716<open>)] for JPA transaction
2025-07-16 00:19:02.288 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:19:02.289 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:19:02.291 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@545ad193]
2025-07-16 00:19:02.292 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:19:02.788 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:19:02.789 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1345675716<open>)]
2025-07-16 00:19:02.789 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:19:02.789 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:19:02.790 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:19:02.790 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:19:02.790 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:19:02.791 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:19:02.791 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:19:02.792 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:19:02.792 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:19:02.792 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:19:02.792 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:19:02.793 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:19:02.793 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:19:02.793 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:19:02.794 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=NEUTRAL, energyLevel=25, hungerLevel=30, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:18:44.969879}
2025-07-16 00:19:02.795 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:19:02.809 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:19:02.810 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:19:02.810 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:19:03.464 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:19:03.466 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=NEUTRAL, energyLevel=25, hungerLevel=30, userId=1, u (truncated)...]
2025-07-16 00:19:03.468 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:19:03.468 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:19:11.331 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:19:11.332 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:19:18.552 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@98e358a is alive
2025-07-16 00:19:41.347 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:19:41.357 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:19:45.813 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@7b2c99ca is alive
2025-07-16 00:19:50.017 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@4c76b4fa is alive
2025-07-16 00:19:52.426 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@63525b31 is alive
2025-07-16 00:19:55.718 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@48b33fb1 is alive
2025-07-16 00:20:11.375 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:20:11.375 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:20:17.297 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1eebc3dc is alive
2025-07-16 00:20:30.675 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@80f4492 is alive
2025-07-16 00:20:31.498 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1e943acb is alive
2025-07-16 00:20:33.866 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@48cdd8da is alive
2025-07-16 00:20:36.592 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@22063a0c is alive
2025-07-16 00:20:41.387 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:20:41.388 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:21:00.609 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@98e358a is alive
2025-07-16 00:21:11.398 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:21:11.399 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:21:25.894 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@63525b31: (connection has passed maxLifetime)
2025-07-16 00:21:25.899 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Attempting to create/setup new connection (14108651-9ea0-42e5-b956-d6be88a93973)
2025-07-16 00:21:25.937 DEBUG jdk.event.security : X509Certificate: Alg:SHA256withRSA, Serial:02, Subject:CN=MySQL_Server_9.2.0_Auto_Generated_Server_Certificate, Issuer:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Key type:RSA, Length:2048, Cert Id:3807498037, Valid from:20/2/25, 10:36, Valid until:18/2/35, 10:36
2025-07-16 00:21:25.939 DEBUG jdk.event.security : X509Certificate: Alg:SHA256withRSA, Serial:01, Subject:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Issuer:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Key type:RSA, Length:2048, Cert Id:3139117285, Valid from:20/2/25, 10:36, Valid until:18/2/35, 10:36
2025-07-16 00:21:25.944 DEBUG jdk.event.security :  TLSHandshake: localhost:3306, TLSv1.3, TLS_AES_128_GCM_SHA256, 3807498037
2025-07-16 00:21:25.952 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Established new connection (14108651-9ea0-42e5-b956-d6be88a93973)
2025-07-16 00:21:25.953 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@68d4f6c4
2025-07-16 00:21:27.153 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@4c76b4fa is alive
2025-07-16 00:21:33.214 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@7b2c99ca is alive
2025-07-16 00:21:41.407 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:21:41.409 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:21:53.793 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1eebc3dc is alive
2025-07-16 00:21:55.121 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@48b33fb1 is alive
2025-07-16 00:22:05.485 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/my-pets
2025-07-16 00:22:05.485 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/my-pets
2025-07-16 00:22:05.491 DEBUG o.s.security.web.FilterChainProxy : Securing GET /api/pets/my-pets
2025-07-16 00:22:05.493 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:22:05.497 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:05.498 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:05.499 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@3f10f878
2025-07-16 00:22:05.500 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:05.501 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:05.502 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:05.503 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:05.504 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:05.508 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1346220668 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@930667930 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:05.510 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:05.511 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:05.516 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:05.516 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:05.517 DEBUG o.s.security.web.FilterChainProxy : Secured GET /api/pets/my-pets
2025-07-16 00:22:05.518 DEBUG o.s.web.servlet.DispatcherServlet : GET "/api/pets/my-pets", parameters={}
2025-07-16 00:22:05.518 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#getMyPets()
2025-07-16 00:22:05.519 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:05.521 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.getMyPets(); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:05.522 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.getMyPets(); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:05.523 INFO  S.virtualPets.controller.PetController : GET petition received to obtain the authenticated user pets
2025-07-16 00:22:05.523 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:22:05.524 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:22:05.526 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:05.527 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:05.529 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@70a69fe4
2025-07-16 00:22:05.529 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:05.530 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:05.530 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:05.531 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:05.531 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:05.580 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1010432582 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1028148661 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:05.582 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:05.582 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:05.587 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:05.587 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:05.588 INFO  S502.virtualPets.service.PetService : Request to obtain user pets 'Sergio'.
2025-07-16 00:22:05.589 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : pe1_0
2025-07-16 00:22:05.590 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.PetEntity(11))] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity] 
2025-07-16 00:22:05.591 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [org.hibernate.sql.ast.tree.from.LazyTableGroup@68a20275] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity(11).user] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity(11).user] 
2025-07-16 00:22:05.593 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : u1_0
2025-07-16 00:22:05.593 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@2e91a62a
2025-07-16 00:22:05.594 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(11).user(12).id) 
2025-07-16 00:22:05.595 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.PetEntity(11)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).createdAt]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).energyLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).hungerLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).mood]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).name]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).petType]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).updatedAt]
 |  \-EntityDelayedFetchImpl [S502.virtualPets.persistence.entity.PetEntity(11).user]

2025-07-16 00:22:05.964 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (pe1 : S502.virtualPets.persistence.entity.PetEntity(11)) {
          primaryTableReference : pets as pe1_0
          TableGroupJoins {
            left  join LazyTableGroup (u1 : S502.virtualPets.persistence.entity.PetEntity(11).user(12)) {
              primaryTableReference : users as u1_0
            }
          }
        }
      }
    }

2025-07-16 00:22:05.965 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:05.965 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 left join users u1_0 on u1_0.id=pe1_0.user_id where u1_0.id=?
2025-07-16 00:22:05.968 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.PetEntity(11).user -> EntityDelayedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(11).user)@1273451789 (ToOneAttributeMapping(NavigableRole[S502.virtualPets.persistence.entity.PetEntity.user])@845135647)
	  S502.virtualPets.persistence.entity.PetEntity(11) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(11))@2061958890 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.PetEntity))

2025-07-16 00:22:05.970 INFO  S502.virtualPets.service.PetService : They recovered 4 User pets 'Sergio'.
2025-07-16 00:22:05.970 INFO  S.virtualPets.controller.PetController : Returned 4 Pets for the current user.
2025-07-16 00:22:05.971 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:22:05.972 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [[PetResponseDTO[id=6, name=petx, type=GOKU, mood=NEUTRAL, energyLevel=75, hungerLevel=0, userId=1, u (truncated)...]
2025-07-16 00:22:05.974 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:05.975 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:22:05.979 DEBUG o.s.security.web.FilterChainProxy : Securing GET /api/pets/my-pets
2025-07-16 00:22:05.980 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:22:05.982 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:05.983 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:05.983 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@689cbb0c
2025-07-16 00:22:05.984 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:06.742 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:06.743 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:06.744 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:06.745 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:06.749 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@507101739 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@2029728004 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:06.751 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:06.752 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:06.758 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:06.760 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:06.762 DEBUG o.s.security.web.FilterChainProxy : Secured GET /api/pets/my-pets
2025-07-16 00:22:06.763 DEBUG o.s.web.servlet.DispatcherServlet : GET "/api/pets/my-pets", parameters={}
2025-07-16 00:22:06.763 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#getMyPets()
2025-07-16 00:22:06.764 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:07.088 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.getMyPets(); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:07.091 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.getMyPets(); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:07.092 INFO  S.virtualPets.controller.PetController : GET petition received to obtain the authenticated user pets
2025-07-16 00:22:07.093 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:22:07.094 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:22:07.096 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:07.097 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:07.098 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@60549d39
2025-07-16 00:22:07.099 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:07.100 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:07.101 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:07.102 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:07.102 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:07.105 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1474471570 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1366365155 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:07.926 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:07.926 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:07.931 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:07.932 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:07.933 INFO  S502.virtualPets.service.PetService : Request to obtain user pets 'Sergio'.
2025-07-16 00:22:07.934 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : pe1_0
2025-07-16 00:22:07.935 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.PetEntity(11))] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity] 
2025-07-16 00:22:07.936 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [org.hibernate.sql.ast.tree.from.LazyTableGroup@31290d03] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity(11).user] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity(11).user] 
2025-07-16 00:22:07.937 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : u1_0
2025-07-16 00:22:07.937 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@373e49a1
2025-07-16 00:22:07.938 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(11).user(12).id) 
2025-07-16 00:22:07.939 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.PetEntity(11)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).createdAt]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).energyLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).hungerLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).mood]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).name]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).petType]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).updatedAt]
 |  \-EntityDelayedFetchImpl [S502.virtualPets.persistence.entity.PetEntity(11).user]

2025-07-16 00:22:07.940 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (pe1 : S502.virtualPets.persistence.entity.PetEntity(11)) {
          primaryTableReference : pets as pe1_0
          TableGroupJoins {
            left  join LazyTableGroup (u1 : S502.virtualPets.persistence.entity.PetEntity(11).user(12)) {
              primaryTableReference : users as u1_0
            }
          }
        }
      }
    }

2025-07-16 00:22:08.142 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/15
2025-07-16 00:22:08.382 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:08.383 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 left join users u1_0 on u1_0.id=pe1_0.user_id where u1_0.id=?
2025-07-16 00:22:08.387 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.PetEntity(11).user -> EntityDelayedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(11).user)@616934958 (ToOneAttributeMapping(NavigableRole[S502.virtualPets.persistence.entity.PetEntity.user])@845135647)
	  S502.virtualPets.persistence.entity.PetEntity(11) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(11))@1011408150 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.PetEntity))

2025-07-16 00:22:08.387 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/15
2025-07-16 00:22:08.388 INFO  S502.virtualPets.service.PetService : They recovered 4 User pets 'Sergio'.
2025-07-16 00:22:08.389 INFO  S.virtualPets.controller.PetController : Returned 4 Pets for the current user.
2025-07-16 00:22:08.390 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:22:08.390 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:22:08.391 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [[PetResponseDTO[id=6, name=petx, type=GOKU, mood=NEUTRAL, energyLevel=75, hungerLevel=0, userId=1, u (truncated)...]
2025-07-16 00:22:08.391 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:08.392 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:08.393 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@12fa8af3
2025-07-16 00:22:08.393 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:08.394 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:08.394 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:22:08.395 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:09.001 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:09.003 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:09.003 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:09.010 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@941810874 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@931852692 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:09.011 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:09.012 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:09.015 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:09.016 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:09.017 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/15
2025-07-16 00:22:09.018 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/15", parameters={}
2025-07-16 00:22:09.019 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:22:09.019 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:09.022 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=55, hungerLevel=30]]
2025-07-16 00:22:09.023 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:09.343 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@80f4492 is alive
2025-07-16 00:22:09.549 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:09.550 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 15. Info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=55, hungerLevel=30]
2025-07-16 00:22:09.550 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:22:09.550 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:22:09.551 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:09.552 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:09.553 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@2a4def64
2025-07-16 00:22:09.553 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:09.554 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:09.555 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:09.556 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:09.557 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:09.562 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1712560206 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1390832782 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:09.815 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:09.816 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:09.820 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:09.822 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:09.823 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 15 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=55, hungerLevel=30]
2025-07-16 00:22:09.824 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:22:09.824 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(2117928551<open>)] for JPA transaction
2025-07-16 00:22:09.825 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:22:09.825 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1327082557 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb] read-only
2025-07-16 00:22:09.826 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:22:09.827 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:22:09.828 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@2f6511b4]
2025-07-16 00:22:09.830 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:09.830 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:22:09.833 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:22:09.834 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(2117928551<open>)]
2025-07-16 00:22:09.834 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:22:09.837 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1327082557 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb]
2025-07-16 00:22:09.839 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:22:10.149 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 15.
2025-07-16 00:22:10.150 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(2117928551<open>)] for JPA transaction
2025-07-16 00:22:10.151 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:22:10.152 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:22:10.154 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@7cd71cc8]
2025-07-16 00:22:10.155 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:22:10.156 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:22:10.156 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(2117928551<open>)]
2025-07-16 00:22:10.157 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:22:10.157 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:22:10.158 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:22:10.159 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:22:10.160 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:22:10.160 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:22:10.161 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:22:10.161 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:22:10.161 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:22:10.162 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:22:10.162 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:22:10.163 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:22:10.163 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T19:15:12.829268, mood=EXCITED, energyLevel=55, hungerLevel=30, petType=VEGETA, name=PEPE, id=15, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:16:06.839916}
2025-07-16 00:22:10.950 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:22:10.951 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:22:10.953 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:22:10.968 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:22:10.969 INFO  S502.virtualPets.service.PetService : Pet 'PEPE' (ID: 15) Updated successfully by the user 'Sergio'.
2025-07-16 00:22:10.970 INFO  S.virtualPets.controller.PetController : Pet with ID 15 updated successfully.
2025-07-16 00:22:10.970 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:22:10.972 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=15, name=PEPE, type=VEGETA, mood=EXCITED, energyLevel=55, hungerLevel=30, userId=1 (truncated)...]
2025-07-16 00:22:10.974 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:10.975 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:22:11.420 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:22:11.421 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:22:13.572 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/15
2025-07-16 00:22:13.580 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/15
2025-07-16 00:22:13.582 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:22:13.584 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:13.585 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:13.586 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@70a8d31
2025-07-16 00:22:13.587 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:13.589 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:13.591 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:13.592 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:13.593 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:13.596 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@74691638 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1053056625 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:13.597 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:13.598 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:13.604 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:13.605 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:13.605 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/15
2025-07-16 00:22:13.606 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/15", parameters={}
2025-07-16 00:22:13.607 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:22:13.607 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:13.609 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=40, hungerLevel=45]]
2025-07-16 00:22:13.610 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:13.611 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:13.638 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 15. Info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=40, hungerLevel=45]
2025-07-16 00:22:13.639 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:22:13.639 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:22:13.641 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:13.642 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:13.642 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@3a165a0e
2025-07-16 00:22:13.643 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:13.644 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:13.645 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:13.646 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:13.647 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:13.650 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1733183264 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1807778061 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:13.652 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:13.653 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:14.078 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:14.078 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:14.079 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 15 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=40, hungerLevel=45]
2025-07-16 00:22:14.079 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:22:14.080 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1396915377<open>)] for JPA transaction
2025-07-16 00:22:14.080 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:22:14.080 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1394680764 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb] read-only
2025-07-16 00:22:14.081 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:22:14.082 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:22:14.084 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@77b582ad]
2025-07-16 00:22:14.085 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:14.086 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:22:14.090 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:22:14.091 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1396915377<open>)]
2025-07-16 00:22:14.092 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:22:14.094 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1394680764 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb]
2025-07-16 00:22:14.095 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:22:14.096 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 15.
2025-07-16 00:22:14.096 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1396915377<open>)] for JPA transaction
2025-07-16 00:22:14.097 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:22:14.390 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:22:14.392 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@1abc5862]
2025-07-16 00:22:14.393 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:22:14.394 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:22:14.395 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1396915377<open>)]
2025-07-16 00:22:14.395 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:22:14.396 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:22:14.396 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:22:14.397 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:22:14.397 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:22:14.398 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:22:14.398 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:22:14.399 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:22:14.399 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:22:14.399 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:22:14.400 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:22:14.400 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:22:14.401 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T19:15:12.829268, mood=EXCITED, energyLevel=40, hungerLevel=45, petType=VEGETA, name=PEPE, id=15, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:22:10.952622}
2025-07-16 00:22:14.402 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:22:14.402 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:22:14.404 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:22:14.903 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:22:14.904 INFO  S502.virtualPets.service.PetService : Pet 'PEPE' (ID: 15) Updated successfully by the user 'Sergio'.
2025-07-16 00:22:14.904 INFO  S.virtualPets.controller.PetController : Pet with ID 15 updated successfully.
2025-07-16 00:22:14.905 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:22:14.906 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=15, name=PEPE, type=VEGETA, mood=EXCITED, energyLevel=40, hungerLevel=45, userId=1 (truncated)...]
2025-07-16 00:22:14.907 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:14.908 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:22:17.120 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/15
2025-07-16 00:22:17.123 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:22:17.125 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:17.126 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:17.127 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@4a2c802c
2025-07-16 00:22:17.127 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:17.128 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:17.129 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:17.130 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:17.131 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:17.136 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@2064109388 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@727563361 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:17.137 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:17.139 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:17.145 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:17.145 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:17.146 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/15
2025-07-16 00:22:17.147 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/15", parameters={}
2025-07-16 00:22:17.147 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:22:17.148 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:17.150 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=50, hungerLevel=30]]
2025-07-16 00:22:17.151 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:17.152 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:17.153 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 15. Info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=50, hungerLevel=30]
2025-07-16 00:22:17.153 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:22:17.153 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:22:17.154 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:17.155 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:17.156 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@15823ef1
2025-07-16 00:22:17.156 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:17.157 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:17.188 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:17.189 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:17.190 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:17.193 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@2117709731 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1379531899 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:17.194 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:17.195 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:17.199 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:17.199 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:17.200 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 15 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=50, hungerLevel=30]
2025-07-16 00:22:17.201 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:22:17.201 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(958062892<open>)] for JPA transaction
2025-07-16 00:22:17.202 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:22:17.202 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@964260497 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb] read-only
2025-07-16 00:22:17.204 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:22:18.051 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:22:18.053 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@5a86d427]
2025-07-16 00:22:18.054 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:18.055 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:22:18.058 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:22:18.059 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(958062892<open>)]
2025-07-16 00:22:18.059 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:22:18.062 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@964260497 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb]
2025-07-16 00:22:18.063 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:22:18.064 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 15.
2025-07-16 00:22:18.065 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(958062892<open>)] for JPA transaction
2025-07-16 00:22:18.065 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:22:18.065 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:22:18.070 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@6734e98c]
2025-07-16 00:22:18.070 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:22:18.072 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:22:18.073 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(958062892<open>)]
2025-07-16 00:22:18.073 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:22:18.074 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:22:18.075 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:22:18.075 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:22:18.075 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:22:18.645 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@48cdd8da is alive
2025-07-16 00:22:18.077 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:22:18.848 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:22:18.848 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:22:18.849 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:22:18.849 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:22:18.850 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:22:18.850 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:22:18.850 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T19:15:12.829268, mood=EXCITED, energyLevel=50, hungerLevel=30, petType=VEGETA, name=PEPE, id=15, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:22:14.403062}
2025-07-16 00:22:18.850 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:22:18.851 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:22:18.852 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:22:18.866 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:22:18.866 INFO  S502.virtualPets.service.PetService : Pet 'PEPE' (ID: 15) Updated successfully by the user 'Sergio'.
2025-07-16 00:22:18.867 INFO  S.virtualPets.controller.PetController : Pet with ID 15 updated successfully.
2025-07-16 00:22:18.868 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:22:18.868 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=15, name=PEPE, type=VEGETA, mood=EXCITED, energyLevel=50, hungerLevel=30, userId=1 (truncated)...]
2025-07-16 00:22:18.870 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:18.871 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:22:19.049 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@22063a0c is alive
2025-07-16 00:22:21.307 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/15
2025-07-16 00:22:21.313 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/15
2025-07-16 00:22:21.316 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:22:21.321 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:21.321 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:21.322 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@1346bf13
2025-07-16 00:22:21.323 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:21.324 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:21.325 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:21.325 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:21.326 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:21.330 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@728940377 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@148441983 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:21.332 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:21.333 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:21.337 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:21.474 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:21.475 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/15
2025-07-16 00:22:21.476 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/15", parameters={}
2025-07-16 00:22:21.477 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:22:21.478 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:21.481 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=35, hungerLevel=45]]
2025-07-16 00:22:21.482 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:21.485 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:21.485 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 15. Info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=35, hungerLevel=45]
2025-07-16 00:22:21.486 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:22:21.486 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:22:21.487 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:21.488 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:21.489 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@dbec27e
2025-07-16 00:22:21.490 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:21.491 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:21.493 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:22.168 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:22.168 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:22.172 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1516387754 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1636643273 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:22.174 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:22.175 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:22.179 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:22.179 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:22.180 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 15 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=35, hungerLevel=45]
2025-07-16 00:22:22.181 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:22:22.181 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(2124298134<open>)] for JPA transaction
2025-07-16 00:22:22.182 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:22:22.182 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1088945782 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb] read-only
2025-07-16 00:22:22.184 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:22:22.185 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:22:22.187 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@7e88b328]
2025-07-16 00:22:22.188 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:22.901 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:22:22.905 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:22:22.906 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(2124298134<open>)]
2025-07-16 00:22:22.906 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:22:22.909 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1088945782 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb]
2025-07-16 00:22:22.912 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:22:22.912 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 15.
2025-07-16 00:22:22.913 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(2124298134<open>)] for JPA transaction
2025-07-16 00:22:22.914 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:22:22.914 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:22:22.917 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@222bdbc6]
2025-07-16 00:22:22.918 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:22:22.919 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:22:22.920 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(2124298134<open>)]
2025-07-16 00:22:22.920 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:22:22.920 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:22:22.921 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:22:22.921 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:22:22.921 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:22:22.922 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:22:22.923 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:22:22.923 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:22:22.923 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:22:23.383 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:22:23.384 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:22:23.384 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:22:23.386 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T19:15:12.829268, mood=EXCITED, energyLevel=35, hungerLevel=45, petType=VEGETA, name=PEPE, id=15, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:22:18.851523}
2025-07-16 00:22:23.387 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:22:23.387 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:22:23.388 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:22:23.402 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:22:23.402 INFO  S502.virtualPets.service.PetService : Pet 'PEPE' (ID: 15) Updated successfully by the user 'Sergio'.
2025-07-16 00:22:23.403 INFO  S.virtualPets.controller.PetController : Pet with ID 15 updated successfully.
2025-07-16 00:22:23.404 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:22:23.405 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=15, name=PEPE, type=VEGETA, mood=EXCITED, energyLevel=35, hungerLevel=45, userId=1 (truncated)...]
2025-07-16 00:22:23.406 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:23.408 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:22:24.886 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/15
2025-07-16 00:22:24.889 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:22:24.892 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:24.893 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:24.894 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@7b632554
2025-07-16 00:22:24.895 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:24.896 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:24.898 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:24.899 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:24.900 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:24.903 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1022632958 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@948853608 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:24.905 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:24.905 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:24.909 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:24.910 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:24.911 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/15
2025-07-16 00:22:24.912 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/15", parameters={}
2025-07-16 00:22:24.913 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:22:24.915 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:24.918 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=20, hungerLevel=60]]
2025-07-16 00:22:24.919 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:24.920 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:24.921 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 15. Info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=20, hungerLevel=60]
2025-07-16 00:22:25.086 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:22:25.088 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:22:25.089 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:25.090 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:25.091 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@4cffb7ea
2025-07-16 00:22:25.092 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:25.092 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:25.093 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:25.094 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:25.094 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:25.097 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@512799024 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@51251872 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:25.098 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:25.099 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:25.610 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:25.611 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:25.611 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 15 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=20, hungerLevel=60]
2025-07-16 00:22:25.611 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:22:25.612 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1196284516<open>)] for JPA transaction
2025-07-16 00:22:25.612 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:22:25.612 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@121550708 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb] read-only
2025-07-16 00:22:25.614 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:22:25.615 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:22:25.616 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@1b418bb6]
2025-07-16 00:22:25.618 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:25.619 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:22:25.622 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:22:25.623 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1196284516<open>)]
2025-07-16 00:22:25.624 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:22:25.627 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@121550708 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb]
2025-07-16 00:22:25.628 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:22:25.628 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 15.
2025-07-16 00:22:25.630 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1196284516<open>)] for JPA transaction
2025-07-16 00:22:25.630 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:22:25.630 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:22:25.632 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@771ceece]
2025-07-16 00:22:25.937 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:22:25.938 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:22:25.938 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1196284516<open>)]
2025-07-16 00:22:25.939 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:22:25.939 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:22:25.939 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:22:25.939 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:22:25.940 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:22:25.940 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:22:25.941 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:22:25.941 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:22:25.941 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:22:25.941 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:22:25.941 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:22:25.942 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:22:25.942 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T19:15:12.829268, mood=EXCITED, energyLevel=20, hungerLevel=60, petType=VEGETA, name=PEPE, id=15, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:22:23.388354}
2025-07-16 00:22:25.943 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:22:25.943 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:22:25.944 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:22:25.958 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:22:26.376 INFO  S502.virtualPets.service.PetService : Pet 'PEPE' (ID: 15) Updated successfully by the user 'Sergio'.
2025-07-16 00:22:26.376 INFO  S.virtualPets.controller.PetController : Pet with ID 15 updated successfully.
2025-07-16 00:22:26.378 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:22:26.379 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=15, name=PEPE, type=VEGETA, mood=EXCITED, energyLevel=20, hungerLevel=60, userId=1 (truncated)...]
2025-07-16 00:22:26.383 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:26.384 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:22:28.567 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/15
2025-07-16 00:22:28.580 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/15
2025-07-16 00:22:28.583 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:22:28.585 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:28.586 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:28.588 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@4e276608
2025-07-16 00:22:28.589 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:28.590 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:28.591 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:28.592 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:28.593 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:28.597 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1071200065 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@890007607 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:28.598 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:28.599 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:28.653 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:28.654 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:28.656 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/15
2025-07-16 00:22:28.657 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/15", parameters={}
2025-07-16 00:22:28.659 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:22:28.660 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:28.661 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=5, hungerLevel=75]]
2025-07-16 00:22:28.663 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:28.664 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:28.665 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 15. Info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=5, hungerLevel=75]
2025-07-16 00:22:28.665 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:22:28.666 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:22:28.667 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:28.668 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:28.668 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@30404aa0
2025-07-16 00:22:28.669 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:28.669 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:29.467 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:29.468 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:29.469 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:29.473 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1631690601 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@460507863 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:29.475 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:29.476 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:29.480 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:29.481 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:29.481 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 15 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=5, hungerLevel=75]
2025-07-16 00:22:29.483 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:22:29.484 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(915408336<open>)] for JPA transaction
2025-07-16 00:22:29.484 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:22:29.485 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1064498715 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb] read-only
2025-07-16 00:22:29.485 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:22:29.486 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:22:29.489 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@722121a7]
2025-07-16 00:22:29.991 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:29.991 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:22:29.995 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:22:29.996 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(915408336<open>)]
2025-07-16 00:22:29.997 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:22:29.999 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1064498715 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb]
2025-07-16 00:22:30.001 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:22:30.002 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 15.
2025-07-16 00:22:30.004 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(915408336<open>)] for JPA transaction
2025-07-16 00:22:30.004 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:22:30.006 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:22:30.009 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@533c0052]
2025-07-16 00:22:30.010 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:22:30.011 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:22:30.011 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(915408336<open>)]
2025-07-16 00:22:30.011 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:22:30.012 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:22:30.012 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:22:30.013 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:22:30.013 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:22:30.014 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:22:30.015 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:22:30.015 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:22:30.553 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:22:30.553 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:22:30.554 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:22:30.554 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:22:30.555 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T19:15:12.829268, mood=SAD, energyLevel=5, hungerLevel=75, petType=VEGETA, name=PEPE, id=15, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:22:25.944618}
2025-07-16 00:22:30.556 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:22:30.556 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:22:30.558 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:22:30.571 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:22:30.572 INFO  S502.virtualPets.service.PetService : Pet 'PEPE' (ID: 15) Updated successfully by the user 'Sergio'.
2025-07-16 00:22:30.573 INFO  S.virtualPets.controller.PetController : Pet with ID 15 updated successfully.
2025-07-16 00:22:30.574 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:22:30.576 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=15, name=PEPE, type=VEGETA, mood=SAD, energyLevel=5, hungerLevel=75, userId=1, use (truncated)...]
2025-07-16 00:22:30.578 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:30.580 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:22:31.648 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/15
2025-07-16 00:22:31.651 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:22:31.654 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:31.655 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:31.656 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@3a6da341
2025-07-16 00:22:31.658 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:31.659 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:31.660 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:31.661 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:31.662 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:31.666 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1934965669 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@946655981 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:31.668 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:31.668 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:31.856 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:31.857 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:31.859 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/15
2025-07-16 00:22:31.860 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/15", parameters={}
2025-07-16 00:22:31.860 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:22:31.861 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:31.863 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=15, hungerLevel=60]]
2025-07-16 00:22:31.864 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:31.871 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:31.872 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 15. Info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=15, hungerLevel=60]
2025-07-16 00:22:31.873 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:22:31.873 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:22:31.876 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:31.876 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:31.878 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@1b4c0542
2025-07-16 00:22:31.879 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:31.880 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:33.165 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:33.167 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:33.167 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:33.176 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1983253414 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1926325114 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:33.178 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:33.179 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:33.183 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:33.184 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:33.184 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 15 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=15, hungerLevel=60]
2025-07-16 00:22:33.185 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:22:33.186 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1065647621<open>)] for JPA transaction
2025-07-16 00:22:33.186 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:22:33.187 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1255713337 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb] read-only
2025-07-16 00:22:33.189 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:22:33.190 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:22:33.192 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@15a74f71]
2025-07-16 00:22:34.008 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:34.009 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:22:34.013 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:22:34.014 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1065647621<open>)]
2025-07-16 00:22:34.014 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:22:34.018 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1255713337 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb]
2025-07-16 00:22:34.021 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:22:34.023 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 15.
2025-07-16 00:22:34.024 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1065647621<open>)] for JPA transaction
2025-07-16 00:22:34.025 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:22:34.026 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:22:34.029 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@354b8993]
2025-07-16 00:22:34.030 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:22:34.031 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:22:34.032 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1065647621<open>)]
2025-07-16 00:22:34.033 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:22:34.033 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:22:34.034 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:22:34.035 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:22:34.036 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:22:34.038 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:22:34.038 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:22:34.038 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:22:34.632 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:22:34.632 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:22:34.633 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:22:34.633 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:22:34.634 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T19:15:12.829268, mood=SAD, energyLevel=15, hungerLevel=60, petType=VEGETA, name=PEPE, id=15, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:22:30.557643}
2025-07-16 00:22:34.634 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:22:34.635 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:22:34.637 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:22:34.651 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:22:34.652 INFO  S502.virtualPets.service.PetService : Pet 'PEPE' (ID: 15) Updated successfully by the user 'Sergio'.
2025-07-16 00:22:34.652 INFO  S.virtualPets.controller.PetController : Pet with ID 15 updated successfully.
2025-07-16 00:22:34.655 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:22:34.656 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=15, name=PEPE, type=VEGETA, mood=SAD, energyLevel=15, hungerLevel=60, userId=1, us (truncated)...]
2025-07-16 00:22:34.659 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:34.660 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:22:35.517 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/15
2025-07-16 00:22:35.525 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/15
2025-07-16 00:22:35.528 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:22:35.530 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:35.531 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:35.532 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@3c1b6f3c
2025-07-16 00:22:35.533 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:35.534 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:35.535 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:35.536 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:35.537 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:35.542 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@710979366 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@122008665 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:35.543 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:35.543 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:35.624 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:35.625 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:35.626 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/15
2025-07-16 00:22:35.628 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/15", parameters={}
2025-07-16 00:22:35.628 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:22:35.629 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:35.633 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=25, hungerLevel=45]]
2025-07-16 00:22:35.636 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:35.638 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:35.639 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 15. Info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=25, hungerLevel=45]
2025-07-16 00:22:35.639 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:22:35.640 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:22:35.641 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:35.641 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:35.642 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@64423fd1
2025-07-16 00:22:35.643 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:35.643 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:36.219 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:36.220 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:36.221 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:36.225 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@101513485 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@2092363041 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:36.227 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:36.228 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:36.232 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:36.233 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:36.233 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 15 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=25, hungerLevel=45]
2025-07-16 00:22:36.234 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:22:36.234 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(2000127717<open>)] for JPA transaction
2025-07-16 00:22:36.235 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:22:36.235 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@935652710 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb] read-only
2025-07-16 00:22:36.236 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:22:37.065 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:22:37.067 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@139b12e7]
2025-07-16 00:22:37.068 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:37.069 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:22:37.073 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:22:37.073 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(2000127717<open>)]
2025-07-16 00:22:37.074 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:22:37.076 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@935652710 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb]
2025-07-16 00:22:37.080 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:22:37.082 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 15.
2025-07-16 00:22:37.088 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(2000127717<open>)] for JPA transaction
2025-07-16 00:22:37.095 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:22:37.095 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:22:37.102 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@7c62245f]
2025-07-16 00:22:37.107 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:22:37.108 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:22:37.108 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(2000127717<open>)]
2025-07-16 00:22:37.109 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:22:37.109 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:22:37.110 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:22:37.112 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:22:37.113 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:22:37.114 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:22:37.614 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:22:37.615 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:22:37.616 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:22:37.617 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:22:37.618 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:22:37.619 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:22:37.619 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T19:15:12.829268, mood=SAD, energyLevel=25, hungerLevel=45, petType=VEGETA, name=PEPE, id=15, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:22:34.636794}
2025-07-16 00:22:37.620 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:22:37.620 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:22:37.621 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:22:37.634 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:22:37.635 INFO  S502.virtualPets.service.PetService : Pet 'PEPE' (ID: 15) Updated successfully by the user 'Sergio'.
2025-07-16 00:22:37.635 INFO  S.virtualPets.controller.PetController : Pet with ID 15 updated successfully.
2025-07-16 00:22:37.636 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:22:37.637 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=15, name=PEPE, type=VEGETA, mood=SAD, energyLevel=25, hungerLevel=45, userId=1, us (truncated)...]
2025-07-16 00:22:37.640 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:37.641 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:22:38.654 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/15
2025-07-16 00:22:38.656 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:22:38.659 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:38.660 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:38.661 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@12c075c3
2025-07-16 00:22:38.661 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:38.663 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:38.664 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:38.665 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:38.666 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:38.671 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1370076066 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@60406019 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:38.672 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:38.673 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:38.979 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:38.979 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:38.980 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/15
2025-07-16 00:22:38.981 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/15", parameters={}
2025-07-16 00:22:38.982 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:22:38.983 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:38.986 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=35, hungerLevel=30]]
2025-07-16 00:22:38.990 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:38.990 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:38.990 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 15. Info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=35, hungerLevel=30]
2025-07-16 00:22:38.992 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:22:38.992 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:22:38.994 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:38.994 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:38.994 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@772ebd45
2025-07-16 00:22:38.996 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:38.996 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:39.286 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:39.287 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:39.288 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:39.291 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@22847433 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@2132495153 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:39.292 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:39.293 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:39.297 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:39.298 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:39.299 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 15 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=SAD, energyLevel=35, hungerLevel=30]
2025-07-16 00:22:39.300 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:22:39.301 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(2088201827<open>)] for JPA transaction
2025-07-16 00:22:39.301 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:22:39.302 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1870006675 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb] read-only
2025-07-16 00:22:39.304 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:22:39.304 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:22:39.306 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@7a44dbc8]
2025-07-16 00:22:39.960 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:39.960 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:22:39.964 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:22:39.966 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(2088201827<open>)]
2025-07-16 00:22:39.966 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:22:39.969 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1870006675 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb]
2025-07-16 00:22:39.971 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:22:39.972 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 15.
2025-07-16 00:22:39.972 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(2088201827<open>)] for JPA transaction
2025-07-16 00:22:39.972 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:22:39.973 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:22:39.974 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@5b20f188]
2025-07-16 00:22:39.975 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:22:39.975 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:22:39.976 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(2088201827<open>)]
2025-07-16 00:22:39.976 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:22:39.976 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:22:39.977 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:22:39.978 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:22:39.978 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:22:39.979 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:22:39.979 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:22:39.979 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:22:40.573 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:22:40.575 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:22:40.576 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:22:40.576 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:22:40.577 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T19:15:12.829268, mood=SAD, energyLevel=35, hungerLevel=30, petType=VEGETA, name=PEPE, id=15, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:22:37.621267}
2025-07-16 00:22:40.578 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:22:40.578 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:22:40.582 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:22:40.596 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:22:40.596 INFO  S502.virtualPets.service.PetService : Pet 'PEPE' (ID: 15) Updated successfully by the user 'Sergio'.
2025-07-16 00:22:40.597 INFO  S.virtualPets.controller.PetController : Pet with ID 15 updated successfully.
2025-07-16 00:22:40.599 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:22:40.599 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=15, name=PEPE, type=VEGETA, mood=SAD, energyLevel=35, hungerLevel=30, userId=1, us (truncated)...]
2025-07-16 00:22:40.601 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:40.603 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:22:41.325 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/15
2025-07-16 00:22:41.331 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/15
2025-07-16 00:22:41.333 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:22:41.336 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:41.336 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:41.337 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@474cab71
2025-07-16 00:22:41.338 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:41.339 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:41.341 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:41.342 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:41.343 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:41.346 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1622480353 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@48045967 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:41.348 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:41.349 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:41.359 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:41.360 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:41.361 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/15
2025-07-16 00:22:41.362 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/15", parameters={}
2025-07-16 00:22:41.363 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:22:41.363 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:41.367 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=45, hungerLevel=15]]
2025-07-16 00:22:41.369 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:41.370 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:41.371 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 15. Info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=45, hungerLevel=15]
2025-07-16 00:22:41.371 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:22:41.371 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:22:41.373 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:41.373 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:41.374 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@1d037126
2025-07-16 00:22:41.375 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:41.375 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:41.426 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:22:41.902 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:41.902 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:22:41.903 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:41.904 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:41.909 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1866617517 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@592278014 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:41.911 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:41.913 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:41.917 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:41.918 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:41.919 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 15 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=45, hungerLevel=15]
2025-07-16 00:22:41.920 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:22:41.920 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1036305391<open>)] for JPA transaction
2025-07-16 00:22:41.921 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:22:41.963 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1128277075 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb] read-only
2025-07-16 00:22:41.965 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:22:41.966 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:22:41.968 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@2e0c391]
2025-07-16 00:22:41.969 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:41.970 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:22:41.973 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:22:41.974 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1036305391<open>)]
2025-07-16 00:22:41.974 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:22:41.977 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1128277075 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb]
2025-07-16 00:22:41.980 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:22:41.981 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 15.
2025-07-16 00:22:41.982 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1036305391<open>)] for JPA transaction
2025-07-16 00:22:41.983 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:22:41.984 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:22:41.986 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@18a53c88]
2025-07-16 00:22:41.987 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:22:41.987 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:22:41.988 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1036305391<open>)]
2025-07-16 00:22:41.988 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:22:41.989 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:22:41.989 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:22:41.989 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:22:42.245 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:22:42.246 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:22:42.247 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:22:42.247 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:22:42.248 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:22:42.249 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:22:42.250 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:22:42.251 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:22:42.252 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T19:15:12.829268, mood=NEUTRAL, energyLevel=45, hungerLevel=15, petType=VEGETA, name=PEPE, id=15, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:22:40.581804}
2025-07-16 00:22:42.252 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:22:42.252 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:22:42.254 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:22:42.267 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:22:42.267 INFO  S502.virtualPets.service.PetService : Pet 'PEPE' (ID: 15) Updated successfully by the user 'Sergio'.
2025-07-16 00:22:42.268 INFO  S.virtualPets.controller.PetController : Pet with ID 15 updated successfully.
2025-07-16 00:22:42.269 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:22:42.270 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=15, name=PEPE, type=VEGETA, mood=NEUTRAL, energyLevel=45, hungerLevel=15, userId=1 (truncated)...]
2025-07-16 00:22:42.272 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:42.273 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:22:42.669 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@98e358a is alive
2025-07-16 00:22:43.251 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/15
2025-07-16 00:22:44.155 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:22:44.157 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:44.158 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:44.159 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@492b5008
2025-07-16 00:22:44.159 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:44.160 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:44.160 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:44.161 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:44.161 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:44.165 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1132048472 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1678174524 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:44.167 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:44.168 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:44.521 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:44.522 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:44.524 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/15
2025-07-16 00:22:44.525 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/15", parameters={}
2025-07-16 00:22:44.526 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:22:44.527 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:44.529 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=55, hungerLevel=0]]
2025-07-16 00:22:44.531 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:44.533 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:44.533 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 15. Info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=55, hungerLevel=0]
2025-07-16 00:22:44.534 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:22:44.534 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:22:44.535 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:44.536 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:44.537 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@28db74fd
2025-07-16 00:22:44.537 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:44.538 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:45.112 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:45.114 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:45.114 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:45.118 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@45612465 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1878021107 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:45.120 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:45.120 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:45.124 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:45.124 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:45.125 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 15 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=55, hungerLevel=0]
2025-07-16 00:22:45.125 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:22:45.126 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(559465047<open>)] for JPA transaction
2025-07-16 00:22:45.126 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:22:45.129 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@2101273565 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb] read-only
2025-07-16 00:22:45.131 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:22:45.132 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:22:45.134 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@32489e42]
2025-07-16 00:22:45.857 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:45.858 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:22:45.862 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:22:45.863 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(559465047<open>)]
2025-07-16 00:22:45.863 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:22:45.867 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@2101273565 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb]
2025-07-16 00:22:45.869 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:22:45.870 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 15.
2025-07-16 00:22:45.871 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(559465047<open>)] for JPA transaction
2025-07-16 00:22:45.871 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:22:45.871 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:22:45.872 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@7e3cd0c9]
2025-07-16 00:22:45.873 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:22:45.874 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:22:45.874 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(559465047<open>)]
2025-07-16 00:22:45.874 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:22:45.874 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:22:45.875 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:22:45.876 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:22:45.877 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:22:45.879 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:22:45.880 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:22:45.880 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:22:46.636 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:22:46.636 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:22:46.637 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:22:46.637 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:22:46.637 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T19:15:12.829268, mood=NEUTRAL, energyLevel=55, hungerLevel=0, petType=VEGETA, name=PEPE, id=15, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:22:42.253430}
2025-07-16 00:22:46.638 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:22:46.638 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:22:46.639 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:22:46.652 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:22:46.653 INFO  S502.virtualPets.service.PetService : Pet 'PEPE' (ID: 15) Updated successfully by the user 'Sergio'.
2025-07-16 00:22:46.653 INFO  S.virtualPets.controller.PetController : Pet with ID 15 updated successfully.
2025-07-16 00:22:46.654 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:22:46.655 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=15, name=PEPE, type=VEGETA, mood=NEUTRAL, energyLevel=55, hungerLevel=0, userId=1, (truncated)...]
2025-07-16 00:22:46.656 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:46.657 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:22:51.594 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/15
2025-07-16 00:22:51.601 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/15
2025-07-16 00:22:51.604 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:22:51.606 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:51.607 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:51.608 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@55628d99
2025-07-16 00:22:51.609 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:51.611 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:51.612 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:51.613 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:51.613 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:51.620 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@63901603 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@392607208 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:51.621 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:51.621 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:51.667 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:51.668 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:51.669 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/15
2025-07-16 00:22:51.670 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/15", parameters={}
2025-07-16 00:22:51.670 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:22:51.671 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:51.673 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=40, hungerLevel=15]]
2025-07-16 00:22:51.674 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:51.676 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:22:51.677 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 15. Info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=40, hungerLevel=15]
2025-07-16 00:22:51.677 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:22:51.677 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:22:51.679 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:22:51.680 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:22:51.681 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@3840da70
2025-07-16 00:22:51.681 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:22:51.682 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:22:51.683 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:22:52.226 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:22:52.227 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:22:52.231 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1348430902 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@170048934 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:22:52.233 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:52.233 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:22:52.237 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:22:52.238 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:22:52.238 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 15 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=40, hungerLevel=15]
2025-07-16 00:22:52.239 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:22:52.240 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(196898983<open>)] for JPA transaction
2025-07-16 00:22:52.240 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:22:52.241 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@84529435 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb] read-only
2025-07-16 00:22:52.242 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:22:52.243 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:22:52.245 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@1bec991a]
2025-07-16 00:22:52.990 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:22:52.991 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:22:52.995 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:22:52.996 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(196898983<open>)]
2025-07-16 00:22:52.996 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:22:52.999 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@84529435 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb]
2025-07-16 00:22:53.001 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:22:53.001 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 15.
2025-07-16 00:22:53.002 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(196898983<open>)] for JPA transaction
2025-07-16 00:22:53.003 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:22:53.003 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:22:53.006 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@190f19e]
2025-07-16 00:22:53.008 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:22:53.009 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:22:53.010 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(196898983<open>)]
2025-07-16 00:22:53.011 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:22:53.011 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:22:53.011 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:22:53.012 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:22:53.012 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:22:53.013 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:22:53.013 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:22:53.014 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:22:53.851 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:22:53.852 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:22:53.852 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:22:53.853 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:22:53.853 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T19:15:12.829268, mood=NEUTRAL, energyLevel=40, hungerLevel=15, petType=VEGETA, name=PEPE, id=15, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:22:46.639813}
2025-07-16 00:22:53.853 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:22:53.854 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:22:53.855 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:22:53.869 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:22:53.870 INFO  S502.virtualPets.service.PetService : Pet 'PEPE' (ID: 15) Updated successfully by the user 'Sergio'.
2025-07-16 00:22:53.870 INFO  S.virtualPets.controller.PetController : Pet with ID 15 updated successfully.
2025-07-16 00:22:53.872 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:22:53.873 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=15, name=PEPE, type=VEGETA, mood=NEUTRAL, energyLevel=40, hungerLevel=15, userId=1 (truncated)...]
2025-07-16 00:22:53.875 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:22:53.876 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:23:01.404 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/15
2025-07-16 00:23:01.413 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/15
2025-07-16 00:23:01.414 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:23:01.416 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:23:01.417 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:23:01.419 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@70ee40ba
2025-07-16 00:23:01.420 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:23:01.421 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:23:01.422 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:23:01.423 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:23:01.424 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:23:01.427 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@2125259531 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@2128209792 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:23:01.429 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:01.429 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:23:01.433 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:23:01.436 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:23:01.438 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/15
2025-07-16 00:23:01.439 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/15", parameters={}
2025-07-16 00:23:01.440 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:23:01.441 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:23:01.442 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=50, hungerLevel=0]]
2025-07-16 00:23:01.443 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:23:01.444 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:23:01.445 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 15. Info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=50, hungerLevel=0]
2025-07-16 00:23:01.445 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:23:01.445 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:23:01.446 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:23:01.447 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:23:01.448 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@d232627
2025-07-16 00:23:01.449 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:23:01.450 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:23:01.451 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:23:01.452 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:23:01.453 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:23:01.535 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1031755502 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1705254730 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:23:01.536 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:01.537 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:23:01.541 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:23:01.542 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:23:01.543 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 15 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=50, hungerLevel=0]
2025-07-16 00:23:01.543 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:23:01.543 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1483527001<open>)] for JPA transaction
2025-07-16 00:23:01.544 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:23:01.545 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@442093858 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb] read-only
2025-07-16 00:23:01.546 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:23:01.547 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:23:01.548 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@1a112854]
2025-07-16 00:23:01.550 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:01.551 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:23:02.051 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:23:02.052 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1483527001<open>)]
2025-07-16 00:23:02.053 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:23:02.056 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@442093858 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb]
2025-07-16 00:23:02.058 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:23:02.059 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 15.
2025-07-16 00:23:02.059 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1483527001<open>)] for JPA transaction
2025-07-16 00:23:02.059 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:23:02.060 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:23:02.062 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@266c446b]
2025-07-16 00:23:02.063 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:23:02.063 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:23:02.064 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1483527001<open>)]
2025-07-16 00:23:02.064 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:23:02.064 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:23:02.065 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:23:02.066 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:23:02.067 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:23:02.068 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:23:02.069 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:23:02.070 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:23:02.070 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:23:02.071 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:23:02.072 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:23:02.598 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:23:02.599 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T19:15:12.829268, mood=NEUTRAL, energyLevel=50, hungerLevel=0, petType=VEGETA, name=PEPE, id=15, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:22:53.854290}
2025-07-16 00:23:02.600 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:23:02.600 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:23:02.601 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:23:02.614 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:23:02.614 INFO  S502.virtualPets.service.PetService : Pet 'PEPE' (ID: 15) Updated successfully by the user 'Sergio'.
2025-07-16 00:23:02.615 INFO  S.virtualPets.controller.PetController : Pet with ID 15 updated successfully.
2025-07-16 00:23:02.616 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:23:02.617 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=15, name=PEPE, type=VEGETA, mood=NEUTRAL, energyLevel=50, hungerLevel=0, userId=1, (truncated)...]
2025-07-16 00:23:02.621 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:23:02.622 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:23:04.287 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@4c76b4fa is alive
2025-07-16 00:23:05.978 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/15
2025-07-16 00:23:05.981 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:23:05.984 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:23:05.984 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:23:05.986 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@4895d879
2025-07-16 00:23:05.986 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:23:05.987 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:23:05.988 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:23:05.989 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:23:05.990 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:23:05.994 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@2016894810 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1868996389 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:23:05.996 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:05.997 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:23:06.001 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:23:06.002 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:23:06.003 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/15
2025-07-16 00:23:06.004 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/15", parameters={}
2025-07-16 00:23:06.005 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:23:06.006 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:23:06.007 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=60, hungerLevel=0]]
2025-07-16 00:23:06.009 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:23:06.014 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:23:06.015 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 15. Info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=60, hungerLevel=0]
2025-07-16 00:23:06.016 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:23:06.016 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:23:06.017 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:23:06.018 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:23:06.019 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@fa66ddf
2025-07-16 00:23:06.020 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:23:06.021 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:23:06.021 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:23:06.022 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:23:06.023 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:23:06.028 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@2018214109 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1477151051 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:23:06.030 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:06.031 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:23:06.222 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:23:06.223 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:23:06.224 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 15 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=60, hungerLevel=0]
2025-07-16 00:23:06.224 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:23:06.225 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1799477546<open>)] for JPA transaction
2025-07-16 00:23:06.226 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:23:06.226 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@633995507 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb] read-only
2025-07-16 00:23:06.228 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:23:06.228 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:23:06.230 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@292f1ae8]
2025-07-16 00:23:06.232 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:06.232 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:23:06.236 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:23:06.237 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1799477546<open>)]
2025-07-16 00:23:06.237 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:23:06.240 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@633995507 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb]
2025-07-16 00:23:06.241 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:23:06.242 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 15.
2025-07-16 00:23:06.242 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1799477546<open>)] for JPA transaction
2025-07-16 00:23:06.243 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:23:06.873 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:23:06.875 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@639ff0c4]
2025-07-16 00:23:06.876 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:23:06.877 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:23:06.877 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1799477546<open>)]
2025-07-16 00:23:06.877 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:23:06.878 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:23:06.878 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:23:06.879 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:23:06.880 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:23:06.880 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:23:06.881 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:23:06.881 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:23:06.882 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:23:06.882 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:23:06.883 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:23:06.883 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:23:06.883 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T19:15:12.829268, mood=NEUTRAL, energyLevel=60, hungerLevel=0, petType=VEGETA, name=PEPE, id=15, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:23:02.601221}
2025-07-16 00:23:06.884 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:23:06.884 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:23:06.886 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:23:07.400 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:23:07.400 INFO  S502.virtualPets.service.PetService : Pet 'PEPE' (ID: 15) Updated successfully by the user 'Sergio'.
2025-07-16 00:23:07.401 INFO  S.virtualPets.controller.PetController : Pet with ID 15 updated successfully.
2025-07-16 00:23:07.402 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:23:07.403 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=15, name=PEPE, type=VEGETA, mood=NEUTRAL, energyLevel=60, hungerLevel=0, userId=1, (truncated)...]
2025-07-16 00:23:07.405 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:23:07.406 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:23:11.915 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:23:11.916 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:23:14.546 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@68d4f6c4 is alive
2025-07-16 00:23:20.605 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@7b2c99ca is alive
2025-07-16 00:23:22.444 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/my-pets
2025-07-16 00:23:22.448 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/my-pets
2025-07-16 00:23:22.452 DEBUG o.s.security.web.FilterChainProxy : Securing GET /api/pets/my-pets
2025-07-16 00:23:22.455 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:23:22.459 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:23:22.460 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:23:22.462 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@21de8e12
2025-07-16 00:23:22.463 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:23:22.464 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:23:22.465 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:23:22.466 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:23:22.466 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:23:22.470 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1455598725 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@947454933 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:23:22.471 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:22.472 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:23:22.475 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:23:22.476 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:23:22.477 DEBUG o.s.security.web.FilterChainProxy : Secured GET /api/pets/my-pets
2025-07-16 00:23:22.479 DEBUG o.s.web.servlet.DispatcherServlet : GET "/api/pets/my-pets", parameters={}
2025-07-16 00:23:22.479 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#getMyPets()
2025-07-16 00:23:22.480 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:23:22.481 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.getMyPets(); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:23:22.526 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.getMyPets(); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:23:22.526 INFO  S.virtualPets.controller.PetController : GET petition received to obtain the authenticated user pets
2025-07-16 00:23:22.526 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:23:22.526 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:23:22.528 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:23:22.528 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:23:22.529 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@383ea91c
2025-07-16 00:23:22.529 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:23:22.529 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:23:22.530 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:23:22.531 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:23:22.531 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:23:22.533 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@2036242314 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@222222696 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:23:22.535 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:23.058 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:23:23.061 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:23:23.061 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:23:23.062 INFO  S502.virtualPets.service.PetService : Request to obtain user pets 'Sergio'.
2025-07-16 00:23:23.063 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : pe1_0
2025-07-16 00:23:23.064 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.PetEntity(11))] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity] 
2025-07-16 00:23:23.064 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [org.hibernate.sql.ast.tree.from.LazyTableGroup@42c51857] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity(11).user] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity(11).user] 
2025-07-16 00:23:23.065 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : u1_0
2025-07-16 00:23:23.065 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@4764ea43
2025-07-16 00:23:23.065 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(11).user(12).id) 
2025-07-16 00:23:23.066 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.PetEntity(11)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).createdAt]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).energyLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).hungerLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).mood]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).name]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).petType]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).updatedAt]
 |  \-EntityDelayedFetchImpl [S502.virtualPets.persistence.entity.PetEntity(11).user]

2025-07-16 00:23:23.066 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (pe1 : S502.virtualPets.persistence.entity.PetEntity(11)) {
          primaryTableReference : pets as pe1_0
          TableGroupJoins {
            left  join LazyTableGroup (u1 : S502.virtualPets.persistence.entity.PetEntity(11).user(12)) {
              primaryTableReference : users as u1_0
            }
          }
        }
      }
    }

2025-07-16 00:23:23.068 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:23:23.405 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 left join users u1_0 on u1_0.id=pe1_0.user_id where u1_0.id=?
2025-07-16 00:23:23.408 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.PetEntity(11).user -> EntityDelayedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(11).user)@864211056 (ToOneAttributeMapping(NavigableRole[S502.virtualPets.persistence.entity.PetEntity.user])@845135647)
	  S502.virtualPets.persistence.entity.PetEntity(11) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(11))@1660828466 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.PetEntity))

2025-07-16 00:23:23.409 INFO  S502.virtualPets.service.PetService : They recovered 4 User pets 'Sergio'.
2025-07-16 00:23:23.410 INFO  S.virtualPets.controller.PetController : Returned 4 Pets for the current user.
2025-07-16 00:23:23.410 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:23:23.411 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [[PetResponseDTO[id=6, name=petx, type=GOKU, mood=NEUTRAL, energyLevel=75, hungerLevel=0, userId=1, u (truncated)...]
2025-07-16 00:23:23.412 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:23:23.413 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:23:23.416 DEBUG o.s.security.web.FilterChainProxy : Securing GET /api/pets/my-pets
2025-07-16 00:23:23.418 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:23:23.421 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:23:23.422 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:23:23.423 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@2b6f023e
2025-07-16 00:23:23.423 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:23:23.424 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:23:24.060 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:23:24.062 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:23:24.062 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:23:24.066 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@2068371419 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@634416175 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:23:24.068 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:24.069 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:23:24.073 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:23:24.074 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:23:24.075 DEBUG o.s.security.web.FilterChainProxy : Secured GET /api/pets/my-pets
2025-07-16 00:23:24.076 DEBUG o.s.web.servlet.DispatcherServlet : GET "/api/pets/my-pets", parameters={}
2025-07-16 00:23:24.077 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#getMyPets()
2025-07-16 00:23:24.078 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:23:24.079 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.getMyPets(); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:23:24.081 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.getMyPets(); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:23:24.081 INFO  S.virtualPets.controller.PetController : GET petition received to obtain the authenticated user pets
2025-07-16 00:23:24.870 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:23:24.871 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:23:24.874 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:23:24.876 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:23:24.877 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@75db539c
2025-07-16 00:23:24.879 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:23:24.880 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:23:24.882 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:23:24.883 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:23:24.884 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:23:24.891 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@2071506642 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@251133725 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:23:24.893 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:24.893 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:23:25.576 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:23:25.576 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:23:25.577 INFO  S502.virtualPets.service.PetService : Request to obtain user pets 'Sergio'.
2025-07-16 00:23:25.579 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : pe1_0
2025-07-16 00:23:25.580 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.PetEntity(11))] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity] 
2025-07-16 00:23:25.581 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [org.hibernate.sql.ast.tree.from.LazyTableGroup@2073c9ac] with identifierForTableGroup [S502.virtualPets.persistence.entity.PetEntity(11).user] for NavigablePath [S502.virtualPets.persistence.entity.PetEntity(11).user] 
2025-07-16 00:23:25.582 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : u1_0
2025-07-16 00:23:25.583 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@2df20911
2025-07-16 00:23:25.584 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.PetEntity(11).user(12).id) 
2025-07-16 00:23:25.586 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.PetEntity(11)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).createdAt]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).energyLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).hungerLevel]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).mood]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).name]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).petType]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.PetEntity(11).updatedAt]
 |  \-EntityDelayedFetchImpl [S502.virtualPets.persistence.entity.PetEntity(11).user]

2025-07-16 00:23:25.587 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (pe1 : S502.virtualPets.persistence.entity.PetEntity(11)) {
          primaryTableReference : pets as pe1_0
          TableGroupJoins {
            left  join LazyTableGroup (u1 : S502.virtualPets.persistence.entity.PetEntity(11).user(12)) {
              primaryTableReference : users as u1_0
            }
          }
        }
      }
    }

2025-07-16 00:23:25.589 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:23:25.589 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 left join users u1_0 on u1_0.id=pe1_0.user_id where u1_0.id=?
2025-07-16 00:23:25.594 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.PetEntity(11).user -> EntityDelayedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(11).user)@1743041631 (ToOneAttributeMapping(NavigableRole[S502.virtualPets.persistence.entity.PetEntity.user])@845135647)
	  S502.virtualPets.persistence.entity.PetEntity(11) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.PetEntity(11))@1273034594 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.PetEntity))

2025-07-16 00:23:25.720 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/15
2025-07-16 00:23:26.241 INFO  S502.virtualPets.service.PetService : They recovered 4 User pets 'Sergio'.
2025-07-16 00:23:26.242 INFO  S.virtualPets.controller.PetController : Returned 4 Pets for the current user.
2025-07-16 00:23:26.243 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:23:26.244 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/15
2025-07-16 00:23:26.244 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [[PetResponseDTO[id=6, name=petx, type=GOKU, mood=NEUTRAL, energyLevel=75, hungerLevel=0, userId=1, u (truncated)...]
2025-07-16 00:23:26.247 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:23:26.250 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:23:26.251 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:23:26.252 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:23:26.252 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@378bbfd1
2025-07-16 00:23:26.253 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:23:26.253 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:23:26.255 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:23:26.257 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:23:26.260 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:23:26.260 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:23:27.471 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1815490623 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@2100976650 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:23:27.472 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:27.473 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:23:27.477 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:23:27.478 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:23:27.478 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/15
2025-07-16 00:23:27.480 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/15", parameters={}
2025-07-16 00:23:27.482 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:23:27.483 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:23:27.485 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=45, hungerLevel=15]]
2025-07-16 00:23:27.486 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:23:27.488 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:23:27.488 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 15. Info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=45, hungerLevel=15]
2025-07-16 00:23:27.489 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:23:27.489 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:23:28.408 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:23:28.409 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:23:28.410 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@4c4f079a
2025-07-16 00:23:28.410 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:23:28.411 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:23:28.412 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:23:28.413 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:23:28.413 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:23:28.419 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@817116301 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1162805834 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:23:28.422 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:28.422 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:23:29.172 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:23:29.173 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:23:29.174 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 15 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=45, hungerLevel=15]
2025-07-16 00:23:29.175 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:23:29.175 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1352202932<open>)] for JPA transaction
2025-07-16 00:23:29.176 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:23:29.176 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@466179277 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb] read-only
2025-07-16 00:23:29.178 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:23:29.179 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:23:29.180 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@6417b51]
2025-07-16 00:23:29.183 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:29.184 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:23:29.188 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:23:29.189 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1352202932<open>)]
2025-07-16 00:23:29.189 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:23:29.192 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@466179277 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb]
2025-07-16 00:23:29.194 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:23:29.195 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 15.
2025-07-16 00:23:29.195 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1352202932<open>)] for JPA transaction
2025-07-16 00:23:29.195 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:23:29.196 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:23:29.198 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@39c3fc23]
2025-07-16 00:23:30.290 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1eebc3dc is alive
2025-07-16 00:23:30.322 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:23:30.323 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:23:30.324 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1352202932<open>)]
2025-07-16 00:23:30.325 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:23:30.326 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:23:30.326 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:23:30.327 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:23:30.328 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:23:30.330 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:23:30.331 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:23:30.331 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:23:30.332 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:23:30.333 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:23:30.334 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:23:30.334 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:23:30.335 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T19:15:12.829268, mood=NEUTRAL, energyLevel=45, hungerLevel=15, petType=VEGETA, name=PEPE, id=15, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:23:06.885390}
2025-07-16 00:23:30.335 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:23:30.335 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:23:30.337 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:23:31.321 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:23:31.322 INFO  S502.virtualPets.service.PetService : Pet 'PEPE' (ID: 15) Updated successfully by the user 'Sergio'.
2025-07-16 00:23:31.323 INFO  S.virtualPets.controller.PetController : Pet with ID 15 updated successfully.
2025-07-16 00:23:31.324 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:23:31.326 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=15, name=PEPE, type=VEGETA, mood=NEUTRAL, energyLevel=45, hungerLevel=15, userId=1 (truncated)...]
2025-07-16 00:23:31.329 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:23:31.330 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:23:35.144 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/16
2025-07-16 00:23:35.150 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/16
2025-07-16 00:23:35.152 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:23:35.154 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:23:35.155 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:23:35.156 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@10eb8417
2025-07-16 00:23:35.157 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:23:35.158 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:23:35.160 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:23:35.161 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:23:35.162 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:23:35.168 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1452328893 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1818638218 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:23:35.169 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:35.170 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:23:35.176 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:23:35.177 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:23:35.178 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/16
2025-07-16 00:23:35.180 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/16", parameters={}
2025-07-16 00:23:35.181 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:23:35.181 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:23:35.183 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=65, hungerLevel=50]]
2025-07-16 00:23:35.185 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:23:35.186 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:23:35.187 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 16. Info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=65, hungerLevel=50]
2025-07-16 00:23:35.188 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:23:35.189 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:23:35.190 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:23:35.192 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:23:35.193 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@40c62d3c
2025-07-16 00:23:35.194 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:23:35.267 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:23:35.268 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:23:35.269 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:23:35.270 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:23:35.273 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@872865445 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1031252064 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:23:35.275 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:35.276 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:23:35.282 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:23:35.283 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:23:35.284 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 16 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=65, hungerLevel=50]
2025-07-16 00:23:35.284 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:23:35.285 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(944021069<open>)] for JPA transaction
2025-07-16 00:23:36.675 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:23:36.676 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1102961250 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb] read-only
2025-07-16 00:23:36.680 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:23:36.682 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:23:36.685 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@5461ed62]
2025-07-16 00:23:36.687 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:36.687 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:23:36.691 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:23:36.692 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(944021069<open>)]
2025-07-16 00:23:36.693 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:23:36.696 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1102961250 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb]
2025-07-16 00:23:36.698 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:23:36.699 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 16.
2025-07-16 00:23:36.700 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(944021069<open>)] for JPA transaction
2025-07-16 00:23:36.701 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:23:36.701 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:23:36.704 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@1b8df055]
2025-07-16 00:23:36.704 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:23:36.705 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:23:36.706 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(944021069<open>)]
2025-07-16 00:23:36.707 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:23:36.708 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:23:36.709 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:23:37.754 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:23:37.755 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:23:37.755 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:23:37.757 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:23:37.757 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:23:37.758 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:23:37.759 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:23:37.760 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T22:48:42.167443, mood=ANGRY, energyLevel=65, hungerLevel=50, petType=FREZER, name=XX, id=16, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:11:30.536079}
2025-07-16 00:23:37.761 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:23:37.761 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:23:37.762 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:23:37.763 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:23:37.764 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:23:37.780 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:23:37.781 INFO  S502.virtualPets.service.PetService : Pet 'XX' (ID: 16) Updated successfully by the user 'Sergio'.
2025-07-16 00:23:37.782 INFO  S.virtualPets.controller.PetController : Pet with ID 16 updated successfully.
2025-07-16 00:23:37.783 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:23:37.784 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=16, name=XX, type=FREZER, mood=ANGRY, energyLevel=65, hungerLevel=50, userId=1, us (truncated)...]
2025-07-16 00:23:37.787 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:23:37.788 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:23:39.907 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/16
2025-07-16 00:23:39.910 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:23:39.912 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:23:39.913 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:23:39.914 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@3b3df4d3
2025-07-16 00:23:39.915 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:23:39.916 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:23:39.917 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:23:39.918 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:23:39.918 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:23:39.922 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@350854268 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1125774759 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:23:39.924 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:39.925 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:23:39.931 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:23:39.932 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:23:39.933 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/16
2025-07-16 00:23:39.934 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/16", parameters={}
2025-07-16 00:23:39.935 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:23:39.937 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:23:39.940 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=75, hungerLevel=35]]
2025-07-16 00:23:39.944 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:23:39.946 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:23:39.947 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 16. Info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=75, hungerLevel=35]
2025-07-16 00:23:39.948 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:23:39.949 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:23:39.950 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:23:39.951 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:23:39.952 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@bc44063
2025-07-16 00:23:39.952 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:23:39.953 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:23:39.955 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:23:39.956 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:23:39.957 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:23:40.147 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1843459834 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@854963584 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:23:40.148 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:40.149 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:23:40.153 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:23:40.154 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:23:40.155 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 16 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=ANGRY, energyLevel=75, hungerLevel=35]
2025-07-16 00:23:40.155 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:23:40.156 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(503012699<open>)] for JPA transaction
2025-07-16 00:23:40.157 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:23:40.157 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1321842598 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb] read-only
2025-07-16 00:23:40.161 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:23:40.162 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:23:40.164 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@2eb836d0]
2025-07-16 00:23:40.166 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:40.167 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:23:41.481 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:23:41.482 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(503012699<open>)]
2025-07-16 00:23:41.483 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:23:41.486 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1321842598 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb]
2025-07-16 00:23:41.489 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:23:41.489 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 16.
2025-07-16 00:23:41.490 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(503012699<open>)] for JPA transaction
2025-07-16 00:23:41.492 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:23:41.493 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:23:41.495 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@36b9ff37]
2025-07-16 00:23:41.496 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:23:41.497 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:23:41.498 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(503012699<open>)]
2025-07-16 00:23:41.499 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:23:41.499 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:23:41.500 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:23:41.500 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:23:41.501 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:23:41.502 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:23:41.503 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:23:41.505 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:23:41.506 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:23:41.508 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:23:41.508 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T22:48:42.167443, mood=ANGRY, energyLevel=75, hungerLevel=35, petType=FREZER, name=XX, id=16, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:23:37.764856}
2025-07-16 00:23:41.925 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=9/10, active=1, waiting=0)
2025-07-16 00:23:42.743 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:23:42.742 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:23:42.743 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:23:42.744 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:23:42.744 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:23:42.745 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:23:42.760 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:23:42.761 INFO  S502.virtualPets.service.PetService : Pet 'XX' (ID: 16) Updated successfully by the user 'Sergio'.
2025-07-16 00:23:42.762 INFO  S.virtualPets.controller.PetController : Pet with ID 16 updated successfully.
2025-07-16 00:23:42.762 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:23:42.763 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=16, name=XX, type=FREZER, mood=ANGRY, energyLevel=75, hungerLevel=35, userId=1, us (truncated)...]
2025-07-16 00:23:42.766 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:23:42.767 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:23:44.910 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1e943acb is alive
2025-07-16 00:23:48.164 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@80f4492 is alive
2025-07-16 00:23:48.798 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/13
2025-07-16 00:23:48.808 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:23:48.810 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:23:48.812 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:23:48.812 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:23:48.813 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@63d614b9
2025-07-16 00:23:48.814 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:23:48.816 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:23:48.817 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:23:48.819 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:23:48.820 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:23:48.824 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@980715513 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1838423762 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:23:48.825 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:48.827 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:23:48.832 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:23:48.833 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:23:48.835 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:23:48.836 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:23:48.837 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:23:48.838 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:23:48.839 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=35, hungerLevel=15]]
2025-07-16 00:23:48.841 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:23:48.842 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:23:48.842 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=35, hungerLevel=15]
2025-07-16 00:23:48.843 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:23:48.843 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:23:48.845 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:23:48.845 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:23:48.847 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@53f16b55
2025-07-16 00:23:48.847 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:23:48.850 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:23:49.031 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:23:49.034 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:23:49.034 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:23:49.039 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1899262542 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@688870817 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:23:49.040 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:49.040 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:23:49.044 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:23:49.045 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:23:49.046 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=35, hungerLevel=15]
2025-07-16 00:23:49.046 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:23:49.046 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(973028848<open>)] for JPA transaction
2025-07-16 00:23:49.047 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:23:49.047 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1044530731 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb] read-only
2025-07-16 00:23:49.049 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:23:49.050 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:23:49.052 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@291b66ec]
2025-07-16 00:23:49.817 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:49.818 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:23:49.822 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:23:49.823 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(973028848<open>)]
2025-07-16 00:23:49.823 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:23:49.825 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1044530731 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb]
2025-07-16 00:23:49.828 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:23:49.828 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:23:49.829 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(973028848<open>)] for JPA transaction
2025-07-16 00:23:49.830 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:23:49.830 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:23:49.832 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@6b041bb2]
2025-07-16 00:23:49.833 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:23:49.834 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:23:49.835 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(973028848<open>)]
2025-07-16 00:23:49.835 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:23:49.835 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:23:49.836 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:23:49.837 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:23:49.838 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:23:49.839 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:23:49.840 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:23:49.840 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:23:50.334 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:23:50.334 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:23:50.335 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:23:50.336 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:23:50.336 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:23:50.337 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:23:50.337 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=NEUTRAL, energyLevel=35, hungerLevel=15, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:19:02.794137}
2025-07-16 00:23:50.338 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:23:50.352 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:23:50.353 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:23:50.353 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:23:50.354 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:23:50.354 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=NEUTRAL, energyLevel=35, hungerLevel=15, userId=1, u (truncated)...]
2025-07-16 00:23:50.356 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:23:50.357 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:23:51.162 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:23:51.166 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:23:51.170 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:23:51.170 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:23:51.171 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@3166d128
2025-07-16 00:23:51.172 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:23:51.173 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:23:51.174 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:23:51.176 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:23:51.176 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:23:51.181 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1099445916 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1227812014 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:23:51.182 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:51.183 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:23:51.187 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:23:51.188 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:23:51.189 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:23:51.190 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:23:51.192 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:23:51.194 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:23:51.196 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=45, hungerLevel=0]]
2025-07-16 00:23:51.198 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:23:51.199 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:23:51.199 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=45, hungerLevel=0]
2025-07-16 00:23:51.200 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:23:51.200 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:23:51.201 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:23:51.202 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:23:51.204 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@6a6d472c
2025-07-16 00:23:51.204 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:23:51.205 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:23:51.205 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:23:51.206 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:23:51.206 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:23:51.256 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1750840820 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1109080163 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:23:51.258 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:51.258 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:23:51.262 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:23:51.263 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:23:51.264 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=45, hungerLevel=0]
2025-07-16 00:23:51.265 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:23:51.266 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1484297065<open>)] for JPA transaction
2025-07-16 00:23:51.267 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:23:51.267 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1032393299 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb] read-only
2025-07-16 00:23:51.269 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:23:51.269 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:23:51.271 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@15b8a2f2]
2025-07-16 00:23:51.272 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:51.273 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:23:51.276 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:23:51.277 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1484297065<open>)]
2025-07-16 00:23:51.505 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:23:51.508 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1032393299 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb]
2025-07-16 00:23:51.510 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:23:51.511 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:23:51.511 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1484297065<open>)] for JPA transaction
2025-07-16 00:23:51.511 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:23:51.512 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:23:51.514 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@51a0d4d8]
2025-07-16 00:23:51.514 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:23:51.515 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:23:51.515 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1484297065<open>)]
2025-07-16 00:23:51.516 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:23:51.516 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:23:51.517 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:23:51.518 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:23:51.518 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:23:51.519 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:23:51.519 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:23:51.519 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:23:51.520 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:23:51.520 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:23:51.521 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:23:52.019 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:23:52.020 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:23:52.020 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:23:52.021 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=NEUTRAL, energyLevel=45, hungerLevel=0, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:23:50.338286}
2025-07-16 00:23:52.022 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:23:52.036 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:23:52.037 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:23:52.037 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:23:52.038 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:23:52.038 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=NEUTRAL, energyLevel=45, hungerLevel=0, userId=1, us (truncated)...]
2025-07-16 00:23:52.040 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:23:52.041 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:23:52.957 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:23:52.960 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:23:52.961 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:23:52.963 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:23:52.964 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@12a266be
2025-07-16 00:23:52.965 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:23:52.967 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:23:52.968 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:23:52.969 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:23:52.969 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:23:52.974 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1271609206 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1383255733 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:23:52.975 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:52.975 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:23:53.793 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:23:53.794 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:23:53.795 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:23:53.796 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:23:53.797 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:23:53.798 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:23:53.800 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=55, hungerLevel=0]]
2025-07-16 00:23:53.801 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:23:53.803 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:23:53.803 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=55, hungerLevel=0]
2025-07-16 00:23:53.804 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:23:53.805 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:23:53.805 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:23:53.806 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:23:53.807 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@637a9d5f
2025-07-16 00:23:53.807 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:23:53.808 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:23:54.525 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@48b33fb1 is alive
2025-07-16 00:23:54.525 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:23:54.526 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:23:54.528 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:23:54.531 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@53604109 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1990616532 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:23:54.533 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:54.534 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:23:54.537 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:23:54.538 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:23:54.538 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=55, hungerLevel=0]
2025-07-16 00:23:54.539 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:23:54.539 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(575495895<open>)] for JPA transaction
2025-07-16 00:23:54.540 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:23:54.541 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@2131888693 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb] read-only
2025-07-16 00:23:54.542 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:23:55.313 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:23:55.315 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@3b1344b]
2025-07-16 00:23:55.317 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:55.318 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:23:55.321 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:23:55.322 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(575495895<open>)]
2025-07-16 00:23:55.322 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:23:55.326 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@2131888693 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb]
2025-07-16 00:23:55.330 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:23:55.330 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:23:55.331 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(575495895<open>)] for JPA transaction
2025-07-16 00:23:55.332 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:23:55.332 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:23:55.334 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@6e1d95ce]
2025-07-16 00:23:55.335 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:23:55.336 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:23:55.336 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(575495895<open>)]
2025-07-16 00:23:55.337 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:23:55.337 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:23:55.338 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:23:55.339 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:23:55.339 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:23:55.340 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:23:55.827 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:23:55.828 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:23:55.829 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:23:55.829 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:23:55.829 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:23:55.829 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:23:55.830 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:23:55.831 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:23:55.831 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=NEUTRAL, energyLevel=55, hungerLevel=0, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:23:52.022792}
2025-07-16 00:23:55.833 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:23:55.847 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:23:55.848 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:23:55.849 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:23:55.849 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:23:55.850 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=NEUTRAL, energyLevel=55, hungerLevel=0, userId=1, us (truncated)...]
2025-07-16 00:23:55.852 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:23:55.853 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:23:56.507 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/13
2025-07-16 00:23:56.513 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:23:56.514 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:23:56.515 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:23:56.516 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:23:56.517 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@14b3633a
2025-07-16 00:23:56.517 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:23:56.518 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:23:56.519 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:23:56.520 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:23:56.521 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:23:56.524 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1696038384 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1099333577 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:23:56.526 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:56.526 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:23:56.768 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:23:56.769 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:23:56.770 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:23:56.771 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:23:56.771 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:23:56.772 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:23:56.774 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=65, hungerLevel=0]]
2025-07-16 00:23:56.776 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:23:56.778 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:23:56.779 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=65, hungerLevel=0]
2025-07-16 00:23:56.779 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:23:56.780 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:23:56.781 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:23:56.782 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:23:56.783 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@34673ac2
2025-07-16 00:23:56.783 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:23:56.783 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:23:57.290 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:23:57.291 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:23:57.291 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:23:57.296 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@744835155 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1713025796 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:23:57.297 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:57.298 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:23:57.302 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:23:57.304 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:23:57.304 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=65, hungerLevel=0]
2025-07-16 00:23:57.305 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:23:57.305 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(572402741<open>)] for JPA transaction
2025-07-16 00:23:57.306 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:23:57.306 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@158888152 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb] read-only
2025-07-16 00:23:57.308 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:23:57.757 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:23:57.761 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@30bdaaa8]
2025-07-16 00:23:57.763 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:57.763 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:23:57.766 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:23:57.767 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(572402741<open>)]
2025-07-16 00:23:57.767 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:23:57.770 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@158888152 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb]
2025-07-16 00:23:57.772 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:23:57.773 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:23:57.774 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(572402741<open>)] for JPA transaction
2025-07-16 00:23:57.774 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:23:57.775 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:23:57.777 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@68009482]
2025-07-16 00:23:57.778 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:23:57.780 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:23:57.780 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(572402741<open>)]
2025-07-16 00:23:57.781 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:23:57.782 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:23:57.782 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:23:57.783 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:23:57.783 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:23:57.784 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:23:58.131 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:23:58.131 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:23:58.131 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:23:58.132 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:23:58.132 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:23:58.132 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:23:58.133 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:23:58.133 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:23:58.134 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=NEUTRAL, energyLevel=65, hungerLevel=0, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:23:55.833712}
2025-07-16 00:23:58.135 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:23:58.149 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:23:58.150 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:23:58.150 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:23:58.151 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:23:58.152 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=NEUTRAL, energyLevel=65, hungerLevel=0, userId=1, us (truncated)...]
2025-07-16 00:23:58.153 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:23:58.154 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:23:58.809 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:23:58.812 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:23:58.814 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:23:58.819 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:23:59.656 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@43577742
2025-07-16 00:23:59.656 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:23:59.658 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:23:59.659 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:23:59.660 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:23:59.660 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:23:59.664 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@2146594979 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@34507497 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:23:59.666 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:23:59.667 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:23:59.672 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:23:59.672 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:24:00.536 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:24:00.537 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:24:00.538 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:24:00.538 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:24:00.540 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=75, hungerLevel=0]]
2025-07-16 00:24:00.542 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:24:00.543 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:24:00.544 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=75, hungerLevel=0]
2025-07-16 00:24:00.544 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:24:00.545 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:24:00.546 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:24:00.547 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:24:00.548 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@7e3dba3
2025-07-16 00:24:00.549 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:24:00.549 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:24:00.551 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:24:00.553 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:24:00.993 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:24:00.997 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@217580403 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1774261020 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:24:00.998 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:24:00.999 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:24:01.002 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:24:01.003 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:24:01.003 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=NEUTRAL, energyLevel=75, hungerLevel=0]
2025-07-16 00:24:01.004 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:24:01.004 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(742551890<open>)] for JPA transaction
2025-07-16 00:24:01.004 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:24:01.005 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@944120015 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb] read-only
2025-07-16 00:24:01.007 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:24:01.008 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:24:01.009 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@244e3cc0]
2025-07-16 00:24:01.011 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:24:01.012 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:24:01.507 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@22063a0c is alive
2025-07-16 00:24:01.840 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:24:01.841 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(742551890<open>)]
2025-07-16 00:24:01.841 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:24:01.844 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@944120015 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb]
2025-07-16 00:24:01.846 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:24:01.846 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:24:01.847 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(742551890<open>)] for JPA transaction
2025-07-16 00:24:01.847 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:24:01.848 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:24:01.849 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@38952a1]
2025-07-16 00:24:01.850 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:24:01.852 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:24:01.853 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(742551890<open>)]
2025-07-16 00:24:01.853 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:24:01.854 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:24:01.854 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:24:01.855 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:24:01.856 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:24:01.858 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:24:01.859 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:24:01.860 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:24:01.860 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:24:02.367 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:24:02.368 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:24:02.369 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:24:02.370 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:24:02.370 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:24:02.371 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=NEUTRAL, energyLevel=75, hungerLevel=0, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:23:58.134092}
2025-07-16 00:24:02.373 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:24:02.386 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:24:02.386 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:24:02.386 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:24:02.387 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:24:02.388 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=NEUTRAL, energyLevel=75, hungerLevel=0, userId=1, us (truncated)...]
2025-07-16 00:24:02.391 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:24:02.393 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:24:03.049 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/13
2025-07-16 00:24:03.058 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:24:03.061 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:24:03.062 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:24:03.063 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:24:03.064 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@238fea82
2025-07-16 00:24:03.064 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:24:03.065 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:24:03.066 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:24:03.066 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:24:03.067 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:24:03.071 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@573365975 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1737034576 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:24:03.072 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:24:03.073 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:24:03.373 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:24:03.374 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:24:03.375 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:24:03.375 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:24:03.376 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:24:03.377 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:24:03.379 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=HAPPY, energyLevel=85, hungerLevel=0]]
2025-07-16 00:24:03.380 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:24:03.381 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:24:03.382 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=HAPPY, energyLevel=85, hungerLevel=0]
2025-07-16 00:24:03.382 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:24:03.382 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:24:03.384 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:24:03.385 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:24:03.386 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@51c8668b
2025-07-16 00:24:03.386 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:24:03.388 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:24:03.633 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@48cdd8da is alive
2025-07-16 00:24:03.824 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:24:03.825 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:24:03.826 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:24:03.829 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1518194809 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1849745641 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:24:03.830 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:24:03.831 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:24:03.834 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:24:03.835 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:24:03.836 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=HAPPY, energyLevel=85, hungerLevel=0]
2025-07-16 00:24:03.837 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:24:03.839 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1493852806<open>)] for JPA transaction
2025-07-16 00:24:03.840 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:24:03.840 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@340552624 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb] read-only
2025-07-16 00:24:04.445 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:24:04.445 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:24:04.452 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@407bf887]
2025-07-16 00:24:04.454 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:24:04.455 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:24:04.464 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:24:04.465 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1493852806<open>)]
2025-07-16 00:24:04.465 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:24:04.469 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@340552624 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb]
2025-07-16 00:24:04.471 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:24:04.472 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:24:04.473 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1493852806<open>)] for JPA transaction
2025-07-16 00:24:04.473 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:24:04.474 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:24:04.476 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@e6343ef]
2025-07-16 00:24:04.477 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:24:04.479 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:24:04.479 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1493852806<open>)]
2025-07-16 00:24:04.480 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:24:04.480 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:24:04.480 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:24:04.481 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:24:04.482 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:24:05.398 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:24:05.399 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:24:05.399 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:24:05.400 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:24:05.400 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:24:05.400 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:24:05.401 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:24:05.401 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:24:05.401 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:24:05.402 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=HAPPY, energyLevel=85, hungerLevel=0, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:24:02.373569}
2025-07-16 00:24:05.404 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:24:05.420 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:24:05.420 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:24:05.420 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:24:05.421 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:24:05.422 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=HAPPY, energyLevel=85, hungerLevel=0, userId=1, user (truncated)...]
2025-07-16 00:24:05.424 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:24:05.425 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:24:06.538 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:24:06.540 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:24:06.541 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:24:06.542 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:24:06.544 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@404d2f23
2025-07-16 00:24:06.545 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:24:06.546 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:24:06.548 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:24:06.549 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:24:06.549 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:24:06.554 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1905468044 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1178923754 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:24:06.556 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:24:06.556 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:24:06.560 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:24:06.560 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:24:06.562 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:24:06.563 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:24:06.564 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:24:06.564 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:24:06.566 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=HAPPY, energyLevel=95, hungerLevel=0]]
2025-07-16 00:24:06.568 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:24:06.570 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:24:06.571 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=HAPPY, energyLevel=95, hungerLevel=0]
2025-07-16 00:24:06.571 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:24:06.572 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:24:06.573 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:24:06.598 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:24:06.599 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@7247f706
2025-07-16 00:24:06.600 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:24:06.601 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:24:06.602 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:24:06.603 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:24:06.604 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:24:06.607 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1505961521 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@627849861 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:24:06.608 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:24:06.609 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:24:06.613 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:24:07.144 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:24:07.145 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=HAPPY, energyLevel=95, hungerLevel=0]
2025-07-16 00:24:07.145 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:24:07.146 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1811631722<open>)] for JPA transaction
2025-07-16 00:24:07.146 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:24:07.146 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@945634566 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb] read-only
2025-07-16 00:24:07.148 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:24:07.149 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:24:07.151 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@18ec42b3]
2025-07-16 00:24:07.153 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:24:07.154 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:24:07.158 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:24:07.159 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1811631722<open>)]
2025-07-16 00:24:07.159 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:24:07.162 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@945634566 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb]
2025-07-16 00:24:07.163 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:24:07.164 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:24:07.165 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(1811631722<open>)] for JPA transaction
2025-07-16 00:24:07.165 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:24:07.166 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:24:07.167 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@6b41ca66]
2025-07-16 00:24:07.168 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:24:07.721 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:24:07.723 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(1811631722<open>)]
2025-07-16 00:24:07.723 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:24:07.724 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:24:07.725 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:24:07.725 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:24:07.726 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:24:07.727 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:24:07.728 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:24:07.729 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:24:07.729 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:24:07.730 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:24:07.730 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:24:07.731 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:24:07.731 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:24:07.732 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:24:07.732 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=HAPPY, energyLevel=95, hungerLevel=0, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:24:05.403209}
2025-07-16 00:24:07.734 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:24:07.747 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:24:07.748 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:24:08.416 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:24:08.418 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:24:08.419 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=HAPPY, energyLevel=95, hungerLevel=0, userId=1, user (truncated)...]
2025-07-16 00:24:08.421 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:24:08.422 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:24:09.912 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/13
2025-07-16 00:24:09.919 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:24:09.920 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:24:09.922 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:24:09.922 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:24:09.923 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@37fc58c
2025-07-16 00:24:09.924 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:24:09.925 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:24:09.926 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:24:09.927 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:24:09.927 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:24:09.931 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@2046377961 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@779856586 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:24:09.933 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:24:09.934 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:24:09.940 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:24:09.941 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:24:09.943 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:24:09.944 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:24:09.944 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:24:09.944 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:24:09.946 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=HAPPY, energyLevel=100, hungerLevel=0]]
2025-07-16 00:24:09.947 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:24:09.949 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:24:09.950 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=HAPPY, energyLevel=100, hungerLevel=0]
2025-07-16 00:24:09.950 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:24:09.951 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:24:09.952 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:24:09.953 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:24:09.955 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@4eba3467
2025-07-16 00:24:09.955 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:24:09.956 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:24:09.957 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:24:09.958 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:24:10.004 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:24:10.008 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1736203025 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1588923293 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:24:10.009 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:24:10.010 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:24:10.013 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:24:10.014 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:24:10.014 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=HAPPY, energyLevel=100, hungerLevel=0]
2025-07-16 00:24:10.015 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:24:10.015 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(534135365<open>)] for JPA transaction
2025-07-16 00:24:10.015 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:24:10.016 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1607723532 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb] read-only
2025-07-16 00:24:10.018 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:24:10.019 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:24:10.021 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@fa74d87]
2025-07-16 00:24:10.022 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:24:10.023 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:24:10.462 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:24:10.463 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(534135365<open>)]
2025-07-16 00:24:10.464 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:24:10.469 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1607723532 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb]
2025-07-16 00:24:10.470 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:24:10.471 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:24:10.472 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(534135365<open>)] for JPA transaction
2025-07-16 00:24:10.473 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:24:10.473 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:24:10.475 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@1f1e87ce]
2025-07-16 00:24:10.476 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:24:10.476 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:24:10.477 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(534135365<open>)]
2025-07-16 00:24:10.477 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:24:10.477 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:24:10.478 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:24:10.478 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:24:10.479 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:24:10.480 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:24:10.480 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:24:10.481 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:24:10.482 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:24:10.861 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:24:10.862 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:24:10.862 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:24:10.862 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:24:10.863 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:24:10.863 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=HAPPY, energyLevel=100, hungerLevel=0, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:24:07.733542}
2025-07-16 00:24:10.865 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:24:10.879 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:24:10.879 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:24:10.880 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:24:10.881 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:24:10.882 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=HAPPY, energyLevel=100, hungerLevel=0, userId=1, use (truncated)...]
2025-07-16 00:24:10.884 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:24:10.885 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:24:12.753 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:24:12.754 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:24:15.039 DEBUG o.s.security.web.FilterChainProxy : Securing OPTIONS /api/pets/13
2025-07-16 00:24:15.046 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:24:15.049 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:24:15.050 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:24:15.051 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:24:15.052 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@74151a58
2025-07-16 00:24:15.053 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:24:15.054 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:24:15.055 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:24:15.057 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:24:15.057 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:24:15.060 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@546163797 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1893130232 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:24:15.061 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:24:15.062 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:24:15.067 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:24:15.068 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:24:15.070 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:24:15.070 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:24:15.071 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:24:15.072 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:24:15.073 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=85, hungerLevel=15]]
2025-07-16 00:24:15.074 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:24:15.075 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:24:15.076 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=85, hungerLevel=15]
2025-07-16 00:24:15.302 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:24:15.302 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:24:15.303 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:24:15.304 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:24:15.305 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@2ee698b8
2025-07-16 00:24:15.306 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:24:15.307 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:24:15.308 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:24:15.309 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:24:15.309 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:24:15.313 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1826278116 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@272929765 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:24:15.314 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:24:15.315 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:24:15.996 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:24:15.997 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:24:15.998 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=85, hungerLevel=15]
2025-07-16 00:24:15.999 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:24:15.999 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(883173644<open>)] for JPA transaction
2025-07-16 00:24:16.000 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:24:16.000 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@41593996 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb] read-only
2025-07-16 00:24:16.002 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:24:16.002 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:24:16.004 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@996c79b]
2025-07-16 00:24:16.006 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:24:16.007 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:24:16.011 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:24:16.012 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(883173644<open>)]
2025-07-16 00:24:16.013 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:24:16.016 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@41593996 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb]
2025-07-16 00:24:16.018 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:24:16.018 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:24:16.019 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(883173644<open>)] for JPA transaction
2025-07-16 00:24:16.019 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:24:16.019 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:24:16.021 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@5650b695]
2025-07-16 00:24:16.913 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:24:16.914 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:24:16.915 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(883173644<open>)]
2025-07-16 00:24:16.915 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:24:16.916 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:24:16.916 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:24:16.917 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:24:16.917 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:24:16.918 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:24:16.918 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:24:16.919 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:24:16.920 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:24:16.920 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:24:16.921 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:24:16.921 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:24:16.922 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:24:16.922 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:24:16.923 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=EXCITED, energyLevel=85, hungerLevel=15, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:24:10.864692}
2025-07-16 00:24:16.924 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:24:16.937 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:24:17.369 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:24:17.369 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:24:17.371 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:24:17.371 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=EXCITED, energyLevel=85, hungerLevel=15, userId=1, u (truncated)...]
2025-07-16 00:24:17.373 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:24:17.375 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:24:18.460 DEBUG o.s.security.web.FilterChainProxy : Securing PUT /api/pets/13
2025-07-16 00:24:18.464 DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
2025-07-16 00:24:18.466 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:24:18.466 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:24:18.467 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@31e4be6f
2025-07-16 00:24:18.468 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:24:18.469 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:24:18.470 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:24:18.470 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:24:18.471 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:24:18.477 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1375689708 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1217054195 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:24:18.479 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:24:18.480 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:24:18.483 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:24:18.484 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:24:18.485 DEBUG o.s.security.web.FilterChainProxy : Secured PUT /api/pets/13
2025-07-16 00:24:18.486 DEBUG o.s.web.servlet.DispatcherServlet : PUT "/api/pets/13", parameters={}
2025-07-16 00:24:18.487 DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to S502.virtualPets.controller.PetController#updatePet(Long, UpdatePetRequestDTO)
2025-07-16 00:24:18.487 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:24:18.489 DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=70, hungerLevel=30]]
2025-07-16 00:24:18.491 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:24:18.492 DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor : Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity S502.virtualPets.controller.PetController.updatePet(java.lang.Long,S502.virtualPets.dto.UpdatePetRequestDTO); target is of class [S502.virtualPets.controller.PetController]
2025-07-16 00:24:18.494 INFO  S.virtualPets.controller.PetController : PUT petition received to update pet with ID: 13. Info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=70, hungerLevel=30]
2025-07-16 00:24:18.494 DEBUG S502.virtualPets.service.PetService : Trying to recover authenticated user from the security context.
2025-07-16 00:24:18.495 INFO  S502.virtualPets.service.PetService : Recovered authenticated user: Sergio
2025-07-16 00:24:18.497 DEBUG org.hibernate.orm.sql.ast.create : Created new SQL alias : ue1_0
2025-07-16 00:24:18.498 DEBUG org.hibernate.orm.sql.ast.create : Registration of TableGroup [StandardTableGroup(S502.virtualPets.persistence.entity.UserEntity(2))] with identifierForTableGroup [S502.virtualPets.persistence.entity.UserEntity] for NavigablePath [S502.virtualPets.persistence.entity.UserEntity] 
2025-07-16 00:24:18.499 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmParameter : org.hibernate.query.sqm.tree.expression.SqmJpaCriteriaParameterWrapper@363e6032
2025-07-16 00:24:18.500 DEBUG o.h.q.sqm.sql.BaseSqmToSqlAstConverter : Determining mapping-model type for SqmPath : SqmBasicValuedSimplePath(S502.virtualPets.persistence.entity.UserEntity(2).username) 
2025-07-16 00:24:18.500 DEBUG org.hibernate.orm.results.graph.AST : DomainResult Graph:
 \-EntityResultImpl [S502.virtualPets.persistence.entity.UserEntity(2)]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNoLocked]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).accountNotExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).credentialNoExpired]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).isEnable]
 |  +-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).password]
 |  +-SelectEagerCollectionFetch [S502.virtualPets.persistence.entity.UserEntity(2).roles]
 |  \-BasicFetch [S502.virtualPets.persistence.entity.UserEntity(2).username]

2025-07-16 00:24:18.501 DEBUG org.hibernate.orm.sql.ast.tree : SQL AST Tree:
    SelectStatement {
      FromClause {
        StandardTableGroup (ue1 : S502.virtualPets.persistence.entity.UserEntity(2)) {
          primaryTableReference : users as ue1_0
        }
      }
    }

2025-07-16 00:24:18.502 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = NORMAL
2025-07-16 00:24:18.503 DEBUG org.hibernate.SQL : select ue1_0.id,ue1_0.account_no_locked,ue1_0.account_no_expired,ue1_0.credential_no_expired,ue1_0.is_enabled,ue1_0.password,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-07-16 00:24:18.507 DEBUG org.hibernate.orm.results : Initializer list:
	  S502.virtualPets.persistence.entity.UserEntity(2).roles -> SelectEagerCollectionInitializer(S502.virtualPets.persistence.entity.UserEntity(2).roles)@1869705288 (PluralAttribute(S502.virtualPets.persistence.entity.UserEntity.roles))
	  S502.virtualPets.persistence.entity.UserEntity(2) -> EntityJoinedFetchInitializer(S502.virtualPets.persistence.entity.UserEntity(2))@1901812224 (SingleTableEntityPersister(S502.virtualPets.persistence.entity.UserEntity))

2025-07-16 00:24:18.508 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:24:18.509 DEBUG org.hibernate.SQL : select r1_0.user_id,r1_1.id,pe1_0.role_id,pe1_1.id,pe1_1.permission_name,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.id=r1_0.role_id left join role_permissions pe1_0 on r1_1.id=pe1_0.role_id left join permissions pe1_1 on pe1_1.id=pe1_0.permission_id where r1_0.user_id=?
2025-07-16 00:24:18.558 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1]
2025-07-16 00:24:18.560 DEBUG o.h.sql.results.internal.ResultsHelper : Collection fully initialized: [S502.virtualPets.persistence.entity.UserEntity.roles#1]
2025-07-16 00:24:18.561 INFO  S502.virtualPets.service.PetService : Request to update pet with ID: 13 by the user 'Sergio'. info: UpdatePetRequestDTO[name=null, mood=EXCITED, energyLevel=70, hungerLevel=30]
2025-07-16 00:24:18.561 DEBUG S502.virtualPets.service.PetService : Verifying admin role for the user 'Sergio': true
2025-07-16 00:24:18.562 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(2062694447<open>)] for JPA transaction
2025-07-16 00:24:18.562 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-07-16 00:24:18.563 DEBUG o.s.jdbc.datasource.DataSourceUtils : Setting JDBC Connection [HikariProxyConnection@1727156455 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb] read-only
2025-07-16 00:24:18.565 DEBUG o.h.e.t.internal.TransactionImpl : On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false
2025-07-16 00:24:18.566 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:24:18.567 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@42d2a97a]
2025-07-16 00:24:18.569 DEBUG org.hibernate.orm.sql.exec : Skipping reading Query result cache data: cache-enabled = false, cache-mode = IGNORE
2025-07-16 00:24:18.570 DEBUG org.hibernate.SQL : select pe1_0.id,pe1_0.created_at,pe1_0.energy_level,pe1_0.hunger_level,pe1_0.mood,pe1_0.name,pe1_0.pet_type,pe1_0.updated_at,pe1_0.user_id from pets pe1_0 where pe1_0.id=?
2025-07-16 00:24:18.575 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:24:18.576 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(2062694447<open>)]
2025-07-16 00:24:18.577 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:24:18.580 DEBUG o.s.jdbc.datasource.DataSourceUtils : Resetting read-only flag of JDBC Connection [HikariProxyConnection@1727156455 wrapping com.mysql.cj.jdbc.ConnectionImpl@1e943acb]
2025-07-16 00:24:18.582 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:24:18.583 DEBUG S502.virtualPets.service.PetService : User ADMIN 'Sergio' Updating pet with ID: 13.
2025-07-16 00:24:18.583 DEBUG o.s.orm.jpa.JpaTransactionManager : Found thread-bound EntityManager [SessionImpl(2062694447<open>)] for JPA transaction
2025-07-16 00:24:18.584 DEBUG o.s.orm.jpa.JpaTransactionManager : Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-07-16 00:24:19.201 DEBUG o.h.e.t.internal.TransactionImpl : begin
2025-07-16 00:24:19.204 DEBUG o.s.orm.jpa.JpaTransactionManager : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@29ff21dc]
2025-07-16 00:24:19.204 DEBUG o.h.j.internal.PersistenceUnitUtilImpl : jakarta.persistence.PersistenceUnitUtil.getIdentifier is only intended to work with enhanced entities (although Hibernate also adapts this support to its proxies); however the passed entity was not enhanced (nor a proxy).. may not be able to read identifier
2025-07-16 00:24:19.205 DEBUG o.s.orm.jpa.JpaTransactionManager : Initiating transaction commit
2025-07-16 00:24:19.206 DEBUG o.s.orm.jpa.JpaTransactionManager : Committing JPA transaction on EntityManager [SessionImpl(2062694447<open>)]
2025-07-16 00:24:19.206 DEBUG o.h.e.t.internal.TransactionImpl : committing
2025-07-16 00:24:19.207 DEBUG o.h.e.i.AbstractFlushingEventListener : Processing flush-time cascades
2025-07-16 00:24:19.208 DEBUG o.h.e.i.AbstractFlushingEventListener : Dirty checking collections
2025-07-16 00:24:19.209 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.UserEntity.roles#1], was: [S502.virtualPets.persistence.entity.UserEntity.roles#1] (initialized)
2025-07-16 00:24:19.210 DEBUG o.hibernate.engine.internal.Collections : Collection found: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1], was: [S502.virtualPets.persistence.entity.RoleEntity.permissionEntities#1] (initialized)
2025-07-16 00:24:19.212 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 insertions, 1 updates, 0 deletions to 7 objects
2025-07-16 00:24:19.213 DEBUG o.h.e.i.AbstractFlushingEventListener : Flushed: 0 (re)creations, 0 updates, 0 removals to 2 collections
2025-07-16 00:24:19.213 DEBUG o.hibernate.internal.util.EntityPrinter : Listing entities:
2025-07-16 00:24:19.214 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.UserEntity{password=$2a$10$o3nk8KLcEsad4JO5OYNzoeR4Vdar.qLzJIc/cAUzHyykiy3V.5CL2, accountNoLocked=true, roles=[S502.virtualPets.persistence.entity.RoleEntity#1], accountNotExpired=true, id=1, credentialNoExpired=true, isEnable=true, username=Sergio}
2025-07-16 00:24:19.214 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=1, permissionsEnum=CREATE}
2025-07-16 00:24:19.215 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.RoleEntity{roleEnum=ADMIN, permissionEntities=[S502.virtualPets.persistence.entity.PermissionEntity#4, S502.virtualPets.persistence.entity.PermissionEntity#2, S502.virtualPets.persistence.entity.PermissionEntity#3, S502.virtualPets.persistence.entity.PermissionEntity#1], id=1}
2025-07-16 00:24:19.215 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=4, permissionsEnum=UPDATE}
2025-07-16 00:24:19.216 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=3, permissionsEnum=DELETE}
2025-07-16 00:24:19.217 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PermissionEntity{id=2, permissionsEnum=READ}
2025-07-16 00:24:19.218 DEBUG o.hibernate.internal.util.EntityPrinter : S502.virtualPets.persistence.entity.PetEntity{createdAt=2025-07-15T17:23:34.573982, mood=EXCITED, energyLevel=70, hungerLevel=30, petType=GOKU, name=SER, id=13, user=S502.virtualPets.persistence.entity.UserEntity#1, updatedAt=2025-07-16T00:24:16.924297}
2025-07-16 00:24:19.219 DEBUG org.hibernate.SQL : update pets set energy_level=?,hunger_level=?,mood=?,name=?,pet_type=?,updated_at=?,user_id=? where id=?
2025-07-16 00:24:19.704 DEBUG o.s.orm.jpa.JpaTransactionManager : Not closing pre-bound JPA EntityManager after transaction
2025-07-16 00:24:19.704 INFO  S502.virtualPets.service.PetService : Pet 'SER' (ID: 13) Updated successfully by the user 'Sergio'.
2025-07-16 00:24:19.705 INFO  S.virtualPets.controller.PetController : Pet with ID 13 updated successfully.
2025-07-16 00:24:19.706 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Using 'application/json', given [application/json, text/plain, */*] and supported [application/json, application/*+json, application/yaml]
2025-07-16 00:24:19.706 DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor : Writing [PetResponseDTO[id=13, name=SER, type=GOKU, mood=EXCITED, energyLevel=70, hungerLevel=30, userId=1, u (truncated)...]
2025-07-16 00:24:19.708 DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor : Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-07-16 00:24:19.709 DEBUG o.s.web.servlet.DispatcherServlet : Completed 200 OK
2025-07-16 00:24:26.214 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@98e358a is alive
2025-07-16 00:24:41.411 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@4c76b4fa is alive
2025-07-16 00:24:42.756 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:24:42.757 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:24:58.202 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@7b2c99ca: (connection has passed maxLifetime)
2025-07-16 00:24:58.206 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Attempting to create/setup new connection (ae611529-da51-4d62-b9bd-82f8234f1d75)
2025-07-16 00:24:58.232 DEBUG jdk.event.security : X509Certificate: Alg:SHA256withRSA, Serial:02, Subject:CN=MySQL_Server_9.2.0_Auto_Generated_Server_Certificate, Issuer:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Key type:RSA, Length:2048, Cert Id:3807498037, Valid from:20/2/25, 10:36, Valid until:18/2/35, 10:36
2025-07-16 00:24:58.233 DEBUG jdk.event.security : X509Certificate: Alg:SHA256withRSA, Serial:01, Subject:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Issuer:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Key type:RSA, Length:2048, Cert Id:3139117285, Valid from:20/2/25, 10:36, Valid until:18/2/35, 10:36
2025-07-16 00:24:58.236 DEBUG jdk.event.security :  TLSHandshake: localhost:3306, TLSv1.3, TLS_AES_128_GCM_SHA256, 3807498037
2025-07-16 00:24:58.242 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Established new connection (ae611529-da51-4d62-b9bd-82f8234f1d75)
2025-07-16 00:24:58.243 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@5bf18d91
2025-07-16 00:25:03.144 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@68d4f6c4 is alive
2025-07-16 00:25:06.819 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1eebc3dc is alive
2025-07-16 00:25:12.770 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:25:12.771 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:25:21.630 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@1e943acb is alive
2025-07-16 00:25:26.785 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@80f4492 is alive
2025-07-16 00:25:42.777 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:25:42.778 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:25:43.888 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@1e943acb: (connection has passed maxLifetime)
2025-07-16 00:25:43.892 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Attempting to create/setup new connection (06f3340e-f62a-47f3-9acd-9c3807583e14)
2025-07-16 00:25:43.917 DEBUG jdk.event.security : X509Certificate: Alg:SHA256withRSA, Serial:02, Subject:CN=MySQL_Server_9.2.0_Auto_Generated_Server_Certificate, Issuer:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Key type:RSA, Length:2048, Cert Id:3807498037, Valid from:20/2/25, 10:36, Valid until:18/2/35, 10:36
2025-07-16 00:25:43.918 DEBUG jdk.event.security : X509Certificate: Alg:SHA256withRSA, Serial:01, Subject:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Issuer:CN=MySQL_Server_9.2.0_Auto_Generated_CA_Certificate, Key type:RSA, Length:2048, Cert Id:3139117285, Valid from:20/2/25, 10:36, Valid until:18/2/35, 10:36
2025-07-16 00:25:43.921 DEBUG jdk.event.security :  TLSHandshake: localhost:3306, TLSv1.3, TLS_AES_128_GCM_SHA256, 3807498037
2025-07-16 00:25:43.927 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Established new connection (06f3340e-f62a-47f3-9acd-9c3807583e14)
2025-07-16 00:25:43.928 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@f73f769
2025-07-16 00:25:44.289 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@22063a0c is alive
2025-07-16 00:25:48.612 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@48cdd8da is alive
2025-07-16 00:25:53.929 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@48b33fb1 is alive
2025-07-16 00:26:08.279 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@98e358a is alive
2025-07-16 00:26:12.794 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Pool stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:26:12.795 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-07-16 00:26:18.546 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - keepalive: connection com.mysql.cj.jdbc.ConnectionImpl@4c76b4fa is alive
2025-07-16 00:26:21.731 DEBUG java.lang.Runtime : Runtime.exit() called with status: 130
java.lang.Throwable: Runtime.exit(130)
	at java.base/java.lang.Shutdown.logRuntimeExit(Shutdown.java:179)
	at java.base/java.lang.Shutdown.exit(Shutdown.java:160)
	at java.base/java.lang.Terminator$1.handle(Terminator.java:51)
	at java.base/jdk.internal.misc.Signal$1.run(Signal.java:218)
	at java.base/java.lang.Thread.run(Thread.java:1575)
2025-07-16 00:26:21.742 DEBUG o.s.b.a.ApplicationAvailabilityBean : Application availability state ReadinessState changed from ACCEPTING_TRAFFIC to REFUSING_TRAFFIC
2025-07-16 00:26:21.745 DEBUG o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext : Closing org.springframework.boot.web.servlet.context.AnnotationConfigServletWebServerApplicationContext@61bcec87, started on Tue Jul 15 19:14:25 CEST 2025
2025-07-16 00:26:21.755 DEBUG o.s.c.support.DefaultLifecycleProcessor : Stopping beans in phase 2147482623
2025-07-16 00:26:21.763 INFO  o.s.b.w.e.tomcat.GracefulShutdown : Commencing graceful shutdown. Waiting for active requests to complete
2025-07-16 00:26:21.782 INFO  o.s.b.w.e.tomcat.GracefulShutdown : Graceful shutdown complete
2025-07-16 00:26:21.783 DEBUG o.s.c.support.DefaultLifecycleProcessor : Stopping beans in phase 2147481599
2025-07-16 00:26:21.784 DEBUG o.s.c.support.DefaultLifecycleProcessor : Bean 'webServerGracefulShutdown' completed its stop procedure
2025-07-16 00:26:21.788 DEBUG o.s.c.support.DefaultLifecycleProcessor : Bean 'webServerStartStop' completed its stop procedure
2025-07-16 00:26:21.788 DEBUG o.s.c.support.DefaultLifecycleProcessor : Stopping beans in phase 1073741823
2025-07-16 00:26:21.788 DEBUG o.s.c.support.DefaultLifecycleProcessor : Bean 'applicationTaskExecutor' completed its stop procedure
2025-07-16 00:26:21.788 DEBUG o.s.c.support.DefaultLifecycleProcessor : Stopping beans in phase -2147483647
2025-07-16 00:26:21.789 DEBUG o.s.c.support.DefaultLifecycleProcessor : Bean 'springBootLoggingLifecycle' completed its stop procedure
2025-07-16 00:26:21.794 DEBUG o.s.s.concurrent.ThreadPoolTaskExecutor : Shutting down ExecutorService 'applicationTaskExecutor'
2025-07-16 00:26:21.797 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2025-07-16 00:26:21.799 DEBUG o.hibernate.internal.SessionFactoryImpl : HHH000031: Closing
2025-07-16 00:26:21.801 DEBUG o.h.type.spi.TypeConfiguration$Scope : Un-scoping TypeConfiguration [org.hibernate.type.spi.TypeConfiguration$Scope@1d4403d2] from SessionFactory [org.hibernate.internal.SessionFactoryImpl@3241de6d]
2025-07-16 00:26:21.802 DEBUG o.h.s.i.AbstractServiceRegistryImpl : Implicitly destroying ServiceRegistry on de-registration of all child ServiceRegistries
2025-07-16 00:26:21.808 DEBUG o.h.b.r.i.BootstrapServiceRegistryImpl : Implicitly destroying Boot-strap registry on de-registration of all child ServiceRegistries
2025-07-16 00:26:21.815 INFO  com.zaxxer.hikari.HikariDataSource : HikariPool-1 - Shutdown initiated...
2025-07-16 00:26:21.815 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - Before shutdown stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-07-16 00:26:21.822 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@1eebc3dc: (connection evicted)
2025-07-16 00:26:21.825 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@98e358a: (connection evicted)
2025-07-16 00:26:21.827 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@48b33fb1: (connection evicted)
2025-07-16 00:26:21.829 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@80f4492: (connection evicted)
2025-07-16 00:26:21.831 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@4c76b4fa: (connection evicted)
2025-07-16 00:26:21.834 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@22063a0c: (connection evicted)
2025-07-16 00:26:21.837 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@48cdd8da: (connection evicted)
2025-07-16 00:26:21.840 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@68d4f6c4: (connection evicted)
2025-07-16 00:26:21.842 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@5bf18d91: (connection evicted)
2025-07-16 00:26:21.844 DEBUG com.zaxxer.hikari.pool.PoolBase : HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@f73f769: (connection evicted)
2025-07-16 00:26:21.846 DEBUG com.zaxxer.hikari.pool.HikariPool : HikariPool-1 - After  shutdown stats (total=0/10, idle=0/10, active=0, waiting=0)
2025-07-16 00:26:21.847 INFO  com.zaxxer.hikari.HikariDataSource : HikariPool-1 - Shutdown completed.
